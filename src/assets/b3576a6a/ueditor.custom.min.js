function getListener(obj,type,force){var allListeners;return type=type.toLowerCase(),(allListeners=obj.__allListeners||force&&(obj.__allListeners={}))&&(allListeners[type]||force&&(allListeners[type]=[]))}function getDomNode(node,start,ltr,startFromChild,fn,guard){var parent,tmpNode=startFromChild&&node[start];for(!tmpNode&&(tmpNode=node[ltr]);!tmpNode&&(parent=(parent||node).parentNode);){if("BODY"==parent.tagName||guard&&!guard(parent))return null;tmpNode=parent[ltr]}return tmpNode&&fn&&!fn(tmpNode)?getDomNode(tmpNode,start,ltr,!1,fn):tmpNode}UEDITOR_CONFIG=window.UEDITOR_CONFIG||{};var baidu=window.baidu||{};window.baidu=baidu,window.UE=baidu.editor={},UE.plugins={},UE.commands={},UE.instants={},UE.I18N={},UE.version="1.2.4.0";var dom=UE.dom={},browser=UE.browser=function(){var agent=navigator.userAgent.toLowerCase(),opera=window.opera,browser={ie:!!window.ActiveXObject,opera:!!opera&&opera.version,webkit:agent.indexOf(" applewebkit/")>-1,mac:agent.indexOf("macintosh")>-1,quirks:"BackCompat"==document.compatMode};browser.gecko="Gecko"==navigator.product&&!browser.webkit&&!browser.opera;var version=0;if(browser.ie&&(version=parseFloat(agent.match(/msie (\d+)/)[1]),browser.ie9Compat=9==document.documentMode,browser.ie8=!!document.documentMode,browser.ie8Compat=8==document.documentMode,browser.ie7Compat=7==version&&!document.documentMode||7==document.documentMode,browser.ie6Compat=7>version||browser.quirks),browser.gecko){var geckoRelease=agent.match(/rv:([\d\.]+)/);geckoRelease&&(geckoRelease=geckoRelease[1].split("."),version=1e4*geckoRelease[0]+100*(geckoRelease[1]||0)+1*(geckoRelease[2]||0))}return/chrome\/(\d+\.\d)/i.test(agent)&&(browser.chrome=+RegExp.$1),/(\d+\.\d)?(?:\.\d)?\s+safari\/?(\d+\.\d+)?/i.test(agent)&&!/chrome/i.test(agent)&&(browser.safari=+(RegExp.$1||RegExp.$2)),browser.opera&&(version=parseFloat(opera.version())),browser.webkit&&(version=parseFloat(agent.match(/ applewebkit\/(\d+)/)[1])),browser.version=version,browser.isCompatible=!browser.mobile&&(browser.ie&&version>=6||browser.gecko&&version>=10801||browser.opera&&version>=9.5||browser.air&&version>=1||browser.webkit&&version>=522||!1),browser}(),ie=browser.ie,webkit=browser.webkit,gecko=browser.gecko,opera=browser.opera,utils=UE.utils={each:function(obj,iterator,context){if(null!=obj)if(Array.prototype.forEach&&obj.forEach===Array.prototype.forEach)obj.forEach(iterator,context);else if(obj.length===+obj.length){for(var i=0,l=obj.length;l>i;i++)if(iterator.call(context,obj[i],i,obj)===!1)return}else for(var key in obj)if(obj.hasOwnProperty(key)&&iterator.call(context,obj[key],key,obj)===!1)return},makeInstance:function(obj){var noop=Function();return noop.prototype=obj,obj=new noop,noop.prototype=null,obj},extend:function(t,s,b){if(s)for(var k in s)b&&t.hasOwnProperty(k)||(t[k]=s[k]);return t},inherits:function(subClass,superClass){var oldP=subClass.prototype,newP=utils.makeInstance(superClass.prototype);return utils.extend(newP,oldP,!0),subClass.prototype=newP,newP.constructor=subClass},bind:function(fn,context){return function(){return fn.apply(context,arguments)}},defer:function(fn,delay,exclusion){var timerID;return function(){exclusion&&clearTimeout(timerID),timerID=setTimeout(fn,delay)}},indexOf:function(array,item,start){var index=-1;return start=this.isNumber(start)?start:0,this.each(array,function(v,i){return i>=start&&v===item?(index=i,!1):void 0}),index},removeItem:function(array,item){for(var i=0,l=array.length;l>i;i++)array[i]===item&&(array.splice(i,1),i--)},trim:function(str){return str.replace(/(^[ \t\n\r]+)|([ \t\n\r]+$)/g,"")},listToMap:function(list){if(!list)return{};list=utils.isArray(list)?list:list.split(",");for(var ci,i=0,obj={};ci=list[i++];)obj[ci.toUpperCase()]=obj[ci]=1;return obj},unhtml:function(str,reg){return str?str.replace(reg||/[&<">]/g,function(m){return{"<":"&lt;","&":"&amp;",'"':"&quot;",">":"&gt;"}[m]}):""},html:function(str){return str?str.replace(/&((g|l|quo)t|amp);/g,function(m){return{"&lt;":"<","&amp;":"&","&quot;":'"',"&gt;":">"}[m]}):""},cssStyleToDomStyle:function(){var test=document.createElement("div").style,cache={"float":void 0!=test.cssFloat?"cssFloat":void 0!=test.styleFloat?"styleFloat":"float"};return function(cssName){return cache[cssName]||(cache[cssName]=cssName.toLowerCase().replace(/-./g,function(match){return match.charAt(1).toUpperCase()}))}}(),loadFile:function(){function getItem(doc,obj){for(var ci,i=0;ci=tmpList[i++];)try{if(ci.doc===doc&&ci.url==(obj.src||obj.href))return ci}catch(e){continue}}var tmpList=[];return function(doc,obj,fn){var item=getItem(doc,obj);if(item)return item.ready?fn&&fn():item.funs.push(fn),void 0;if(tmpList.push({doc:doc,url:obj.src||obj.href,funs:[fn]}),!doc.body){var html=[];for(var p in obj)"tag"!=p&&html.push(p+'="'+obj[p]+'"');return doc.write("<"+obj.tag+" "+html.join(" ")+" ></"+obj.tag+">"),void 0}if(!obj.id||!doc.getElementById(obj.id)){var element=doc.createElement(obj.tag);delete obj.tag;for(var p in obj)element.setAttribute(p,obj[p]);element.onload=element.onreadystatechange=function(){if(!this.readyState||/loaded|complete/.test(this.readyState)){if(item=getItem(doc,obj),item.funs.length>0){item.ready=1;for(var fi;fi=item.funs.pop();)fi()}element.onload=element.onreadystatechange=null}},doc.getElementsByTagName("head")[0].appendChild(element)}}}(),isEmptyObject:function(obj){if(null==obj)return!0;if(this.isArray(obj)||this.isString(obj))return 0===obj.length;for(var key in obj)if(obj.hasOwnProperty(key))return!1;return!0},fixColor:function(name,value){if(/color/i.test(name)&&/rgba?/.test(value)){var array=value.split(",");if(array.length>3)return"";value="#";for(var color,i=0;color=array[i++];)color=parseInt(color.replace(/[^\d]/gi,""),10).toString(16),value+=1==color.length?"0"+color:color;value=value.toUpperCase()}return value},optCss:function(val){function opt(obj,name){if(!obj)return"";var t=obj.top,b=obj.bottom,l=obj.left,r=obj.right,val="";if(t&&l&&b&&r)val+=";"+name+":"+(t==b&&b==l&&l==r?t:t==b&&l==r?t+" "+l:l==r?t+" "+l+" "+b:t+" "+r+" "+b+" "+l)+";";else for(var p in obj)val+=";"+name+"-"+p+":"+obj[p]+";";return val}var padding,margin;return val=val.replace(/(padding|margin|border)\-([^:]+):([^;]+);?/gi,function(str,key,name,val){if(1==val.split(" ").length)switch(key){case"padding":return!padding&&(padding={}),padding[name]=val,"";case"margin":return!margin&&(margin={}),margin[name]=val,"";case"border":return"initial"==val?"":str}return str}),val+=opt(padding,"padding")+opt(margin,"margin"),val.replace(/^[ \n\r\t;]*|[ \n\r\t]*$/,"").replace(/;([ \n\r\t]+)|\1;/g,";").replace(/(&((l|g)t|quot|#39))?;{2,}/g,function(a,b){return b?b+";;":";"})},clone:function(source,target){var tmp;target=target||{};for(var i in source)source.hasOwnProperty(i)&&(tmp=source[i],"object"==typeof tmp?(target[i]=utils.isArray(tmp)?[]:{},utils.clone(source[i],target[i])):target[i]=tmp);return target},transUnitToPx:function(val){if(!/(pt|cm)/.test(val))return val;var unit;switch(val.replace(/([\d.]+)(\w+)/,function(str,v,u){val=v,unit=u}),unit){case"cm":val=25*parseFloat(val);break;case"pt":val=Math.round(96*parseFloat(val)/72)}return val+(val?"px":"")},domReady:function(){function doReady(doc){doc.isReady=!0;for(var ci;ci=fnArr.pop();ci());}var fnArr=[];return function(onready,win){win=win||window;var doc=win.document;onready&&fnArr.push(onready),"complete"===doc.readyState?doReady(doc):(doc.isReady&&doReady(doc),browser.ie?(function(){if(!doc.isReady){try{doc.documentElement.doScroll("left")}catch(error){return setTimeout(arguments.callee,0),void 0}doReady(doc)}}(),win.attachEvent("onload",function(){doReady(doc)})):(doc.addEventListener("DOMContentLoaded",function(){doc.removeEventListener("DOMContentLoaded",arguments.callee,!1),doReady(doc)},!1),win.addEventListener("load",function(){doReady(doc)},!1)))}}(),cssRule:browser.ie?function(key,style,doc){var indexList,index;doc=doc||document,indexList=doc.indexList?doc.indexList:doc.indexList={};var sheetStyle;if(indexList[key])sheetStyle=doc.styleSheets[indexList[key]];else{if(void 0===style)return"";sheetStyle=doc.createStyleSheet("",index=doc.styleSheets.length),indexList[key]=index}return void 0===style?sheetStyle.cssText:(sheetStyle.cssText=style||"",void 0)}:function(key,style,doc){doc=doc||document;var node,head=doc.getElementsByTagName("head")[0];if(!(node=doc.getElementById(key))){if(void 0===style)return"";node=doc.createElement("style"),node.id=key,head.appendChild(node)}return void 0===style?node.innerHTML:(""!==style?node.innerHTML=style:head.removeChild(node),void 0)}};utils.each(["String","Function","Array","Number"],function(v){UE.utils["is"+v]=function(obj){return Object.prototype.toString.apply(obj)=="[object "+v+"]"}});var EventBase=UE.EventBase=function(){};EventBase.prototype={addListener:function(types,listener){types=utils.trim(types).split(" ");for(var ti,i=0;ti=types[i++];)getListener(this,ti,!0).push(listener)},removeListener:function(types,listener){types=utils.trim(types).split(" ");for(var ti,i=0;ti=types[i++];)utils.removeItem(getListener(this,ti)||[],listener)},fireEvent:function(types){types=utils.trim(types).split(" ");for(var ti,i=0;ti=types[i++];){var r,t,k,listeners=getListener(this,ti);if(listeners)for(k=listeners.length;k--;)t=listeners[k].apply(this,arguments),void 0!==t&&(r=t);(t=this["on"+ti.toLowerCase()])&&(r=t.apply(this,arguments))}return r}};var dtd=dom.dtd=function(){function _(s){for(var k in s)s[k.toUpperCase()]=s[k];return s}function X(t){for(var a=arguments,i=1;a.length>i;i++){var x=a[i];for(var k in x)t.hasOwnProperty(k)||(t[k]=x[k])}return t}var A=_({isindex:1,fieldset:1}),B=_({input:1,button:1,select:1,textarea:1,label:1}),C=X(_({a:1}),B),D=X({iframe:1},C),E=_({hr:1,ul:1,menu:1,div:1,blockquote:1,noscript:1,table:1,center:1,address:1,dir:1,pre:1,h5:1,dl:1,h4:1,noframes:1,h6:1,ol:1,h1:1,h3:1,h2:1}),F=_({ins:1,del:1,script:1,style:1}),G=X(_({b:1,acronym:1,bdo:1,"var":1,"#":1,abbr:1,code:1,br:1,i:1,cite:1,kbd:1,u:1,strike:1,s:1,tt:1,strong:1,q:1,samp:1,em:1,dfn:1,span:1}),F),H=X(_({sub:1,img:1,embed:1,object:1,sup:1,basefont:1,map:1,applet:1,font:1,big:1,small:1}),G),I=X(_({p:1}),H),J=X(_({iframe:1}),H,B),K=_({img:1,embed:1,noscript:1,br:1,kbd:1,center:1,button:1,basefont:1,h5:1,h4:1,samp:1,h6:1,ol:1,h1:1,h3:1,h2:1,form:1,font:1,"#":1,select:1,menu:1,ins:1,abbr:1,label:1,code:1,table:1,script:1,cite:1,input:1,iframe:1,strong:1,textarea:1,noframes:1,big:1,small:1,span:1,hr:1,sub:1,bdo:1,"var":1,div:1,object:1,sup:1,strike:1,dir:1,map:1,dl:1,applet:1,del:1,isindex:1,fieldset:1,ul:1,b:1,acronym:1,a:1,blockquote:1,i:1,u:1,s:1,tt:1,address:1,q:1,pre:1,p:1,em:1,dfn:1}),L=X(_({a:0}),J),M=_({tr:1}),N=_({"#":1}),O=X(_({param:1}),K),P=X(_({form:1}),A,D,E,I),Q=_({li:1}),R=_({style:1,script:1}),S=_({base:1,link:1,meta:1,title:1}),T=X(S,R),U=_({head:1,body:1}),V=_({html:1}),block=_({address:1,blockquote:1,center:1,dir:1,div:1,dl:1,fieldset:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,isindex:1,menu:1,noframes:1,ol:1,p:1,pre:1,table:1,ul:1}),empty=_({area:1,base:1,br:1,col:1,hr:1,img:1,input:1,link:1,meta:1,param:1,embed:1});return _({$nonBodyContent:X(V,U,S),$block:block,$inline:L,$body:X(_({script:1,style:1}),block),$cdata:_({script:1,style:1}),$empty:empty,$nonChild:_({iframe:1,textarea:1}),$listItem:_({dd:1,dt:1,li:1}),$list:_({ul:1,ol:1,dl:1}),$isNotEmpty:_({table:1,ul:1,ol:1,dl:1,iframe:1,area:1,base:1,col:1,hr:1,img:1,embed:1,input:1,link:1,meta:1,param:1}),$removeEmpty:_({a:1,abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1}),$removeEmptyBlock:_({p:1,div:1}),$tableContent:_({caption:1,col:1,colgroup:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1,table:1}),$notTransContent:_({pre:1,script:1,style:1,textarea:1}),html:U,head:T,style:N,script:N,body:P,base:{},link:{},meta:{},title:N,col:{},tr:_({td:1,th:1}),img:{},embed:{},colgroup:_({thead:1,col:1,tbody:1,tr:1,tfoot:1}),noscript:P,td:P,br:{},th:P,center:P,kbd:L,button:X(I,E),basefont:{},h5:L,h4:L,samp:L,h6:L,ol:Q,h1:L,h3:L,option:N,h2:L,form:X(A,D,E,I),select:_({optgroup:1,option:1}),font:L,ins:L,menu:Q,abbr:L,label:L,table:_({thead:1,col:1,tbody:1,tr:1,colgroup:1,caption:1,tfoot:1}),code:L,tfoot:M,cite:L,li:P,input:{},iframe:P,strong:L,textarea:N,noframes:P,big:L,small:L,span:_({"#":1,br:1}),hr:L,dt:L,sub:L,optgroup:_({option:1}),param:{},bdo:L,"var":L,div:P,object:O,sup:L,dd:P,strike:L,area:{},dir:Q,map:X(_({area:1,form:1,p:1}),A,F,E),applet:O,dl:_({dt:1,dd:1}),del:L,isindex:{},fieldset:X(_({legend:1}),K),thead:M,ul:Q,acronym:L,b:L,a:X(_({a:1}),J),blockquote:X(_({td:1,tr:1,tbody:1,li:1}),P),caption:L,i:L,u:L,tbody:M,s:L,address:X(D,I),tt:L,legend:L,q:L,pre:X(G,C),p:X(_({a:1}),L),em:L,dfn:L})}(),attrFix=ie&&9>browser.version?{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder"}:{tabindex:"tabIndex",readonly:"readOnly"},styleBlock=utils.listToMap(["-webkit-box","-moz-box","block","list-item","table","table-row-group","table-header-group","table-footer-group","table-row","table-column-group","table-column","table-cell","table-caption"]),domUtils=dom.domUtils={NODE_ELEMENT:1,NODE_DOCUMENT:9,NODE_TEXT:3,NODE_COMMENT:8,NODE_DOCUMENT_FRAGMENT:11,POSITION_IDENTICAL:0,POSITION_DISCONNECTED:1,POSITION_FOLLOWING:2,POSITION_PRECEDING:4,POSITION_IS_CONTAINED:8,POSITION_CONTAINS:16,fillChar:ie&&"6"==browser.version?"﻿":"​",keys:{8:1,46:1,16:1,17:1,18:1,37:1,38:1,39:1,40:1,13:1},getPosition:function(nodeA,nodeB){if(nodeA===nodeB)return 0;var node,parentsA=[nodeA],parentsB=[nodeB];for(node=nodeA;node=node.parentNode;){if(node===nodeB)return 10;parentsA.push(node)}for(node=nodeB;node=node.parentNode;){if(node===nodeA)return 20;parentsB.push(node)}if(parentsA.reverse(),parentsB.reverse(),parentsA[0]!==parentsB[0])return 1;for(var i=-1;i++,parentsA[i]===parentsB[i];);for(nodeA=parentsA[i],nodeB=parentsB[i];nodeA=nodeA.nextSibling;)if(nodeA===nodeB)return 4;return 2},getNodeIndex:function(node,ignoreTextNode){for(var preNode=node,i=0;preNode=preNode.previousSibling;)ignoreTextNode&&3==preNode.nodeType||i++;return i},inDoc:function(node,doc){return 10==domUtils.getPosition(node,doc)},findParent:function(node,filterFn,includeSelf){if(node&&!domUtils.isBody(node))for(node=includeSelf?node:node.parentNode;node;){if(!filterFn||filterFn(node)||domUtils.isBody(node))return filterFn&&!filterFn(node)&&domUtils.isBody(node)?null:node;node=node.parentNode}return null},findParentByTagName:function(node,tagNames,includeSelf,excludeFn){return tagNames=utils.listToMap(utils.isArray(tagNames)?tagNames:[tagNames]),domUtils.findParent(node,function(node){return tagNames[node.tagName]&&!(excludeFn&&excludeFn(node))},includeSelf)},findParents:function(node,includeSelf,filterFn,closerFirst){for(var parents=includeSelf&&(filterFn&&filterFn(node)||!filterFn)?[node]:[];node=domUtils.findParent(node,filterFn);)parents.push(node);return closerFirst?parents:parents.reverse()},insertAfter:function(node,newNode){return node.parentNode.insertBefore(newNode,node.nextSibling)},remove:function(node,keepChildren){var child,parent=node.parentNode;if(parent){if(keepChildren&&node.hasChildNodes())for(;child=node.firstChild;)parent.insertBefore(child,node);parent.removeChild(node)}return node},getNextDomNode:function(node,startFromChild,filterFn,guard){return getDomNode(node,"firstChild","nextSibling",startFromChild,filterFn,guard)},isBookmarkNode:function(node){return 1==node.nodeType&&node.id&&/^_baidu_bookmark_/i.test(node.id)},getWindow:function(node){var doc=node.ownerDocument||node;return doc.defaultView||doc.parentWindow},getCommonAncestor:function(nodeA,nodeB){if(nodeA===nodeB)return nodeA;for(var parentsA=[nodeA],parentsB=[nodeB],parent=nodeA,i=-1;parent=parent.parentNode;){if(parent===nodeB)return parent;parentsA.push(parent)}for(parent=nodeB;parent=parent.parentNode;){if(parent===nodeA)return parent;parentsB.push(parent)}for(parentsA.reverse(),parentsB.reverse();i++,parentsA[i]===parentsB[i];);return 0==i?null:parentsA[i-1]},clearEmptySibling:function(node,ignoreNext,ignorePre){function clear(next,dir){for(var tmpNode;next&&!domUtils.isBookmarkNode(next)&&(domUtils.isEmptyInlineElement(next)||!RegExp("[^	\n\r"+domUtils.fillChar+"]").test(next.nodeValue));)tmpNode=next[dir],domUtils.remove(next),next=tmpNode}!ignoreNext&&clear(node.nextSibling,"nextSibling"),!ignorePre&&clear(node.previousSibling,"previousSibling")},split:function(node,offset){var doc=node.ownerDocument;if(browser.ie&&offset==node.nodeValue.length){var next=doc.createTextNode("");return domUtils.insertAfter(node,next)}var retval=node.splitText(offset);if(browser.ie8){var tmpNode=doc.createTextNode("");domUtils.insertAfter(retval,tmpNode),domUtils.remove(tmpNode)}return retval},isWhitespace:function(node){return!RegExp("[^ 	\n\r"+domUtils.fillChar+"]").test(node.nodeValue)},getXY:function(element){for(var x=0,y=0;element.offsetParent;)y+=element.offsetTop,x+=element.offsetLeft,element=element.offsetParent;return{x:x,y:y}},on:function(element,type,handler){var types=utils.isArray(type)?type:[type],k=types.length;if(k)for(;k--;)if(type=types[k],element.addEventListener)element.addEventListener(type,handler,!1);else{handler._d||(handler._d={els:[]});var key=type+(""+handler),index=utils.indexOf(handler._d.els,element);handler._d[key]&&-1!=index||(-1==index&&handler._d.els.push(element),handler._d[key]||(handler._d[key]=function(evt){return handler.call(evt.srcElement,evt||window.event)}),element.attachEvent("on"+type,handler._d[key]))}element=null},un:function(element,type,handler){var types=utils.isArray(type)?type:[type],k=types.length;if(k)for(;k--;)if(type=types[k],element.removeEventListener)element.removeEventListener(type,handler,!1);else{var key=type+(""+handler);try{element.detachEvent("on"+type,handler._d?handler._d[key]:handler)}catch(e){}if(handler._d&&handler._d[key]){var index=utils.indexOf(handler._d.els,element);-1!=index&&handler._d.els.splice(index,1),0==handler._d.els.length&&delete handler._d[key]}}},isSameElement:function(nodeA,nodeB){if(nodeA.tagName!=nodeB.tagName)return!1;var thisAttrs=nodeA.attributes,otherAttrs=nodeB.attributes;if(!ie&&thisAttrs.length!=otherAttrs.length)return!1;for(var attrA,attrB,al=0,bl=0,i=0;attrA=thisAttrs[i++];){if("style"==attrA.nodeName){if(attrA.specified&&al++,domUtils.isSameStyle(nodeA,nodeB))continue;return!1}if(ie){if(!attrA.specified)continue;al++,attrB=otherAttrs.getNamedItem(attrA.nodeName)}else attrB=nodeB.attributes[attrA.nodeName];if(!attrB.specified||attrA.nodeValue!=attrB.nodeValue)return!1}if(ie){for(i=0;attrB=otherAttrs[i++];)attrB.specified&&bl++;if(al!=bl)return!1}return!0},isSameStyle:function(nodeA,nodeB){var styleA=nodeA.style.cssText.replace(/( ?; ?)/g,";").replace(/( ?: ?)/g,":"),styleB=nodeB.style.cssText.replace(/( ?; ?)/g,";").replace(/( ?: ?)/g,":");if(browser.opera){if(styleA=nodeA.style,styleB=nodeB.style,styleA.length!=styleB.length)return!1;for(var p in styleA)if(!/^(\d+|csstext)$/i.test(p)&&styleA[p]!=styleB[p])return!1;return!0}if(!styleA||!styleB)return styleA==styleB;if(styleA=styleA.split(";"),styleB=styleB.split(";"),styleA.length!=styleB.length)return!1;for(var ci,i=0;ci=styleA[i++];)if(-1==utils.indexOf(styleB,ci))return!1;return!0},isBlockElm:function(node){return 1==node.nodeType&&(dtd.$block[node.tagName]||styleBlock[domUtils.getComputedStyle(node,"display")])&&!dtd.$nonChild[node.tagName]},isBody:function(node){return node&&1==node.nodeType&&"body"==node.tagName.toLowerCase()},breakParent:function(node,parent){var tmpNode,leftNodes,rightNodes,parentClone=node,clone=node;do{for(parentClone=parentClone.parentNode,leftNodes?(tmpNode=parentClone.cloneNode(!1),tmpNode.appendChild(leftNodes),leftNodes=tmpNode,tmpNode=parentClone.cloneNode(!1),tmpNode.appendChild(rightNodes),rightNodes=tmpNode):(leftNodes=parentClone.cloneNode(!1),rightNodes=leftNodes.cloneNode(!1));tmpNode=clone.previousSibling;)leftNodes.insertBefore(tmpNode,leftNodes.firstChild);for(;tmpNode=clone.nextSibling;)rightNodes.appendChild(tmpNode);clone=parentClone}while(parent!==parentClone);return tmpNode=parent.parentNode,tmpNode.insertBefore(leftNodes,parent),tmpNode.insertBefore(rightNodes,parent),tmpNode.insertBefore(node,rightNodes),domUtils.remove(parent),node},isEmptyInlineElement:function(node){if(1!=node.nodeType||!dtd.$removeEmpty[node.tagName])return 0;for(node=node.firstChild;node;){if(domUtils.isBookmarkNode(node))return 0;if(1==node.nodeType&&!domUtils.isEmptyInlineElement(node)||3==node.nodeType&&!domUtils.isWhitespace(node))return 0;node=node.nextSibling}return 1},trimWhiteTextNode:function(node){function remove(dir){for(var child;(child=node[dir])&&3==child.nodeType&&domUtils.isWhitespace(child);)node.removeChild(child)}remove("firstChild"),remove("lastChild")},mergeChild:function(node,tagName,attrs){for(var ci,list=domUtils.getElementsByTagName(node,node.tagName.toLowerCase()),i=0;ci=list[i++];)if(ci.parentNode&&!domUtils.isBookmarkNode(ci))if("span"!=ci.tagName.toLowerCase())domUtils.isSameElement(node,ci)&&domUtils.remove(ci,!0);else{if(node===ci.parentNode&&(domUtils.trimWhiteTextNode(node),1==node.childNodes.length)){node.style.cssText=ci.style.cssText+";"+node.style.cssText,domUtils.remove(ci,!0);continue}if(ci.style.cssText=node.style.cssText+";"+ci.style.cssText,attrs){var style=attrs.style;if(style){style=style.split(";");for(var s,j=0;s=style[j++];)ci.style[utils.cssStyleToDomStyle(s.split(":")[0])]=s.split(":")[1]}}domUtils.isSameStyle(ci,node)&&domUtils.remove(ci,!0)}},getElementsByTagName:function(node,name){for(var ci,list=node.getElementsByTagName(name),arr=[],i=0;ci=list[i++];)arr.push(ci);return arr},mergeToParent:function(node){for(var parent=node.parentNode;parent&&dtd.$removeEmpty[parent.tagName];){if(parent.tagName==node.tagName||"A"==parent.tagName){if(domUtils.trimWhiteTextNode(parent),"SPAN"==parent.tagName&&!domUtils.isSameStyle(parent,node)||"A"==parent.tagName&&"SPAN"==node.tagName){if(parent.childNodes.length>1||parent!==node.parentNode){node.style.cssText=parent.style.cssText+";"+node.style.cssText,parent=parent.parentNode;continue}parent.style.cssText+=";"+node.style.cssText,"A"==parent.tagName&&(parent.style.textDecoration="underline")}if("A"!=parent.tagName){parent===node.parentNode&&domUtils.remove(node,!0);break}}parent=parent.parentNode}},mergeSibling:function(node,ignorePre,ignoreNext){function merge(rtl,start,node){var next;if((next=node[rtl])&&!domUtils.isBookmarkNode(next)&&1==next.nodeType&&domUtils.isSameElement(node,next)){for(;next.firstChild;)"firstChild"==start?node.insertBefore(next.lastChild,node.firstChild):node.appendChild(next.firstChild);domUtils.remove(next)}}!ignorePre&&merge("previousSibling","firstChild",node),!ignoreNext&&merge("nextSibling","lastChild",node)},unSelectable:ie||browser.opera?function(node){node.onselectstart=function(){return!1},node.onclick=node.onkeyup=node.onkeydown=function(){return!1},node.unselectable="on",node.setAttribute("unselectable","on");for(var ci,i=0;ci=node.all[i++];)switch(ci.tagName.toLowerCase()){case"iframe":case"textarea":case"input":case"select":break;default:ci.unselectable="on",node.setAttribute("unselectable","on")}}:function(node){node.style.MozUserSelect=node.style.webkitUserSelect=node.style.KhtmlUserSelect="none"},removeAttributes:function(node,attrNames){for(var ci,i=0;ci=attrNames[i++];){switch(ci=attrFix[ci]||ci){case"className":node[ci]="";break;case"style":node.style.cssText="",!browser.ie&&node.removeAttributeNode(node.getAttributeNode("style"))}node.removeAttribute(ci)}},createElement:function(doc,tag,attrs){return domUtils.setAttributes(doc.createElement(tag),attrs)},setAttributes:function(node,attrs){for(var attr in attrs)if(attrs.hasOwnProperty(attr)){var value=attrs[attr];switch(attr){case"class":node.className=value;break;case"style":node.style.cssText=node.style.cssText+";"+value;break;case"innerHTML":node[attr]=value;break;case"value":node.value=value;break;default:node.setAttribute(attrFix[attr]||attr,value)}}return node},getComputedStyle:function(element,styleName){var pros="width height top left";if(pros.indexOf(styleName)>-1)return element["offset"+styleName.replace(/^\w/,function(s){return s.toUpperCase()})]+"px";if(3==element.nodeType&&(element=element.parentNode),browser.ie&&9>browser.version&&"font-size"==styleName&&!element.style.fontSize&&!dtd.$empty[element.tagName]&&!dtd.$nonChild[element.tagName]){var span=element.ownerDocument.createElement("span");span.style.cssText="padding:0;border:0;font-family:simsun;",span.innerHTML=".",element.appendChild(span);var result=span.offsetHeight;return element.removeChild(span),span=null,result+"px"}try{var value=domUtils.getStyle(element,styleName)||(window.getComputedStyle?domUtils.getWindow(element).getComputedStyle(element,"").getPropertyValue(styleName):(element.currentStyle||element.style)[utils.cssStyleToDomStyle(styleName)])}catch(e){return""}return utils.transUnitToPx(utils.fixColor(styleName,value))},removeClasses:function(elm,classNames){classNames=utils.isArray(classNames)?classNames:utils.trim(classNames).replace(/[ ]{2,}/g," ").split(" ");for(var ci,i=0,cls=elm.className;ci=classNames[i++];)cls=cls.replace(RegExp("\\b"+ci+"\\b"),"");cls=utils.trim(cls).replace(/[ ]{2,}/g," "),cls?elm.className=cls:domUtils.removeAttributes(elm,["class"])},addClass:function(elm,classNames){if(elm){classNames=utils.trim(classNames).replace(/[ ]{2,}/g," ").split(" ");for(var ci,i=0,cls=elm.className;ci=classNames[i++];)RegExp("\\b"+ci+"\\b").test(cls)||(elm.className+=" "+ci)}},hasClass:function(element,className){className=utils.trim(className).replace(/[ ]{2,}/g," ").split(" ");for(var ci,i=0,cls=element.className;ci=className[i++];)if(!RegExp("\\b"+ci+"\\b").test(cls))return!1;return i-1==className.length},preventDefault:function(evt){evt.preventDefault?evt.preventDefault():evt.returnValue=!1},removeStyle:function(element,name){element.style.removeProperty?element.style.removeProperty(name):element.style.removeAttribute(utils.cssStyleToDomStyle(name)),element.style.cssText||domUtils.removeAttributes(element,["style"])},getStyle:function(element,name){var value=element.style[utils.cssStyleToDomStyle(name)];return utils.fixColor(name,value)},setStyle:function(element,name,value){element.style[utils.cssStyleToDomStyle(name)]=value},setStyles:function(element,styles){for(var name in styles)styles.hasOwnProperty(name)&&domUtils.setStyle(element,name,styles[name])},removeDirtyAttr:function(node){for(var ci,i=0,nodes=node.getElementsByTagName("*");ci=nodes[i++];)ci.removeAttribute("_moz_dirty");node.removeAttribute("_moz_dirty")},getChildCount:function(node,fn){var count=0,first=node.firstChild;for(fn=fn||function(){return 1};first;)fn(first)&&count++,first=first.nextSibling;return count},isEmptyNode:function(node){return!node.firstChild||0==domUtils.getChildCount(node,function(node){return!domUtils.isBr(node)&&!domUtils.isBookmarkNode(node)&&!domUtils.isWhitespace(node)})},clearSelectedArr:function(nodes){for(var node;node=nodes.pop();)domUtils.removeAttributes(node,["class"])},scrollToView:function(node,win,offsetTop){var getViewPaneSize=function(){var doc=win.document,mode="CSS1Compat"==doc.compatMode;return{width:(mode?doc.documentElement.clientWidth:doc.body.clientWidth)||0,height:(mode?doc.documentElement.clientHeight:doc.body.clientHeight)||0}},getScrollPosition=function(win){if("pageXOffset"in win)return{x:win.pageXOffset||0,y:win.pageYOffset||0};var doc=win.document;return{x:doc.documentElement.scrollLeft||doc.body.scrollLeft||0,y:doc.documentElement.scrollTop||doc.body.scrollTop||0}},winHeight=getViewPaneSize().height,offset=-1*winHeight+offsetTop;offset+=node.offsetHeight||0;var elementPosition=domUtils.getXY(node);offset+=elementPosition.y;var currentScroll=getScrollPosition(win).y;(offset>currentScroll||currentScroll-winHeight>offset)&&win.scrollTo(0,offset+(0>offset?-20:20))},isBr:function(node){return 1==node.nodeType&&"BR"==node.tagName},isFillChar:function(node){return 3==node.nodeType&&!node.nodeValue.replace(RegExp(domUtils.fillChar),"").length},isStartInblock:function(range){for(var tmp,tmpRange=range.cloneRange(),flag=0,start=tmpRange.startContainer;start&&domUtils.isFillChar(start);)tmp=start,start=start.previousSibling;for(tmp&&(tmpRange.setStartBefore(tmp),start=tmpRange.startContainer),1==start.nodeType&&domUtils.isEmptyNode(start)&&1==tmpRange.startOffset&&tmpRange.setStart(start,0).collapse(!0);!tmpRange.startOffset;){if(start=tmpRange.startContainer,domUtils.isBlockElm(start)||domUtils.isBody(start)){flag=1;break}var tmpNode,pre=tmpRange.startContainer.previousSibling;if(pre){for(;pre&&domUtils.isFillChar(pre);)tmpNode=pre,pre=pre.previousSibling;tmpNode?tmpRange.setStartBefore(tmpNode):tmpRange.setStartBefore(tmpRange.startContainer)}else tmpRange.setStartBefore(tmpRange.startContainer)}return flag&&!domUtils.isBody(tmpRange.startContainer)?1:0},isEmptyBlock:function(node){var reg=RegExp("[ 	\r\n"+domUtils.fillChar+"]","g");if(node[browser.ie?"innerText":"textContent"].replace(reg,"").length>0)return 0;for(var n in dtd.$isNotEmpty)if(node.getElementsByTagName(n).length)return 0;return 1},setViewportOffset:function(element,offset){var left=0|parseInt(element.style.left),top=0|parseInt(element.style.top),rect=element.getBoundingClientRect(),offsetLeft=offset.left-rect.left,offsetTop=offset.top-rect.top;offsetLeft&&(element.style.left=left+offsetLeft+"px"),offsetTop&&(element.style.top=top+offsetTop+"px")},fillNode:function(doc,node){var tmpNode=browser.ie?doc.createTextNode(domUtils.fillChar):doc.createElement("br");node.innerHTML="",node.appendChild(tmpNode)},moveChild:function(src,tag,dir){for(;src.firstChild;)dir&&tag.firstChild?tag.insertBefore(src.lastChild,tag.firstChild):tag.appendChild(src.firstChild)},hasNoAttributes:function(node){return browser.ie?/^<\w+\s*?>/.test(node.outerHTML):0==node.attributes.length},isCustomeNode:function(node){return 1==node.nodeType&&node.getAttribute("_ue_custom_node_")},isTagNode:function(node,tagName){return 1==node.nodeType&&RegExp(node.tagName,"i").test(tagName)},filterNodeList:function(nodelist,filter,forAll){var results=[];if(!utils.isFunction(filter)){var str=filter;filter=function(n){return-1!=utils.indexOf(utils.isArray(str)?str:str.split(" "),n.tagName.toLowerCase())}}return utils.each(nodelist,function(n){filter(n)&&results.push(n)}),0==results.length?null:1!=results.length&&forAll?results:results[0]},isInNodeEndBoundary:function(rng,node){var start=rng.startContainer;if(3==start.nodeType&&rng.startOffset!=start.nodeValue.length)return 0;if(1==start.nodeType&&rng.startOffset!=start.childNodes.length)return 0;for(;start!==node;){if(start.nextSibling)return 0;start=start.parentNode}return 1}},fillCharReg=RegExp(domUtils.fillChar,"g");(function(){function updateCollapse(range){range.collapsed=range.startContainer&&range.endContainer&&range.startContainer===range.endContainer&&range.startOffset==range.endOffset}function selectOneNode(rng){return!rng.collapsed&&1==rng.startContainer.nodeType&&rng.startContainer===rng.endContainer&&1==rng.endOffset-rng.startOffset}function setEndPoint(toStart,node,offset,range){return 1==node.nodeType&&(dtd.$empty[node.tagName]||dtd.$nonChild[node.tagName])&&(offset=domUtils.getNodeIndex(node)+(toStart?0:1),node=node.parentNode),toStart?(range.startContainer=node,range.startOffset=offset,range.endContainer||range.collapse(!0)):(range.endContainer=node,range.endOffset=offset,range.startContainer||range.collapse(!1)),updateCollapse(range),range}function execContentsAction(range,action){var tmpStart,tmpEnd,start=range.startContainer,end=range.endContainer,startOffset=range.startOffset,endOffset=range.endOffset,doc=range.document,frag=doc.createDocumentFragment();if(1==start.nodeType&&(start=start.childNodes[startOffset]||(tmpStart=start.appendChild(doc.createTextNode("")))),1==end.nodeType&&(end=end.childNodes[endOffset]||(tmpEnd=end.appendChild(doc.createTextNode("")))),start===end&&3==start.nodeType)return frag.appendChild(doc.createTextNode(start.substringData(startOffset,endOffset-startOffset))),action&&(start.deleteData(startOffset,endOffset-startOffset),range.collapse(!0)),frag;
for(var current,currentLevel,clone=frag,startParents=domUtils.findParents(start,!0),endParents=domUtils.findParents(end,!0),i=0;startParents[i]==endParents[i];)i++;for(var si,j=i;si=startParents[j];j++){for(current=si.nextSibling,si==start?tmpStart||(3==range.startContainer.nodeType?(clone.appendChild(doc.createTextNode(start.nodeValue.slice(startOffset))),action&&start.deleteData(startOffset,start.nodeValue.length-startOffset)):clone.appendChild(action?start:start.cloneNode(!0))):(currentLevel=si.cloneNode(!1),clone.appendChild(currentLevel));current&&current!==end&&current!==endParents[j];)si=current.nextSibling,clone.appendChild(action?current:current.cloneNode(!0)),current=si;clone=currentLevel}clone=frag,startParents[i]||(clone.appendChild(startParents[i-1].cloneNode(!1)),clone=clone.firstChild);for(var ei,j=i;ei=endParents[j];j++){if(current=ei.previousSibling,ei==end?tmpEnd||3!=range.endContainer.nodeType||(clone.appendChild(doc.createTextNode(end.substringData(0,endOffset))),action&&end.deleteData(0,endOffset)):(currentLevel=ei.cloneNode(!1),clone.appendChild(currentLevel)),j!=i||!startParents[i])for(;current&&current!==start;)ei=current.previousSibling,clone.insertBefore(action?current:current.cloneNode(!0),clone.firstChild),current=ei;clone=currentLevel}return action&&range.setStartBefore(endParents[i]?startParents[i]?endParents[i]:startParents[i-1]:endParents[i-1]).collapse(!0),tmpStart&&domUtils.remove(tmpStart),tmpEnd&&domUtils.remove(tmpEnd),frag}function removeFillData(doc,excludeNode){try{if(fillData&&domUtils.inDoc(fillData,doc))if(fillData.nodeValue.replace(fillCharReg,"").length)fillData.nodeValue=fillData.nodeValue.replace(fillCharReg,"");else{var tmpNode=fillData.parentNode;for(domUtils.remove(fillData);tmpNode&&domUtils.isEmptyInlineElement(tmpNode)&&(browser.safari?!(domUtils.getPosition(tmpNode,excludeNode)&domUtils.POSITION_CONTAINS):!tmpNode.contains(excludeNode));)fillData=tmpNode.parentNode,domUtils.remove(tmpNode),tmpNode=fillData}}catch(e){}}function mergeSibling(node,dir){var tmpNode;for(node=node[dir];node&&domUtils.isFillChar(node);)tmpNode=node[dir],domUtils.remove(node),node=tmpNode}var fillData,guid=0,fillChar=domUtils.fillChar,Range=dom.Range=function(document){var me=this;me.startContainer=me.startOffset=me.endContainer=me.endOffset=null,me.document=document,me.collapsed=!0};Range.prototype={cloneContents:function(){return this.collapsed?null:execContentsAction(this,0)},deleteContents:function(){var txt;return this.collapsed||execContentsAction(this,1),browser.webkit&&(txt=this.startContainer,3!=txt.nodeType||txt.nodeValue.length||(this.setStartBefore(txt).collapse(!0),domUtils.remove(txt))),this},extractContents:function(){return this.collapsed?null:execContentsAction(this,2)},setStart:function(node,offset){return setEndPoint(!0,node,offset,this)},setEnd:function(node,offset){return setEndPoint(!1,node,offset,this)},setStartAfter:function(node){return this.setStart(node.parentNode,domUtils.getNodeIndex(node)+1)},setStartBefore:function(node){return this.setStart(node.parentNode,domUtils.getNodeIndex(node))},setEndAfter:function(node){return this.setEnd(node.parentNode,domUtils.getNodeIndex(node)+1)},setEndBefore:function(node){return this.setEnd(node.parentNode,domUtils.getNodeIndex(node))},setStartAtFirst:function(node){return this.setStart(node,0)},setStartAtLast:function(node){return this.setStart(node,3==node.nodeType?node.nodeValue.length:node.childNodes.length)},setEndAtFirst:function(node){return this.setEnd(node,0)},setEndAtLast:function(node){return this.setEnd(node,3==node.nodeType?node.nodeValue.length:node.childNodes.length)},selectNode:function(node){return this.setStartBefore(node).setEndAfter(node)},selectNodeContents:function(node){return this.setStart(node,0).setEndAtLast(node)},cloneRange:function(){var me=this;return new Range(me.document).setStart(me.startContainer,me.startOffset).setEnd(me.endContainer,me.endOffset)},collapse:function(toStart){var me=this;return toStart?(me.endContainer=me.startContainer,me.endOffset=me.startOffset):(me.startContainer=me.endContainer,me.startOffset=me.endOffset),me.collapsed=!0,me},shrinkBoundary:function(ignoreEnd){function check(node){return 1==node.nodeType&&!domUtils.isBookmarkNode(node)&&!dtd.$empty[node.tagName]&&!dtd.$nonChild[node.tagName]}for(var child,me=this,collapsed=me.collapsed;1==me.startContainer.nodeType&&(child=me.startContainer.childNodes[me.startOffset])&&check(child);)me.setStart(child,0);if(collapsed)return me.collapse(!0);if(!ignoreEnd)for(;1==me.endContainer.nodeType&&me.endOffset>0&&(child=me.endContainer.childNodes[me.endOffset-1])&&check(child);)me.setEnd(child,child.childNodes.length);return me},getCommonAncestor:function(includeSelf,ignoreTextNode){var me=this,start=me.startContainer,end=me.endContainer;return start===end?includeSelf&&selectOneNode(this)&&(start=start.childNodes[me.startOffset],1==start.nodeType)?start:ignoreTextNode&&3==start.nodeType?start.parentNode:start:domUtils.getCommonAncestor(start,end)},trimBoundary:function(ignoreEnd){this.txtToElmBoundary();var start=this.startContainer,offset=this.startOffset,collapsed=this.collapsed,end=this.endContainer;if(3==start.nodeType){if(0==offset)this.setStartBefore(start);else if(offset>=start.nodeValue.length)this.setStartAfter(start);else{var textNode=domUtils.split(start,offset);start===end?this.setEnd(textNode,this.endOffset-offset):start.parentNode===end&&(this.endOffset+=1),this.setStartBefore(textNode)}if(collapsed)return this.collapse(!0)}return ignoreEnd||(offset=this.endOffset,end=this.endContainer,3==end.nodeType&&(0==offset?this.setEndBefore(end):(end.nodeValue.length>offset&&domUtils.split(end,offset),this.setEndAfter(end)))),this},txtToElmBoundary:function(){function adjust(r,c){var container=r[c+"Container"],offset=r[c+"Offset"];3==container.nodeType&&(offset?offset>=container.nodeValue.length&&r["set"+c.replace(/(\w)/,function(a){return a.toUpperCase()})+"After"](container):r["set"+c.replace(/(\w)/,function(a){return a.toUpperCase()})+"Before"](container))}return this.collapsed||(adjust(this,"start"),adjust(this,"end")),this},insertNode:function(node){var first=node,length=1;11==node.nodeType&&(first=node.firstChild,length=node.childNodes.length),this.trimBoundary(!0);var start=this.startContainer,offset=this.startOffset,nextNode=start.childNodes[offset];return nextNode?start.insertBefore(node,nextNode):start.appendChild(node),first.parentNode===this.endContainer&&(this.endOffset=this.endOffset+length),this.setStartBefore(first)},setCursor:function(toEnd,noFillData){return this.collapse(!toEnd).select(noFillData)},createBookmark:function(serialize,same){var endNode,startNode=this.document.createElement("span");return startNode.style.cssText="display:none;line-height:0px;",startNode.appendChild(this.document.createTextNode("﻿")),startNode.id="_baidu_bookmark_start_"+(same?"":guid++),this.collapsed||(endNode=startNode.cloneNode(!0),endNode.id="_baidu_bookmark_end_"+(same?"":guid++)),this.insertNode(startNode),endNode&&this.collapse().insertNode(endNode).setEndBefore(endNode),this.setStartAfter(startNode),{start:serialize?startNode.id:startNode,end:endNode?serialize?endNode.id:endNode:null,id:serialize}},moveToBookmark:function(bookmark){var start=bookmark.id?this.document.getElementById(bookmark.start):bookmark.start,end=bookmark.end&&bookmark.id?this.document.getElementById(bookmark.end):bookmark.end;return this.setStartBefore(start),domUtils.remove(start),end?(this.setEndBefore(end),domUtils.remove(end)):this.collapse(!0),this},enlarge:function(toBlock,stopFn){var pre,node,isBody=domUtils.isBody,tmp=this.document.createTextNode("");if(toBlock){for(node=this.startContainer,1==node.nodeType?node.childNodes[this.startOffset]?pre=node=node.childNodes[this.startOffset]:(node.appendChild(tmp),pre=node=tmp):pre=node;;){if(domUtils.isBlockElm(node)){for(node=pre;(pre=node.previousSibling)&&!domUtils.isBlockElm(pre);)node=pre;this.setStartBefore(node);break}pre=node,node=node.parentNode}for(node=this.endContainer,1==node.nodeType?((pre=node.childNodes[this.endOffset])?node.insertBefore(tmp,pre):node.appendChild(tmp),pre=node=tmp):pre=node;;){if(domUtils.isBlockElm(node)){for(node=pre;(pre=node.nextSibling)&&!domUtils.isBlockElm(pre);)node=pre;this.setEndAfter(node);break}pre=node,node=node.parentNode}tmp.parentNode===this.endContainer&&this.endOffset--,domUtils.remove(tmp)}if(!this.collapsed){for(;!(0!=this.startOffset||stopFn&&stopFn(this.startContainer)||isBody(this.startContainer));)this.setStartBefore(this.startContainer);for(;!(this.endOffset!=(1==this.endContainer.nodeType?this.endContainer.childNodes.length:this.endContainer.nodeValue.length)||stopFn&&stopFn(this.endContainer)||isBody(this.endContainer));)this.setEndAfter(this.endContainer)}return this},adjustmentBoundary:function(){if(!this.collapsed){for(;!domUtils.isBody(this.startContainer)&&this.startOffset==this.startContainer[3==this.startContainer.nodeType?"nodeValue":"childNodes"].length;)this.setStartAfter(this.startContainer);for(;!domUtils.isBody(this.endContainer)&&!this.endOffset;)this.setEndBefore(this.endContainer)}return this},applyInlineStyle:function(tagName,attrs,list){if(this.collapsed)return this;this.trimBoundary().enlarge(!1,function(node){return 1==node.nodeType&&domUtils.isBlockElm(node)}).adjustmentBoundary();for(var node,pre,bookmark=this.createBookmark(),end=bookmark.end,filterFn=function(node){return 1==node.nodeType?"br"!=node.tagName.toLowerCase():!domUtils.isWhitespace(node)},current=domUtils.getNextDomNode(bookmark.start,!1,filterFn),range=this.cloneRange();current&&domUtils.getPosition(current,end)&domUtils.POSITION_PRECEDING;)if(3==current.nodeType||dtd[tagName][current.tagName]){for(range.setStartBefore(current),node=current;node&&(3==node.nodeType||dtd[tagName][node.tagName])&&node!==end;)pre=node,node=domUtils.getNextDomNode(node,1==node.nodeType,null,function(parent){return dtd[tagName][parent.tagName]});var elm,frag=range.setEndAfter(pre).extractContents();if(list&&list.length>0){var level,top;top=level=list[0].cloneNode(!1);for(var ci,i=1;ci=list[i++];)level.appendChild(ci.cloneNode(!1)),level=level.firstChild;elm=level}else elm=range.document.createElement(tagName);attrs&&domUtils.setAttributes(elm,attrs),elm.appendChild(frag),range.insertNode(list?top:elm);var aNode;if("span"==tagName&&attrs.style&&/text\-decoration/.test(attrs.style)&&(aNode=domUtils.findParentByTagName(elm,"a",!0))?(domUtils.setAttributes(aNode,attrs),domUtils.remove(elm,!0),elm=aNode):(domUtils.mergeSibling(elm),domUtils.clearEmptySibling(elm)),domUtils.mergeChild(elm,attrs),current=domUtils.getNextDomNode(elm,!1,filterFn),domUtils.mergeToParent(elm),node===end)break}else current=domUtils.getNextDomNode(current,!0,filterFn);return this.moveToBookmark(bookmark)},removeInlineStyle:function(tagNames){if(this.collapsed)return this;tagNames=utils.isArray(tagNames)?tagNames:[tagNames],this.shrinkBoundary().adjustmentBoundary();for(var start=this.startContainer,end=this.endContainer;;){if(1==start.nodeType){if(utils.indexOf(tagNames,start.tagName.toLowerCase())>-1)break;if("body"==start.tagName.toLowerCase()){start=null;break}}start=start.parentNode}for(;;){if(1==end.nodeType){if(utils.indexOf(tagNames,end.tagName.toLowerCase())>-1)break;if("body"==end.tagName.toLowerCase()){end=null;break}}end=end.parentNode}var frag,tmpRange,bookmark=this.createBookmark();start&&(tmpRange=this.cloneRange().setEndBefore(bookmark.start).setStartBefore(start),frag=tmpRange.extractContents(),tmpRange.insertNode(frag),domUtils.clearEmptySibling(start,!0),start.parentNode.insertBefore(bookmark.start,start)),end&&(tmpRange=this.cloneRange().setStartAfter(bookmark.end).setEndAfter(end),frag=tmpRange.extractContents(),tmpRange.insertNode(frag),domUtils.clearEmptySibling(end,!1,!0),end.parentNode.insertBefore(bookmark.end,end.nextSibling));for(var next,current=domUtils.getNextDomNode(bookmark.start,!1,function(node){return 1==node.nodeType});current&&current!==bookmark.end;)next=domUtils.getNextDomNode(current,!0,function(node){return 1==node.nodeType}),utils.indexOf(tagNames,current.tagName.toLowerCase())>-1&&domUtils.remove(current,!0),current=next;return this.moveToBookmark(bookmark)},getClosedNode:function(){var node;if(!this.collapsed){var range=this.cloneRange().adjustmentBoundary().shrinkBoundary();if(selectOneNode(range)){var child=range.startContainer.childNodes[range.startOffset];child&&1==child.nodeType&&(dtd.$empty[child.tagName]||dtd.$nonChild[child.tagName])&&(node=child)}}return node},select:browser.ie?function(noFillData,textRange){var nativeRange;this.collapsed||this.shrinkBoundary();var node=this.getClosedNode();if(node&&!textRange){try{nativeRange=this.document.body.createControlRange(),nativeRange.addElement(node),nativeRange.select()}catch(e){}return this}var end,bookmark=this.createBookmark(),start=bookmark.start;if(nativeRange=this.document.body.createTextRange(),nativeRange.moveToElementText(start),nativeRange.moveStart("character",1),this.collapsed){if(!noFillData&&3!=this.startContainer.nodeType){var tmpText=this.document.createTextNode(fillChar),tmp=this.document.createElement("span");tmp.appendChild(this.document.createTextNode(fillChar)),start.parentNode.insertBefore(tmp,start),start.parentNode.insertBefore(tmpText,start),removeFillData(this.document,tmpText),fillData=tmpText,mergeSibling(tmp,"previousSibling"),mergeSibling(start,"nextSibling"),nativeRange.moveStart("character",-1),nativeRange.collapse(!0)}}else{var nativeRangeEnd=this.document.body.createTextRange();end=bookmark.end,nativeRangeEnd.moveToElementText(end),nativeRange.setEndPoint("EndToEnd",nativeRangeEnd)}this.moveToBookmark(bookmark),tmp&&domUtils.remove(tmp);try{nativeRange.select()}catch(e){}return this}:function(notInsertFillData){var txtNode,win=domUtils.getWindow(this.document),sel=win.getSelection();if(browser.gecko?this.document.body.focus():win.focus(),sel){if(sel.removeAllRanges(),this.collapsed){if(notInsertFillData&&browser.opera&&!domUtils.isBody(this.startContainer)&&1==this.startContainer.nodeType){var tmp=this.document.createTextNode("");this.insertNode(tmp).setStart(tmp,0).collapse(!0)}notInsertFillData||3==this.startContainer.nodeType&&(0!=this.startOffset||this.startContainer.previousSibling&&3==this.startContainer.previousSibling.nodeType)||(txtNode=this.document.createTextNode(fillChar),this.insertNode(txtNode),removeFillData(this.document,txtNode),mergeSibling(txtNode,"previousSibling"),mergeSibling(txtNode,"nextSibling"),fillData=txtNode,this.setStart(txtNode,browser.webkit?1:0).collapse(!0))}var nativeRange=this.document.createRange();nativeRange.setStart(this.startContainer,this.startOffset),nativeRange.setEnd(this.endContainer,this.endOffset),sel.addRange(nativeRange)}return this},scrollToView:function(win,offset){win=win?window:domUtils.getWindow(this.document);var me=this,span=me.document.createElement("span");return span.innerHTML="&nbsp;",me.cloneRange().insertNode(span),domUtils.scrollToView(span,win,offset),domUtils.remove(span),me}}})(),function(){function getBoundaryInformation(range,start){var getIndex=domUtils.getNodeIndex;range=range.duplicate(),range.collapse(start);var parent=range.parentElement();if(!parent.hasChildNodes())return{container:parent,offset:0};for(var child,distance,siblings=parent.children,testRange=range.duplicate(),startIndex=0,endIndex=siblings.length-1,index=-1;endIndex>=startIndex;){index=Math.floor((startIndex+endIndex)/2),child=siblings[index],testRange.moveToElementText(child);var position=testRange.compareEndPoints("StartToStart",range);if(position>0)endIndex=index-1;else{if(!(0>position))return{container:parent,offset:getIndex(child)};startIndex=index+1}}if(-1==index){if(testRange.moveToElementText(parent),testRange.setEndPoint("StartToStart",range),distance=testRange.text.replace(/(\r\n|\r)/g,"\n").length,siblings=parent.childNodes,!distance)return child=siblings[siblings.length-1],{container:child,offset:child.nodeValue.length};for(var i=siblings.length;distance>0;)distance-=siblings[--i].nodeValue.length;return{container:siblings[i],offset:-distance}}if(testRange.collapse(position>0),testRange.setEndPoint(position>0?"StartToStart":"EndToStart",range),distance=testRange.text.replace(/(\r\n|\r)/g,"\n").length,!distance)return dtd.$empty[child.tagName]||dtd.$nonChild[child.tagName]?{container:parent,offset:getIndex(child)+(position>0?0:1)}:{container:child,offset:position>0?0:child.childNodes.length};for(;distance>0;)try{var pre=child;child=child[position>0?"previousSibling":"nextSibling"],distance-=child.nodeValue.length}catch(e){return{container:parent,offset:getIndex(pre)}}return{container:child,offset:position>0?-distance:child.nodeValue.length+distance}}function transformIERangeToRange(ieRange,range){if(ieRange.item)range.selectNode(ieRange.item(0));else{var bi=getBoundaryInformation(ieRange,!0);range.setStart(bi.container,bi.offset),0!=ieRange.compareEndPoints("StartToEnd",ieRange)&&(bi=getBoundaryInformation(ieRange,!1),range.setEnd(bi.container,bi.offset))}return range}function _getIERange(sel){var ieRange;try{ieRange=sel.getNative().createRange()}catch(e){return null}var el=ieRange.item?ieRange.item(0):ieRange.parentElement();return(el.ownerDocument||el)===sel.document?ieRange:null}var Selection=dom.Selection=function(doc){var iframe,me=this;me.document=doc,ie&&(iframe=domUtils.getWindow(doc).frameElement,domUtils.on(iframe,"beforedeactivate",function(){me._bakIERange=me.getIERange()}),domUtils.on(iframe,"activate",function(){try{!_getIERange(me)&&me._bakIERange&&me._bakIERange.select()}catch(ex){}me._bakIERange=null})),iframe=doc=null};Selection.prototype={getNative:function(){var doc=this.document;try{return doc?ie?doc.selection:domUtils.getWindow(doc).getSelection():null}catch(e){return null}},getIERange:function(){var ieRange=_getIERange(this);return!ieRange&&this._bakIERange?this._bakIERange:ieRange},cache:function(){this.clear(),this._cachedRange=this.getRange(),this._cachedStartElement=this.getStart(),this._cachedStartElementPath=this.getStartElementPath()},getStartElementPath:function(){if(this._cachedStartElementPath)return this._cachedStartElementPath;var start=this.getStart();return start?domUtils.findParents(start,!0,null,!0):[]},clear:function(){this._cachedStartElementPath=this._cachedRange=this._cachedStartElement=null},isFocus:function(){try{return browser.ie&&_getIERange(this)||!browser.ie&&this.getNative().rangeCount?!0:!1}catch(e){return!1}},getRange:function(){function optimze(range){for(var child=me.document.body.firstChild,collapsed=range.collapsed;child&&child.firstChild;)range.setStart(child,0),child=child.firstChild;range.startContainer||range.setStart(me.document.body,0),collapsed&&range.collapse(!0)}var me=this;if(null!=me._cachedRange)return this._cachedRange;var range=new baidu.editor.dom.Range(me.document);if(ie){var nativeRange=me.getIERange();nativeRange?transformIERangeToRange(nativeRange,range):optimze(range)}else{var sel=me.getNative();if(sel&&sel.rangeCount){var firstRange=sel.getRangeAt(0),lastRange=sel.getRangeAt(sel.rangeCount-1);range.setStart(firstRange.startContainer,firstRange.startOffset).setEnd(lastRange.endContainer,lastRange.endOffset),range.collapsed&&domUtils.isBody(range.startContainer)&&!range.startOffset&&optimze(range)}else{if(this._bakRange&&domUtils.inDoc(this._bakRange.startContainer,this.document))return this._bakRange;optimze(range)}}return this._bakRange=range},getStart:function(){if(this._cachedStartElement)return this._cachedStartElement;var tmpRange,start,tmp,parent,range=ie?this.getIERange():this.getRange();if(ie){if(!range)return this.document.body.firstChild;if(range.item)return range.item(0);for(tmpRange=range.duplicate(),tmpRange.text.length>0&&tmpRange.moveStart("character",1),tmpRange.collapse(1),start=tmpRange.parentElement(),parent=tmp=range.parentElement();tmp=tmp.parentNode;)if(tmp==start){start=parent;break}}else if(range.shrinkBoundary(),start=range.startContainer,1==start.nodeType&&start.hasChildNodes()&&(start=start.childNodes[Math.min(start.childNodes.length-1,range.startOffset)]),3==start.nodeType)return start.parentNode;return start},getText:function(){var nativeSel,nativeRange;return this.isFocus()&&(nativeSel=this.getNative())?(nativeRange=browser.ie?nativeSel.createRange():nativeSel.getRangeAt(0),browser.ie?nativeRange.text:""+nativeRange):""}}}(),function(){function replaceSrc(div){for(var orgSrc,img,imgs=div.getElementsByTagName("img"),i=0;img=imgs[i++];)(orgSrc=img.getAttribute("orgSrc"))&&(img.src=orgSrc,img.removeAttribute("orgSrc"));for(var ai,as=div.getElementsByTagName("a"),i=0;ai=as[i++];i++)ai.getAttribute("data_ue_src")&&ai.setAttribute("href",ai.getAttribute("data_ue_src"))}function setValue(form,editor){var textarea;if(editor.textarea)if(utils.isString(editor.textarea)){for(var ti,i=0,tis=domUtils.getElementsByTagName(form,"textarea");ti=tis[i++];)if(ti.id=="ueditor_textarea_"+editor.options.textarea){textarea=ti;break}}else textarea=editor.textarea;textarea||(form.appendChild(textarea=domUtils.createElement(document,"textarea",{name:editor.options.textarea,id:"ueditor_textarea_"+editor.options.textarea,style:"display:none"})),editor.textarea=textarea),textarea.value=editor.hasContents()?editor.options.allHtmlEnabled?editor.getAllHtml():editor.getContent(null,null,!0):""}var _selectionChangeTimer,uid=0,Editor=UE.Editor=function(options){var me=this;me.uid=uid++,EventBase.call(me),me.commands={},me.options=utils.extend(utils.clone(options||{}),UEDITOR_CONFIG,!0),me.setOpt({isShow:!0,initialContent:"欢迎使用ueditor!",autoClearinitialContent:!1,iframeCssUrl:me.options.UEDITOR_HOME_URL+"themes/iframe.css",textarea:"editorValue",focus:!1,initialFrameWidth:1e3,initialFrameHeight:me.options.minFrameHeight||320,minFrameWidth:800,minFrameHeight:220,autoClearEmptyNode:!0,fullscreen:!1,readonly:!1,zIndex:999,imagePopup:!0,enterTag:"p",pageBreakTag:"_baidu_page_break_tag_",customDomain:!1,lang:"zh-cn",langPath:me.options.UEDITOR_HOME_URL+"lang/",theme:"default",themePath:me.options.UEDITOR_HOME_URL+"themes/",allHtmlEnabled:!1,scaleEnabled:!1,tableNativeEditInFF:!1}),utils.loadFile(document,{src:me.options.langPath+me.options.lang+"/"+me.options.lang+".js",tag:"script",type:"text/javascript",defer:"defer"},function(){for(var pi in UE.plugins)UE.plugins[pi].call(me);me.langIsReady=!0,me.fireEvent("langReady")}),UE.instants["ueditorInstant"+me.uid]=me};Editor.prototype={ready:function(fn){var me=this;fn&&(me.isReady?fn.apply(me):me.addListener("ready",fn))},setOpt:function(key,val){var obj={};utils.isString(key)?obj[key]=val:obj=key,utils.extend(this.options,obj,!0)},destroy:function(){var me=this;me.fireEvent("destroy");var container=me.container.parentNode,textarea=me.textarea;textarea?textarea.style.display="":(textarea=document.createElement("textarea"),container.parentNode.insertBefore(textarea,container)),textarea.style.width=container.offsetWidth+"px",textarea.style.height=container.offsetHeight+"px",textarea.value=me.getContent(),textarea.id=me.key,container.innerHTML="",domUtils.remove(container);var key=me.key;for(var p in me)me.hasOwnProperty(p)&&delete this[p];UE.delEditor(key)},render:function(container){var me=this,options=me.options;if(utils.isString(container)&&(container=document.getElementById(container)),container){var useBodyAsViewport=ie&&9>browser.version,html=(ie&&9>browser.version?"":"<!DOCTYPE html>")+"<html xmlns='http://www.w3.org/1999/xhtml'"+(useBodyAsViewport?"":" class='view'")+"><head>"+(options.iframeCssUrl?"<link rel='stylesheet' type='text/css' href='"+utils.unhtml(options.iframeCssUrl)+"'/>":"")+"<style type='text/css'>"+".view{padding:0;word-wrap:break-word;cursor:text;height:100%;}\n"+"body{margin:8px;font-family:sans-serif;font-size:16px;}"+"p{margin:5px 0;}"+(options.initialStyle||"")+"</style></head><body"+(useBodyAsViewport?" class='view'":"")+"></body>";if(options.customDomain&&document.domain!=location.hostname)html+="<script>window.parent.UE.instants['ueditorInstant"+me.uid+"']._setup(document);</script></html>",container.appendChild(domUtils.createElement(document,"iframe",{id:"baidu_editor_"+me.uid,width:"100%",height:"100%",frameborder:"0",src:'javascript:void(function(){document.open();document.domain="'+document.domain+'";'+'document.write("'+html+'");document.close();}())'}));else{container.innerHTML='<iframe id="baidu_editor_'+this.uid+'"'+'width="100%" height="100%" scroll="no" frameborder="0" ></iframe>';var doc=container.firstChild.contentWindow.document;doc.open(),doc.write(html+"</html>"),doc.close(),me._setup(doc)}container.style.overflow="hidden"}},_setup:function(doc){var me=this,options=me.options;ie?(doc.body.disabled=!0,doc.body.contentEditable=!0,doc.body.disabled=!1):(doc.body.contentEditable=!0,doc.body.spellcheck=!1),me.document=doc,me.window=doc.defaultView||doc.parentWindow,me.iframe=me.window.frameElement,me.body=doc.body,me.setHeight(Math.max(options.minFrameHeight,options.initialFrameHeight)),me.selection=new dom.Selection(doc);var geckoSel;if(browser.gecko&&(geckoSel=this.selection.getNative())&&geckoSel.removeAllRanges(),this._initEvents(),options.initialContent)if(options.autoClearinitialContent){var oldExecCommand=me.execCommand;me.execCommand=function(){me.fireEvent("firstBeforeExecCommand"),oldExecCommand.apply(me,arguments)},this._setDefaultContent(options.initialContent)}else this.setContent(options.initialContent,!0);for(var form=this.iframe.parentNode;!domUtils.isBody(form);form=form.parentNode)if("FORM"==form.tagName){domUtils.on(form,"submit",function(){setValue(this,me)});break}domUtils.isEmptyNode(me.body)&&(me.body.innerHTML="<p>"+(browser.ie?"":"<br/>")+"</p>"),options.focus&&setTimeout(function(){me.focus(),!me.options.autoClearinitialContent&&me._selectionChange()},0),me.container||(me.container=this.iframe.parentNode),options.fullscreen&&me.ui&&me.ui.setFullScreen(!0);try{me.document.execCommand("2D-position",!1,!1)}catch(e){}try{me.document.execCommand("enableInlineTableEditing",!1,options.tableNativeEditInFF)}catch(e){}try{me.document.execCommand("enableObjectResizing",!1,!1)}catch(e){domUtils.on(me.body,browser.ie?"resizestart":"resize",function(evt){domUtils.preventDefault(evt)})}me.isReady=1,me.fireEvent("ready"),options.onready&&options.onready.call(me),browser.ie||domUtils.on(me.window,["blur","focus"],function(e){if("blur"==e.type){me._bakRange=me.selection.getRange();try{me.selection.getNative().removeAllRanges()}catch(e){}}else try{me._bakRange&&me._bakRange.select()}catch(e){}}),browser.gecko&&10902>=browser.version&&(me.body.contentEditable=!1,setTimeout(function(){me.body.contentEditable=!0},100),setInterval(function(){me.body.style.height=me.iframe.offsetHeight-20+"px"},100)),!options.isShow&&me.setHide(),options.readonly&&me.setDisabled()},sync:function(formId){var me=this,form=formId?document.getElementById(formId):domUtils.findParent(me.iframe.parentNode,function(node){return"FORM"==node.tagName},!0);form&&setValue(form,me)},setHeight:function(height){height!==parseInt(this.iframe.parentNode.style.height)&&(this.iframe.parentNode.style.height=height+"px"),this.document.body.style.height=height-20+"px"},getContent:function(cmd,fn,isPreview){var me=this;if(cmd&&utils.isFunction(cmd)&&(fn=cmd,cmd=""),fn?!fn():!this.hasContents())return"";me.fireEvent("beforegetcontent",cmd);var reg=RegExp(domUtils.fillChar,"g"),html=me.body.innerHTML.replace(reg,"").replace(/>[\t\r\n]*?</g,"><");if(me.fireEvent("aftergetcontent",cmd),me.serialize){var node=me.serialize.parseHTML(html);node=me.serialize.transformOutput(node),html=me.serialize.toHTML(node)}return html=ie&&isPreview?html.replace(/<p>\s*?<\/p>/g,"<p>&nbsp;</p>"):html.replace(/(&nbsp;)+/g,function(s){for(var i=0,str=[],l=s.split(";").length-1;l>i;i++)str.push(0==i%2?" ":"&nbsp;");return str.join("")})},getAllHtml:function(){var me=this,headHtml={html:""};return me.fireEvent("getAllHtml",headHtml),"<html><head>"+(me.options.charset?'<meta http-equiv="Content-Type" content="text/html; charset='+me.options.charset+'"/>':"")+me.document.getElementsByTagName("head")[0].innerHTML+headHtml.html+"</head>"+"<body "+(ie&&9>browser.version?'class="view"':"")+">"+me.getContent(null,null,!0)+"</body></html>"},getPlainTxt:function(){var reg=RegExp(domUtils.fillChar,"g"),html=this.body.innerHTML.replace(/[\n\r]/g,"");return html=html.replace(/<(p|div)[^>]*>(<br\/?>|&nbsp;)<\/\1>/gi,"\n").replace(/<br\/?>/gi,"\n").replace(/<[^>/]+>/g,"").replace(/(\n)?<\/([^>]+)>/g,function(a,b,c){return dtd.$block[c]?"\n":b?b:""}),html.replace(reg,"").replace(/\u00a0/g," ").replace(/&nbsp;/g," ")},getContentTxt:function(){var reg=RegExp(domUtils.fillChar,"g");return this.body[browser.ie?"innerText":"textContent"].replace(reg,"").replace(/\u00a0/g," ")},setContent:function(html,notFireSelectionchange){var lastTagName,me=this,inline=utils.extend({a:1,A:1},dtd.$inline,!0);html=html.replace(/^[ \t\r\n]*?</,"<").replace(/>[ \t\r\n]*?$/,">").replace(/>[\t\r\n]*?</g,"><").replace(/[\s\/]?(\w+)?>[ \t\r\n]*?<\/?(\w+)/gi,function(a,b,c){return b?lastTagName=c:b=lastTagName,inline[b]||inline[c]?a:a.replace(/>[ \t\r\n]*?</,"><")}),html={html:html},me.fireEvent("beforesetcontent",html),html=html.html;var serialize=this.serialize;if(serialize){var node=serialize.parseHTML(html);node=serialize.transformInput(node),node=serialize.filter(node),html=serialize.toHTML(node)}if(this.body.innerHTML=html.replace(RegExp("[\r"+domUtils.fillChar+"]*","g"),""),browser.ie&&7>browser.version&&replaceSrc(this.document.body),"p"==me.options.enterTag){var tmpNode,child=this.body.firstChild;if(!child||1==child.nodeType&&(dtd.$cdata[child.tagName]||domUtils.isCustomeNode(child))&&child===this.body.lastChild)this.body.innerHTML="<p>"+(browser.ie?"&nbsp;":"<br/>")+"</p>"+this.body.innerHTML;else for(var p=me.document.createElement("p");child;){for(;child&&(3==child.nodeType||1==child.nodeType&&dtd.p[child.tagName]&&!dtd.$cdata[child.tagName]);)tmpNode=child.nextSibling,p.appendChild(child),child=tmpNode;if(p.firstChild){if(!child){me.body.appendChild(p);break}me.body.insertBefore(p,child),p=me.document.createElement("p")}child=child.nextSibling}}me.fireEvent("aftersetcontent"),me.fireEvent("contentchange"),!notFireSelectionchange&&me._selectionChange(),me._bakRange=me._bakIERange=null;var geckoSel;browser.gecko&&(geckoSel=this.selection.getNative())&&geckoSel.removeAllRanges()},focus:function(toEnd){try{var me=this,rng=me.selection.getRange();toEnd?rng.setStartAtLast(me.body.lastChild).setCursor(!1,!0):rng.select(!0)}catch(e){}},_initEvents:function(){var me=this,doc=me.document,win=me.window;me._proxyDomEvent=utils.bind(me._proxyDomEvent,me),domUtils.on(doc,["click","contextmenu","mousedown","keydown","keyup","keypress","mouseup","mouseover","mouseout","selectstart"],me._proxyDomEvent),domUtils.on(win,["focus","blur"],me._proxyDomEvent),domUtils.on(doc,["mouseup","keydown"],function(evt){"keydown"==evt.type&&(evt.ctrlKey||evt.metaKey||evt.shiftKey||evt.altKey)||2!=evt.button&&me._selectionChange(250,evt)});var dragoverHandler,innerDrag=0,source=browser.ie?me.body:me.document;domUtils.on(source,"dragstart",function(){innerDrag=1}),domUtils.on(source,browser.webkit?"dragover":"drop",function(){return browser.webkit?function(){clearTimeout(dragoverHandler),dragoverHandler=setTimeout(function(){if(!innerDrag){var sel=me.selection,range=sel.getRange();if(range){var common=range.getCommonAncestor();if(common&&me.serialize){var f=me.serialize,node=f.filter(f.transformInput(f.parseHTML(f.word(common.innerHTML))));common.innerHTML=f.toHTML(node)}}}innerDrag=0},200)}:function(e){innerDrag||(e.preventDefault?e.preventDefault():e.returnValue=!1),innerDrag=0}}())},_proxyDomEvent:function(evt){return this.fireEvent(evt.type.replace(/^on/,""),evt)},_selectionChange:function(delay,evt){var mouseX,mouseY,me=this,hackForMouseUp=!1;if(browser.ie&&9>browser.version&&evt&&"mouseup"==evt.type){var range=this.selection.getRange();range.collapsed||(hackForMouseUp=!0,mouseX=evt.clientX,mouseY=evt.clientY)
}clearTimeout(_selectionChangeTimer),_selectionChangeTimer=setTimeout(function(){if(me.selection.getNative()){var ieRange;if(hackForMouseUp&&"None"==me.selection.getNative().type){ieRange=me.document.body.createTextRange();try{ieRange.moveToPoint(mouseX,mouseY)}catch(ex){ieRange=null}}var bakGetIERange;ieRange&&(bakGetIERange=me.selection.getIERange,me.selection.getIERange=function(){return ieRange}),me.selection.cache(),bakGetIERange&&(me.selection.getIERange=bakGetIERange),me.selection._cachedRange&&me.selection._cachedStartElement&&(me.fireEvent("beforeselectionchange"),me.fireEvent("selectionchange",!!evt),me.fireEvent("afterselectionchange"),me.selection.clear())}},delay||50)},_callCmdFn:function(fnName,args){var cmd,cmdFn,cmdName=args[0].toLowerCase();return cmd=this.commands[cmdName]||UE.commands[cmdName],cmdFn=cmd&&cmd[fnName],cmd&&cmdFn||"queryCommandState"!=fnName?cmdFn?cmdFn.apply(this,args):void 0:0},execCommand:function(cmdName){cmdName=cmdName.toLowerCase();var result,me=this,cmd=me.commands[cmdName]||UE.commands[cmdName];return cmd&&cmd.execCommand?(cmd.notNeedUndo||me.__hasEnterExecCommand?result=this._callCmdFn("execCommand",arguments):(me.__hasEnterExecCommand=!0,-1!=me.queryCommandState(cmdName)&&(me.fireEvent("beforeexeccommand",cmdName),result=this._callCmdFn("execCommand",arguments),me.fireEvent("afterexeccommand",cmdName)),me.__hasEnterExecCommand=!1),!me.__hasEnterExecCommand&&me._selectionChange(),result):null},queryCommandState:function(){return this._callCmdFn("queryCommandState",arguments)},queryCommandValue:function(){return this._callCmdFn("queryCommandValue",arguments)},hasContents:function(tags){if(tags)for(var ci,i=0;ci=tags[i++];)if(this.document.getElementsByTagName(ci).length>0)return!0;if(!domUtils.isEmptyBlock(this.body))return!0;for(tags=["div"],i=0;ci=tags[i++];)for(var cn,nodes=domUtils.getElementsByTagName(this.document,ci),n=0;cn=nodes[n++];)if(domUtils.isCustomeNode(cn))return!0;return!1},reset:function(){this.fireEvent("reset")},setEnabled:function(){var range,me=this;if("false"==me.body.contentEditable){me.body.contentEditable=!0,range=me.selection.getRange();try{range.moveToBookmark(me.lastBk),delete me.lastBk}catch(e){range.setStartAtFirst(me.body).collapse(!0)}range.select(!0),me.bkqueryCommandState&&(me.queryCommandState=me.bkqueryCommandState,delete me.bkqueryCommandState),me.fireEvent("selectionchange")}},enable:function(){return this.setEnabled()},setDisabled:function(except){var me=this;except=except?utils.isArray(except)?except:[except]:[],"true"==me.body.contentEditable&&(me.lastBk||(me.lastBk=me.selection.getRange().createBookmark(!0)),me.body.contentEditable=!1,me.bkqueryCommandState=me.queryCommandState,me.queryCommandState=function(type){return-1!=utils.indexOf(except,type)?me.bkqueryCommandState.apply(me,arguments):-1},me.fireEvent("selectionchange"))},disable:function(except){return this.setDisabled(except)},_setDefaultContent:function(){function clear(){var me=this;me.document.getElementById("initContent")&&(me.body.innerHTML="<p>"+(ie?"":"<br/>")+"</p>",me.removeListener("firstBeforeExecCommand focus",clear),setTimeout(function(){me.focus(),me._selectionChange()},0))}return function(cont){var me=this;me.body.innerHTML='<p id="initContent">'+cont+"</p>",browser.ie&&7>browser.version&&replaceSrc(me.body),me.addListener("firstBeforeExecCommand focus",clear)}}(),setShow:function(){var me=this,range=me.selection.getRange();if("none"==me.container.style.display){try{range.moveToBookmark(me.lastBk),delete me.lastBk}catch(e){range.setStartAtFirst(me.body).collapse(!0)}setTimeout(function(){range.select(!0)},100),me.container.style.display=""}},show:function(){return this.setShow()},setHide:function(){var me=this;me.lastBk||(me.lastBk=me.selection.getRange().createBookmark(!0)),me.container.style.display="none"},hide:function(){return this.setHide()},getLang:function(path){var lang=UE.I18N[this.options.lang];path=(path||"").split(".");for(var ci,i=0;(ci=path[i++])&&(lang=lang[ci],lang););return lang}},utils.inherits(Editor,EventBase)}();var filterWord=UE.filterWord=function(){function isWordDocument(str){return/(class="?Mso|style="[^"]*\bmso\-|w:WordDocument|<v:)/gi.test(str)}function transUnit(v){return v=v.replace(/[\d.]+\w+/g,function(m){return utils.transUnitToPx(m)})}function filterPasteWord(str){return str.replace(/[\t\r\n]+/g,"").replace(/<!--[\s\S]*?-->/gi,"").replace(/<v:shape [^>]*>[\s\S]*?.<\/v:shape>/gi,function(str){if(browser.opera)return"";try{var width=str.match(/width:([ \d.]*p[tx])/i)[1],height=str.match(/height:([ \d.]*p[tx])/i)[1],src=str.match(/src=\s*"([^"]*)"/i)[1];return'<img width="'+transUnit(width)+'" height="'+transUnit(height)+'" src="'+src+'" />'}catch(e){return""}}).replace(/<\/?div[^>]*>/g,"").replace(/v:\w+=(["']?)[^'"]+\1/g,"").replace(/<(!|script[^>]*>.*?<\/script(?=[>\s])|\/?(\?xml(:\w+)?|xml|meta|link|style|\w+:\w+)(?=[\s\/>]))[^>]*>/gi,"").replace(/<p [^>]*class="?MsoHeading"?[^>]*>(.*?)<\/p>/gi,"<p><strong>$1</strong></p>").replace(/\s+(class|lang|align)\s*=\s*(['"]?)[\w-]+\2/gi,"").replace(/<(font|span)[^>]*>\s*<\/\1>/gi,"").replace(/(<[a-z][^>]*)\sstyle=(["'])([^\2]*?)\2/gi,function(str,tag,tmp,style){for(var v,n=[],s=style.replace(/^\s+|\s+$/,"").replace(/&#39;/g,"'").replace(/&quot;/gi,"'").split(/;\s*/g),i=0;v=s[i];i++){var name,value,parts=v.split(":");if(2==parts.length){if(name=parts[0].toLowerCase(),value=parts[1].toLowerCase(),/^(background)\w*/.test(name)&&0==value.replace(/(initial|\s)/g,"").length||/^(margin)\w*/.test(name)&&/^0\w+$/.test(value))continue;switch(name){case"mso-padding-alt":case"mso-padding-top-alt":case"mso-padding-right-alt":case"mso-padding-bottom-alt":case"mso-padding-left-alt":case"mso-margin-alt":case"mso-margin-top-alt":case"mso-margin-right-alt":case"mso-margin-bottom-alt":case"mso-margin-left-alt":case"mso-height":case"mso-width":case"mso-vertical-align-alt":/<table/.test(tag)||(n[i]=name.replace(/^mso-|-alt$/g,"")+":"+transUnit(value));continue;case"horiz-align":n[i]="text-align:"+value;continue;case"vert-align":n[i]="vertical-align:"+value;continue;case"font-color":case"mso-foreground":n[i]="color:"+value;continue;case"mso-background":case"mso-highlight":n[i]="background:"+value;continue;case"mso-default-height":n[i]="min-height:"+transUnit(value);continue;case"mso-default-width":n[i]="min-width:"+transUnit(value);continue;case"mso-padding-between-alt":n[i]="border-collapse:separate;border-spacing:"+transUnit(value);continue;case"text-line-through":("single"==value||"double"==value)&&(n[i]="text-decoration:line-through");continue;case"mso-zero-height":"yes"==value&&(n[i]="display:none");continue;case"background":break;case"margin":if(!/[1-9]/.test(value))continue}if(/^(mso|column|font-emph|lang|layout|line-break|list-image|nav|panose|punct|row|ruby|sep|size|src|tab-|table-border|text-(?:decor|trans)|top-bar|version|vnd|word-break)/.test(name)||/text\-indent|padding|margin/.test(name)&&/\-[\d.]+/.test(value))continue;n[i]=name+":"+parts[1]}}return tag+(n.length?' style="'+n.join(";").replace(/;{2,}/g,";")+'"':"")}).replace(/[\d.]+(cm|pt)/g,function(str){return utils.transUnitToPx(str)})}return function(html){return(isWordDocument(html)?filterPasteWord(html):html).replace(/>[ \t\r\n]*</g,"><")}}();UE.commands.inserthtml={execCommand:function(command,html,notSerialize){var range,div,me=this,tds=me.currentSelectedArr;range=me.selection.getRange(),div=range.document.createElement("div"),div.style.display="inline";var serialize=me.serialize;if(!notSerialize&&serialize){var node=serialize.parseHTML(html);node=serialize.transformInput(node),node=serialize.filter(node),html=serialize.toHTML(node)}div.innerHTML=utils.trim(html);try{me.adjustTable&&me.adjustTable(div)}catch(e){}if(tds&&tds.length){for(var ti,i=0;ti=tds[i++];)ti.className="";tds[0].innerHTML="",range.setStart(tds[0],0).collapse(!0),me.currentSelectedArr=[]}if(!range.collapsed&&(range.deleteContents(),1==range.startContainer.nodeType)){var pre,child=range.startContainer.childNodes[range.startOffset];if(child&&domUtils.isBlockElm(child)&&(pre=child.previousSibling)&&domUtils.isBlockElm(pre)){for(range.setEnd(pre,pre.childNodes.length).collapse();child.firstChild;)pre.appendChild(child.firstChild);domUtils.remove(child)}}for(var child,parent,pre,tmp,hadBreak=0;child=div.firstChild;){if(range.insertNode(child),!hadBreak&&child.nodeType==domUtils.NODE_ELEMENT&&domUtils.isBlockElm(child)&&(parent=domUtils.findParent(child,function(node){return domUtils.isBlockElm(node)}),parent&&"body"!=parent.tagName.toLowerCase()&&(!dtd[parent.tagName][child.nodeName]||child.parentNode!==parent))){if(dtd[parent.tagName][child.nodeName])for(tmp=child.parentNode;tmp!==parent;)pre=tmp,tmp=tmp.parentNode;else pre=parent;domUtils.breakParent(child,pre||tmp);var pre=child.previousSibling;domUtils.trimWhiteTextNode(pre),pre.childNodes.length||domUtils.remove(pre),!browser.ie&&(next=child.nextSibling)&&domUtils.isBlockElm(next)&&next.lastChild&&!domUtils.isBr(next.lastChild)&&next.appendChild(me.document.createElement("br")),hadBreak=1}var next=child.nextSibling;if(!div.firstChild&&next&&domUtils.isBlockElm(next)){range.setStart(next,0).collapse(!0);break}range.setEndAfter(child).collapse()}child=range.startContainer,domUtils.isBlockElm(child)&&domUtils.isEmptyNode(child)&&(child.innerHTML=browser.ie?"":"<br/>"),range.select(!0),setTimeout(function(){range=me.selection.getRange(),range.scrollToView(me.autoHeightEnabled,me.autoHeightEnabled?domUtils.getXY(me.iframe).y:0)},200)}},function(){var block=domUtils.isBlockElm,defaultValue={left:1,right:1,center:1,justify:1},doJustify=function(range,style){var bookmark=range.createBookmark(),filterFn=function(node){return 1==node.nodeType?"br"!=node.tagName.toLowerCase()&&!domUtils.isBookmarkNode(node):!domUtils.isWhitespace(node)};range.enlarge(!0);for(var tmpNode,bookmark2=range.createBookmark(),current=domUtils.getNextDomNode(bookmark2.start,!1,filterFn),tmpRange=range.cloneRange();current&&!(domUtils.getPosition(current,bookmark2.end)&domUtils.POSITION_FOLLOWING);)if(3!=current.nodeType&&block(current))current=domUtils.getNextDomNode(current,!0,filterFn);else{for(tmpRange.setStartBefore(current);current&&current!==bookmark2.end&&!block(current);)tmpNode=current,current=domUtils.getNextDomNode(current,!1,null,function(node){return!block(node)});tmpRange.setEndAfter(tmpNode);var common=tmpRange.getCommonAncestor();if(!domUtils.isBody(common)&&block(common))domUtils.setStyles(common,utils.isString(style)?{"text-align":style}:style),current=common;else{var p=range.document.createElement("p");domUtils.setStyles(p,utils.isString(style)?{"text-align":style}:style);var frag=tmpRange.extractContents();p.appendChild(frag),tmpRange.insertNode(p),current=p}current=domUtils.getNextDomNode(current,!1,filterFn)}return range.moveToBookmark(bookmark2).moveToBookmark(bookmark)};UE.commands.justify={execCommand:function(cmdName,align){var txt,range=this.selection.getRange();if(this.currentSelectedArr&&this.currentSelectedArr.length>0){for(var ti,i=0;ti=this.currentSelectedArr[i++];)domUtils.isEmptyNode(ti)?(txt=this.document.createTextNode("p"),range.setStart(ti,0).collapse(!0).insertNode(txt).selectNode(txt)):range.selectNodeContents(ti),doJustify(range,align.toLowerCase()),txt&&domUtils.remove(txt);range.selectNode(this.currentSelectedArr[0]).select()}else range.collapsed&&(txt=this.document.createTextNode("p"),range.insertNode(txt)),doJustify(range,align),txt&&(range.setStartBefore(txt).collapse(!0),domUtils.remove(txt)),range.select();return!0},queryCommandValue:function(){var startNode=this.selection.getStart(),value=domUtils.getComputedStyle(startNode,"text-align");return defaultValue[value]?value:"left"},queryCommandState:function(){return this.highlight?-1:0}}}(),UE.plugins.font=function(){var me=this,fonts={forecolor:"color",backcolor:"background-color",fontsize:"font-size",fontfamily:"font-family",underline:"text-decoration",strikethrough:"text-decoration"};me.setOpt({fontfamily:[{name:"songti",val:"宋体,SimSun"},{name:"yahei",val:"微软雅黑,Microsoft YaHei"},{name:"kaiti",val:"楷体,楷体_GB2312, SimKai"},{name:"heiti",val:"黑体, SimHei"},{name:"lishu",val:"隶书, SimLi"},{name:"andaleMono",val:"andale mono"},{name:"arial",val:"arial, helvetica,sans-serif"},{name:"arialBlack",val:"arial black,avant garde"},{name:"comicSansMs",val:"comic sans ms"},{name:"impact",val:"impact,chicago"},{name:"timesNewRoman",val:"times new roman"}],fontsize:[10,11,12,14,16,18,20,24,36]});for(var p in fonts)(function(cmd,style){UE.commands[cmd]={execCommand:function(cmdName,value){value=value||(this.queryCommandState(cmdName)?"none":"underline"==cmdName?"underline":"line-through");var text,me=this,range=this.selection.getRange();if("default"==value)range.collapsed&&(text=me.document.createTextNode("font"),range.insertNode(text).select()),me.execCommand("removeFormat","span,a",style),text&&(range.setStartBefore(text).setCursor(),domUtils.remove(text));else if(me.currentSelectedArr&&me.currentSelectedArr.length>0){for(var ci,i=0;ci=me.currentSelectedArr[i++];)range.selectNodeContents(ci),range.applyInlineStyle("span",{style:style+":"+value});range.selectNodeContents(this.currentSelectedArr[0]).select()}else if(range.collapsed){var span=domUtils.findParentByTagName(range.startContainer,"span",!0);if(text=me.document.createTextNode("font"),!span||span.children.length||span[browser.ie?"innerText":"textContent"].replace(fillCharReg,"").length){if(range.insertNode(text),range.selectNode(text).select(),span=range.document.createElement("span"),"underline"==cmd||"strikethrough"==cmd){if(domUtils.findParentByTagName(text,"a",!0))return range.setStartBefore(text).setCursor(),domUtils.remove(text),void 0;me.execCommand("removeFormat","span,a",style)}if(span.style.cssText=style+":"+value,text.parentNode.insertBefore(span,text),!browser.ie||browser.ie&&9==browser.version)for(var spanParent=span.parentNode;!domUtils.isBlockElm(spanParent);)"SPAN"==spanParent.tagName&&(span.style.cssText=spanParent.style.cssText+";"+span.style.cssText),spanParent=spanParent.parentNode;opera?setTimeout(function(){range.setStart(span,0).setCursor()}):range.setStart(span,0).setCursor()}else range.insertNode(text),("underline"==cmd||"strikethrough"==cmd)&&(range.selectNode(text).select(),me.execCommand("removeFormat","span,a",style,null),span=domUtils.findParentByTagName(text,"span",!0),range.setStartBefore(text)),span.style.cssText+=";"+style+":"+value,range.collapse(!0).select();domUtils.remove(text)}else"underline"!=cmd&&"strikethrough"!=cmd||!me.queryCommandValue(cmd)||me.execCommand("removeFormat","span,a",style),range=me.selection.getRange(),range.applyInlineStyle("span",{style:style+":"+value}).select();return!0},queryCommandValue:function(cmdName){var startNode=this.selection.getStart();if("underline"==cmdName||"strikethrough"==cmdName){for(var value,tmpNode=startNode;tmpNode&&!domUtils.isBlockElm(tmpNode)&&!domUtils.isBody(tmpNode);){if(1==tmpNode.nodeType&&(value=domUtils.getComputedStyle(tmpNode,style),"none"!=value))return value;tmpNode=tmpNode.parentNode}return"none"}return domUtils.getComputedStyle(startNode,style)},queryCommandState:function(cmdName){return this.highlight?-1:"underline"!=cmdName&&"strikethrough"!=cmdName?0:this.queryCommandValue(cmdName)==("underline"==cmdName?"underline":"line-through")}}})(p,fonts[p])},UE.commands.scrawl={queryCommandState:function(){return this.highlight||browser.ie&&8>=browser.version?-1:0}},UE.plugins.removeformat=function(){var me=this;me.setOpt({removeFormatTags:"b,big,code,del,dfn,em,font,i,ins,kbd,q,samp,small,span,strike,strong,sub,sup,tt,u,var",removeFormatAttributes:"class,style,lang,width,height,align,hspace,valign"}),me.commands.removeformat={execCommand:function(cmdName,tags,style,attrs,notIncludeA){function isRedundantSpan(node){if(3==node.nodeType||"span"!=node.tagName.toLowerCase())return 0;if(browser.ie){var attrs=node.attributes;if(attrs.length){for(var i=0,l=attrs.length;l>i;i++)if(attrs[i].specified)return 0;return 1}}return!node.attributes.length}function doRemove(range){var bookmark1=range.createBookmark();if(range.collapsed&&range.enlarge(!0),!notIncludeA){var aNode=domUtils.findParentByTagName(range.startContainer,"a",!0);aNode&&range.setStartBefore(aNode),aNode=domUtils.findParentByTagName(range.endContainer,"a",!0),aNode&&range.setEndAfter(aNode)}for(bookmark=range.createBookmark(),node=bookmark.start;(parent=node.parentNode)&&!domUtils.isBlockElm(parent);)domUtils.breakParent(node,parent),domUtils.clearEmptySibling(node);if(bookmark.end){for(node=bookmark.end;(parent=node.parentNode)&&!domUtils.isBlockElm(parent);)domUtils.breakParent(node,parent),domUtils.clearEmptySibling(node);for(var next,current=domUtils.getNextDomNode(bookmark.start,!1,filter);current&&current!=bookmark.end;)next=domUtils.getNextDomNode(current,!0,filter),dtd.$empty[current.tagName.toLowerCase()]||domUtils.isBookmarkNode(current)||(tagReg.test(current.tagName)?style?(domUtils.removeStyle(current,style),isRedundantSpan(current)&&"text-decoration"!=style&&domUtils.remove(current,!0)):domUtils.remove(current,!0):dtd.$tableContent[current.tagName]||dtd.$list[current.tagName]||(domUtils.removeAttributes(current,removeFormatAttributes),isRedundantSpan(current)&&domUtils.remove(current,!0))),current=next}var pN=bookmark.start.parentNode;!domUtils.isBlockElm(pN)||dtd.$tableContent[pN.tagName]||dtd.$list[pN.tagName]||domUtils.removeAttributes(pN,removeFormatAttributes),pN=bookmark.end.parentNode,bookmark.end&&domUtils.isBlockElm(pN)&&!dtd.$tableContent[pN.tagName]&&!dtd.$list[pN.tagName]&&domUtils.removeAttributes(pN,removeFormatAttributes),range.moveToBookmark(bookmark).moveToBookmark(bookmark1);for(var tmp,node=range.startContainer,collapsed=range.collapsed;1==node.nodeType&&domUtils.isEmptyNode(node)&&dtd.$removeEmpty[node.tagName];)tmp=node.parentNode,range.setStartBefore(node),range.startContainer===range.endContainer&&range.endOffset--,domUtils.remove(node),node=tmp;if(!collapsed)for(node=range.endContainer;1==node.nodeType&&domUtils.isEmptyNode(node)&&dtd.$removeEmpty[node.tagName];)tmp=node.parentNode,range.setEndBefore(node),domUtils.remove(node),node=tmp}var bookmark,parent,tagReg=RegExp("^(?:"+(tags||this.options.removeFormatTags).replace(/,/g,"|")+")$","i"),removeFormatAttributes=style?[]:(attrs||this.options.removeFormatAttributes).split(","),range=new dom.Range(this.document),filter=function(node){return 1==node.nodeType};if(this.currentSelectedArr&&this.currentSelectedArr.length){for(var ci,i=0;ci=this.currentSelectedArr[i++];)range.selectNodeContents(ci),doRemove(range);range.selectNodeContents(this.currentSelectedArr[0]).select()}else range=this.selection.getRange(),doRemove(range),range.select()},queryCommandState:function(){return this.highlight?-1:0}}},UE.plugins.blockquote=function(){function getObj(editor){return domUtils.filterNodeList(editor.selection.getStartElementPath(),"blockquote")}var me=this;me.commands.blockquote={execCommand:function(cmdName,attrs){var range=this.selection.getRange(),obj=getObj(this),blockquote=dtd.blockquote,bookmark=range.createBookmark(),tds=this.currentSelectedArr;if(obj)if(tds&&tds.length)domUtils.remove(obj,!0);else{var start=range.startContainer,startBlock=domUtils.isBlockElm(start)?start:domUtils.findParent(start,function(node){return domUtils.isBlockElm(node)}),end=range.endContainer,endBlock=domUtils.isBlockElm(end)?end:domUtils.findParent(end,function(node){return domUtils.isBlockElm(node)});startBlock=domUtils.findParentByTagName(startBlock,"li",!0)||startBlock,endBlock=domUtils.findParentByTagName(endBlock,"li",!0)||endBlock,"LI"==startBlock.tagName||"TD"==startBlock.tagName||startBlock===obj?domUtils.remove(obj,!0):domUtils.breakParent(startBlock,obj),startBlock!==endBlock&&(obj=domUtils.findParentByTagName(endBlock,"blockquote"),obj&&("LI"==endBlock.tagName||"TD"==endBlock.tagName?domUtils.remove(obj,!0):domUtils.breakParent(endBlock,obj)));for(var bi,blockquotes=domUtils.getElementsByTagName(this.document,"blockquote"),i=0;bi=blockquotes[i++];)bi.childNodes.length?domUtils.getPosition(bi,startBlock)&domUtils.POSITION_FOLLOWING&&domUtils.getPosition(bi,endBlock)&domUtils.POSITION_PRECEDING&&domUtils.remove(bi,!0):domUtils.remove(bi)}else{for(var tmpRange=range.cloneRange(),node=1==tmpRange.startContainer.nodeType?tmpRange.startContainer:tmpRange.startContainer.parentNode,preNode=node,doEnd=1;;){if(domUtils.isBody(node)){preNode!==node?range.collapsed?(tmpRange.selectNode(preNode),doEnd=0):tmpRange.setStartBefore(preNode):tmpRange.setStart(node,0);break}if(!blockquote[node.tagName]){range.collapsed?tmpRange.selectNode(preNode):tmpRange.setStartBefore(preNode);break}preNode=node,node=node.parentNode}if(doEnd)for(preNode=node=node=1==tmpRange.endContainer.nodeType?tmpRange.endContainer:tmpRange.endContainer.parentNode;;){if(domUtils.isBody(node)){preNode!==node?tmpRange.setEndAfter(preNode):tmpRange.setEnd(node,node.childNodes.length);break}if(!blockquote[node.tagName]){tmpRange.setEndAfter(preNode);break}preNode=node,node=node.parentNode}node=range.document.createElement("blockquote"),domUtils.setAttributes(node,attrs),node.appendChild(tmpRange.extractContents()),tmpRange.insertNode(node);for(var ci,childs=domUtils.getElementsByTagName(node,"blockquote"),i=0;ci=childs[i++];)ci.parentNode&&domUtils.remove(ci,!0)}range.moveToBookmark(bookmark).select()},queryCommandState:function(){return this.highlight?-1:getObj(this)?1:0}}},UE.commands["delete"]={execCommand:function(){var range=this.selection.getRange(),mStart=0,mEnd=0,me=this;if(this.selectAll)return me.body.innerHTML="<p>"+(browser.ie?"&nbsp;":"<br/>")+"</p>",range.setStart(me.body.firstChild,0).setCursor(!1,!0),me.selectAll=!1,void 0;if(me.currentSelectedArr&&me.currentSelectedArr.length>0){for(var ci,i=0;ci=me.currentSelectedArr[i++];)"none"!=ci.style.display&&(ci.innerHTML=browser.ie?domUtils.fillChar:"<br/>");return range.setStart(me.currentSelectedArr[0],0).setCursor(),void 0}if(!range.collapsed){for(range.txtToElmBoundary();!range.startOffset&&!domUtils.isBody(range.startContainer)&&!dtd.$tableContent[range.startContainer.tagName];)mStart=1,range.setStartBefore(range.startContainer);for(;3!=range.endContainer.nodeType&&!domUtils.isBody(range.endContainer)&&!dtd.$tableContent[range.endContainer.tagName];){var child,endContainer=range.endContainer,endOffset=range.endOffset;child=endContainer.childNodes[endOffset];{if(child&&(!domUtils.isBr(child)||endContainer.lastChild!==child))break;range.setEndAfter(endContainer)}}if(mStart){var start=me.document.createElement("span");start.innerHTML="start",start.id="_baidu_cut_start",range.insertNode(start).setStartBefore(start)}if(mEnd){var end=me.document.createElement("span");end.innerHTML="end",end.id="_baidu_cut_end",range.cloneRange().collapse(!1).insertNode(end),range.setEndAfter(end)}range.deleteContents(),domUtils.isBody(range.startContainer)&&domUtils.isEmptyBlock(me.body)?(me.body.innerHTML="<p>"+(browser.ie?"":"<br/>")+"</p>",range.setStart(me.body.firstChild,0).collapse(!0)):!browser.ie&&domUtils.isEmptyBlock(range.startContainer)&&(range.startContainer.innerHTML="<br/>"),range.select(!0)}},queryCommandState:function(){return this.currentSelectedArr&&this.currentSelectedArr.length>0?0:this.highlight||this.selection.getRange().collapsed?-1:0}},UE.plugins.undo=function(){function sceneRange(rng){var me=this;me.collapsed=rng.collapsed,me.startAddr=getAddr(rng.startContainer,rng.startOffset),me.endAddr=rng.collapsed?me.startAddr:getAddr(rng.endContainer,rng.endOffset)}function getAddr(node,index){for(var ci,i=0,parentsIndex=[index],parents=domUtils.findParents(node,!0,function(node){return!domUtils.isBody(node)},!0);ci=parents[i++];){if(1==i&&3==ci.nodeType){for(var tmpNode=ci;(tmpNode=tmpNode.previousSibling)&&3==tmpNode.nodeType;)index+=tmpNode.nodeValue.replace(fillCharReg,"").length;parentsIndex[0]=index}parentsIndex.push(domUtils.getNodeIndex(ci,!0))}return parentsIndex.reverse()}function compareAddr(indexA,indexB){if(indexA.length!=indexB.length)return 0;for(var i=0,l=indexA.length;l>i;i++)if(indexA[i]!=indexB[i])return 0;return 1}function setAddr(range,boundary,addr){node=range.document.body;for(var node,i=0,l=addr.length-1;l>i;i++)node=node.childNodes[addr[i]];range[boundary+"Container"]=node,range[boundary+"Offset"]=addr[addr.length-1]}function UndoManager(){this.list=[],this.index=0,this.hasUndo=!1,this.hasRedo=!1,this.undo=function(){if(this.hasUndo){var currentScene=this.getScene(),lastScene=this.list[this.index];if(lastScene.content.replace(specialAttr,"")!=currentScene.content.replace(specialAttr,"")&&this.save(),!this.list[this.index-1]&&1==this.list.length)return this.reset(),void 0;for(;this.list[this.index].content==this.list[this.index-1].content;)if(this.index--,0==this.index)return this.restore(0);this.restore(--this.index)}},this.redo=function(){if(this.hasRedo){for(;this.list[this.index].content==this.list[this.index+1].content;)if(this.index++,this.index==this.list.length-1)return this.restore(this.index);this.restore(++this.index)}},this.restore=function(){var scene=this.list[this.index];if(me.document.body.innerHTML=scene.bookcontent.replace(fillchar,""),browser.ie)for(var pi,i=0,ps=me.document.getElementsByTagName("p");pi=ps[i++];)""==pi.innerHTML&&domUtils.fillNode(me.document,pi);var range=new dom.Range(me.document);try{browser.opera||browser.safari?scene.senceRange.transformRange(range):range.moveToBookmark({start:"_baidu_bookmark_start_",end:"_baidu_bookmark_end_",id:!0}),browser.ie&&9==browser.version&&range.collapsed&&domUtils.isBlockElm(range.startContainer)&&domUtils.isEmptyNode(range.startContainer)&&domUtils.fillNode(range.document,range.startContainer),range.select(!browser.gecko),browser.opera||browser.safari||setTimeout(function(){range.scrollToView(me.autoHeightEnabled,me.autoHeightEnabled?domUtils.getXY(me.iframe).y:0)},200)}catch(e){}if(this.update(),me.currentSelectedArr){me.currentSelectedArr=[];for(var td,tds=me.document.getElementsByTagName("td"),i=0;td=tds[i++];)td.className==me.options.selectedTdClass&&me.currentSelectedArr.push(td)}this.clearKey(),me.fireEvent("reset",!0)},this.getScene=function(){var range=me.selection.getRange(),cont=me.body.innerHTML.replace(fillchar,"");if(range.shrinkBoundary(),browser.ie&&(cont=cont.replace(/>&nbsp;</g,"><").replace(/\s*</g,"").replace(/>\s*/g,">")),browser.opera||browser.safari)return{senceRange:new sceneRange(range),content:cont,bookcontent:cont};var bookmark=range.createBookmark(!0,!0),bookCont=me.body.innerHTML.replace(fillchar,"");return bookmark&&range.moveToBookmark(bookmark).select(!0),{bookcontent:bookCont,content:cont}},this.save=function(notCompareRange){var currentScene=this.getScene(),lastScene=this.list[this.index];lastScene&&lastScene.content==currentScene.content&&(notCompareRange?1:browser.opera||browser.safari?lastScene.senceRange.compare(currentScene.senceRange):lastScene.bookcontent==currentScene.bookcontent)||(this.list=this.list.slice(0,this.index+1),this.list.push(currentScene),this.list.length>maxUndoCount&&this.list.shift(),this.index=this.list.length-1,this.clearKey(),this.update())},this.update=function(){this.hasRedo=this.list[this.index+1]?!0:!1,this.hasUndo=this.list[this.index-1]||1==this.list.length?!0:!1},this.reset=function(){this.list=[],this.index=0,this.hasUndo=!1,this.hasRedo=!1,this.clearKey()},this.clearKey=function(){keycont=0,lastKeyCode=null,me.fireEvent("contentchange")}}function saveScene(){this.undoManger.save()}var me=this,maxUndoCount=me.options.maxUndoCount||20,maxInputCount=me.options.maxInputCount||20,fillchar=RegExp(domUtils.fillChar+"|</hr>","gi"),specialAttr=/\b(?:href|src|name)="[^"]*?"/gi;sceneRange.prototype={compare:function(obj){var me=this;return me.collapsed!==obj.collapsed?0:compareAddr(me.startAddr,obj.startAddr)&&compareAddr(me.endAddr,obj.endAddr)?1:0},transformRange:function(rng){var me=this;rng.collapsed=me.collapsed,setAddr(rng,"start",me.startAddr),rng.collapsed?rng.collapse(!0):setAddr(rng,"end",me.endAddr)}},me.undoManger=new UndoManager,me.addListener("beforeexeccommand",saveScene),me.addListener("afterexeccommand",saveScene),me.addListener("reset",function(type,exclude){exclude||me.undoManger.reset()}),me.commands.redo=me.commands.undo={execCommand:function(cmdName){me.undoManger[cmdName]()},queryCommandState:function(cmdName){return me.undoManger["has"+("undo"==cmdName.toLowerCase()?"Undo":"Redo")]?0:-1},notNeedUndo:1};var lastKeyCode,keys={16:1,17:1,18:1,37:1,38:1,39:1,40:1,13:1},keycont=0;me.addListener("keydown",function(type,evt){var keyCode=evt.keyCode||evt.which;if(!(keys[keyCode]||evt.ctrlKey||evt.metaKey||evt.shiftKey||evt.altKey)){if(0==me.undoManger.list.length||(8==keyCode||46==keyCode)&&lastKeyCode!=keyCode)return me.undoManger.save(!0),lastKeyCode=keyCode,void 0;2==me.undoManger.list.length&&0==me.undoManger.index&&0==keycont&&(me.undoManger.list.splice(1,1),me.undoManger.update()),lastKeyCode=keyCode,keycont++,keycont>=maxInputCount&&me.selection.getRange().collapsed&&me.undoManger.save()}})},function(){function getClipboardData(callback){var doc=this.document;if(!doc.getElementById("baidu_pastebin")){var range=this.selection.getRange(),bk=range.createBookmark(),pastebin=doc.createElement("div");pastebin.id="baidu_pastebin",browser.webkit&&pastebin.appendChild(doc.createTextNode(domUtils.fillChar+domUtils.fillChar)),doc.body.appendChild(pastebin),bk.start.style.display="",pastebin.style.cssText="position:absolute;width:1px;height:1px;overflow:hidden;left:-1000px;white-space:nowrap;top:"+domUtils.getXY(bk.start).y+"px",range.selectNodeContents(pastebin).select(!0),setTimeout(function(){if(browser.webkit)for(var pi,i=0,pastebins=doc.querySelectorAll("#baidu_pastebin");pi=pastebins[i++];){if(!domUtils.isEmptyNode(pi)){pastebin=pi;break}domUtils.remove(pi)}try{pastebin.parentNode.removeChild(pastebin)}catch(e){}range.moveToBookmark(bk).select(!0),callback(pastebin)},0)}}UE.plugins.paste=function(){function filter(div){var html;if(div.firstChild){for(var ni,nodes=domUtils.getElementsByTagName(div,"span"),i=0;ni=nodes[i++];)("_baidu_cut_start"==ni.id||"_baidu_cut_end"==ni.id)&&domUtils.remove(ni);if(browser.webkit){for(var bi,brs=div.querySelectorAll("div br"),i=0;bi=brs[i++];){var pN=bi.parentNode;"DIV"==pN.tagName&&1==pN.childNodes.length&&(pN.innerHTML="<p><br/></p>",domUtils.remove(pN))}for(var di,divs=div.querySelectorAll("#baidu_pastebin"),i=0;di=divs[i++];){var tmpP=me.document.createElement("p");for(di.parentNode.insertBefore(tmpP,di);di.firstChild;)tmpP.appendChild(di.firstChild);domUtils.remove(di)}for(var ci,metas=div.querySelectorAll("meta"),i=0;ci=metas[i++];)domUtils.remove(ci);var brs=div.querySelectorAll("br");for(i=0;ci=brs[i++];)/^apple-/.test(ci)&&domUtils.remove(ci)}if(browser.gecko){var dirtyNodes=div.querySelectorAll("[_moz_dirty]");for(i=0;ci=dirtyNodes[i++];)ci.removeAttribute("_moz_dirty")}if(!browser.ie)for(var ci,spans=div.querySelectorAll("span.Apple-style-span"),i=0;ci=spans[i++];)domUtils.remove(ci,!0);html=div.innerHTML;var f=me.serialize;if(f)try{var node=f.transformInput(f.parseHTML(f.word(html)),word_img_flag);if(node=f.filter(node,pasteplain?{whiteList:{a:{$:{href:1}},p:{br:1,BR:1,$:{}},br:{$:{}},div:{br:1,BR:1,$:{}},li:{$:{}},tr:{td:1,$:{}},td:{$:{}}},blackList:{style:1,script:1,object:1}}:null,pasteplain?null:modify_num),browser.webkit)for(var child,length=node.children.length;(child=node.children[length-1])&&"br"==child.tag;)node.children.splice(length-1,1),length=node.children.length;html=f.toHTML(node,pasteplain)}catch(e){}html={html:html},me.fireEvent("beforepaste",html),me.execCommand("insertHtml",html.html,!0),me.fireEvent("afterpaste")}}var me=this,word_img_flag={flag:""},pasteplain=me.options.pasteplain===!0,modify_num={flag:""};me.commands.pasteplain={queryCommandState:function(){return pasteplain},execCommand:function(){pasteplain=0|!pasteplain},notNeedUndo:1},me.ready(function(){domUtils.on(me.body,"cut",function(){var range=me.selection.getRange();
!range.collapsed&&me.undoManger&&me.undoManger.save()}),domUtils.on(me.body,browser.ie||browser.opera?"keydown":"paste",function(e){(!browser.ie&&!browser.opera||e.ctrlKey&&"86"==e.keyCode)&&getClipboardData.call(me,function(div){filter(div)})})})}}(),UE.plugins.list=function(){function adjustList(list,tag,style){var nextList=list.nextSibling;nextList&&1==nextList.nodeType&&nextList.tagName.toLowerCase()==tag&&(domUtils.getStyle(nextList,"list-style-type")||("ol"==tag?"decimal":"disc"))==style&&(domUtils.moveChild(nextList,list),0==nextList.childNodes.length&&domUtils.remove(nextList));var preList=list.previousSibling;preList&&1==preList.nodeType&&preList.tagName.toLowerCase()==tag&&(domUtils.getStyle(preList,"list-style-type")||("ol"==tag?"decimal":"disc"))==style&&domUtils.moveChild(list,preList),0==list.childNodes.length&&domUtils.remove(list)}function clearEmptySibling(node){var tmpNode=node.previousSibling;tmpNode&&domUtils.isEmptyBlock(tmpNode)&&domUtils.remove(tmpNode),tmpNode=node.nextSibling,tmpNode&&domUtils.isEmptyBlock(tmpNode)&&domUtils.remove(tmpNode)}var me=this,notExchange={TD:1,PRE:1,BLOCKQUOTE:1};me.setOpt({insertorderedlist:{decimal:"","lower-alpha":"","lower-roman":"","upper-alpha":"","upper-roman":""},insertunorderedlist:{circle:"",disc:"",square:""}}),me.ready(function(){utils.cssRule("list","li{clear:both}",me.document)}),me.addListener("keydown",function(type,evt){function preventAndSave(){evt.preventDefault?evt.preventDefault():evt.returnValue=!1,me.undoManger&&me.undoManger.save()}var keyCode=evt.keyCode||evt.which;if(13==keyCode){var range=me.selection.getRange(),start=domUtils.findParentByTagName(range.startContainer,["ol","ul"],!0,function(node){return"TABLE"==node.tagName}),end=domUtils.findParentByTagName(range.endContainer,["ol","ul"],!0,function(node){return"TABLE"==node.tagName});if(start&&end&&start===end){if(!range.collapsed){if(start=domUtils.findParentByTagName(range.startContainer,"li",!0),end=domUtils.findParentByTagName(range.endContainer,"li",!0),!start||!end||start!==end){var tmpRange=range.cloneRange(),bk=tmpRange.collapse(!1).createBookmark();range.deleteContents(),tmpRange.moveToBookmark(bk);var li=domUtils.findParentByTagName(tmpRange.startContainer,"li",!0);return clearEmptySibling(li),tmpRange.select(),preventAndSave(),void 0}if(range.deleteContents(),li=domUtils.findParentByTagName(range.startContainer,"li",!0),li&&domUtils.isEmptyBlock(li))return pre=li.previousSibling,next=li.nextSibling,p=me.document.createElement("p"),domUtils.fillNode(me.document,p),parentList=li.parentNode,pre&&next?(range.setStart(next,0).collapse(!0).select(!0),domUtils.remove(li)):((pre||next)&&pre?li.parentNode.parentNode.insertBefore(p,parentList.nextSibling):parentList.parentNode.insertBefore(p,parentList),domUtils.remove(li),parentList.firstChild||domUtils.remove(parentList),range.setStart(p,0).setCursor()),preventAndSave(),void 0}if(li=domUtils.findParentByTagName(range.startContainer,"li",!0)){if(domUtils.isEmptyBlock(li)){bk=range.createBookmark();var parentList=li.parentNode;if(li!==parentList.lastChild?(domUtils.breakParent(li,parentList),clearEmptySibling(li)):(parentList.parentNode.insertBefore(li,parentList.nextSibling),domUtils.isEmptyNode(parentList)&&domUtils.remove(parentList)),!dtd.$list[li.parentNode.tagName])if(domUtils.isBlockElm(li.firstChild))domUtils.remove(li,!0);else{for(p=me.document.createElement("p"),li.parentNode.insertBefore(p,li);li.firstChild;)p.appendChild(li.firstChild);domUtils.remove(li)}range.moveToBookmark(bk).select()}else{var first=li.firstChild;if(!first||!domUtils.isBlockElm(first)){var p=me.document.createElement("p");for(!li.firstChild&&domUtils.fillNode(me.document,p);li.firstChild;)p.appendChild(li.firstChild);li.appendChild(p),first=p}var span=me.document.createElement("span");range.insertNode(span),domUtils.breakParent(span,li);var nextLi=span.nextSibling;first=nextLi.firstChild,first||(p=me.document.createElement("p"),domUtils.fillNode(me.document,p),nextLi.appendChild(p),first=p),domUtils.isEmptyNode(first)&&(first.innerHTML="",domUtils.fillNode(me.document,first)),range.setStart(first,0).collapse(!0).shrinkBoundary().select(),domUtils.remove(span),pre=nextLi.previousSibling,pre&&domUtils.isEmptyBlock(pre)&&(pre.innerHTML="<p></p>",domUtils.fillNode(me.document,pre.firstChild))}preventAndSave()}}}if(8==keyCode&&(range=me.selection.getRange(),range.collapsed&&domUtils.isStartInblock(range)&&(tmpRange=range.cloneRange().trimBoundary(),li=domUtils.findParentByTagName(range.startContainer,"li",!0),li&&domUtils.isStartInblock(tmpRange)))){if(li&&(pre=li.previousSibling)){if(46==keyCode&&li.childNodes.length)return;if(dtd.$list[pre.tagName]&&(pre=pre.lastChild),me.undoManger&&me.undoManger.save(),first=li.firstChild,domUtils.isBlockElm(first))if(domUtils.isEmptyNode(first))for(pre.appendChild(first),range.setStart(first,0).setCursor(!1,!0);li.firstChild;)pre.appendChild(li.firstChild);else{if(start=domUtils.findParentByTagName(range.startContainer,"p",!0),start&&start!==first)return;span=me.document.createElement("span"),range.insertNode(span),domUtils.isEmptyBlock(pre)&&(pre.innerHTML=""),domUtils.moveChild(li,pre),range.setStartBefore(span).collapse(!0).select(!0),domUtils.remove(span)}else if(domUtils.isEmptyNode(li)){var p=me.document.createElement("p");pre.appendChild(p),range.setStart(p,0).setCursor()}else for(range.setEnd(pre,pre.childNodes.length).collapse().select(!0);li.firstChild;)pre.appendChild(li.firstChild);return domUtils.remove(li),me.undoManger&&me.undoManger.save(),domUtils.preventDefault(evt),void 0}if(li&&!li.previousSibling&&(first=li.firstChild,!first||li.lastChild===first&&domUtils.isEmptyNode(domUtils.isBlockElm(first)?first:li))){var p=me.document.createElement("p");return li.parentNode.parentNode.insertBefore(p,li.parentNode),domUtils.fillNode(me.document,p),range.setStart(p,0).setCursor(),domUtils.remove(li.nextSibling?li:li.parentNode),me.undoManger&&me.undoManger.save(),domUtils.preventDefault(evt),void 0}}}),me.commands.insertorderedlist=me.commands.insertunorderedlist={execCommand:function(command,style){style||(style="insertorderedlist"==command.toLowerCase()?"decimal":"disc");var me=this,range=this.selection.getRange(),filterFn=function(node){return 1==node.nodeType?"br"!=node.tagName.toLowerCase():!domUtils.isWhitespace(node)},tag="insertorderedlist"==command.toLowerCase()?"ol":"ul",frag=me.document.createDocumentFragment();range.adjustmentBoundary().shrinkBoundary();var startParent,endParent,list,tmp,bko=range.createBookmark(!0),start=domUtils.findParentByTagName(me.document.getElementById(bko.start),"li"),modifyStart=0,end=domUtils.findParentByTagName(me.document.getElementById(bko.end),"li"),modifyEnd=0;if(start||end){if(start&&(startParent=start.parentNode),bko.end||(end=start),end&&(endParent=end.parentNode),startParent===endParent){for(;start!==end;){if(tmp=start,start=start.nextSibling,!domUtils.isBlockElm(tmp.firstChild)){for(var p=me.document.createElement("p");tmp.firstChild;)p.appendChild(tmp.firstChild);tmp.appendChild(p)}frag.appendChild(tmp)}if(tmp=me.document.createElement("span"),startParent.insertBefore(tmp,end),!domUtils.isBlockElm(end.firstChild)){for(p=me.document.createElement("p");end.firstChild;)p.appendChild(end.firstChild);end.appendChild(p)}frag.appendChild(end),domUtils.breakParent(tmp,startParent),domUtils.isEmptyNode(tmp.previousSibling)&&domUtils.remove(tmp.previousSibling),domUtils.isEmptyNode(tmp.nextSibling)&&domUtils.remove(tmp.nextSibling);var nodeStyle=domUtils.getComputedStyle(startParent,"list-style-type")||("insertorderedlist"==command.toLowerCase()?"decimal":"disc");if(startParent.tagName.toLowerCase()==tag&&nodeStyle==style){for(var ci,i=0,tmpFrag=me.document.createDocumentFragment();ci=frag.childNodes[i++];)for(;ci.firstChild;)tmpFrag.appendChild(ci.firstChild);tmp.parentNode.insertBefore(tmpFrag,tmp)}else list=me.document.createElement(tag),domUtils.setStyle(list,"list-style-type",style),list.appendChild(frag),tmp.parentNode.insertBefore(list,tmp);return domUtils.remove(tmp),list&&adjustList(list,tag,style),range.moveToBookmark(bko).select(),void 0}if(start){for(;start;){if(tmp=start.nextSibling,domUtils.isTagNode(start,"ol ul"))frag.appendChild(start);else{for(var tmpfrag=me.document.createDocumentFragment(),hasBlock=0;start.firstChild;)domUtils.isBlockElm(start.firstChild)&&(hasBlock=1),tmpfrag.appendChild(start.firstChild);if(hasBlock)frag.appendChild(tmpfrag);else{var tmpP=me.document.createElement("p");tmpP.appendChild(tmpfrag),frag.appendChild(tmpP)}domUtils.remove(start)}start=tmp}startParent.parentNode.insertBefore(frag,startParent.nextSibling),domUtils.isEmptyNode(startParent)?(range.setStartBefore(startParent),domUtils.remove(startParent)):range.setStartAfter(startParent),modifyStart=1}if(end&&domUtils.inDoc(endParent,me.document)){for(start=endParent.firstChild;start&&start!==end;){if(tmp=start.nextSibling,domUtils.isTagNode(start,"ol ul"))frag.appendChild(start);else{for(tmpfrag=me.document.createDocumentFragment(),hasBlock=0;start.firstChild;)domUtils.isBlockElm(start.firstChild)&&(hasBlock=1),tmpfrag.appendChild(start.firstChild);hasBlock?frag.appendChild(tmpfrag):(tmpP=me.document.createElement("p"),tmpP.appendChild(tmpfrag),frag.appendChild(tmpP)),domUtils.remove(start)}start=tmp}var tmpDiv=domUtils.createElement(me.document,"div",{tmpDiv:1});domUtils.moveChild(end,tmpDiv),frag.appendChild(tmpDiv),domUtils.remove(end),endParent.parentNode.insertBefore(frag,endParent),range.setEndBefore(endParent),domUtils.isEmptyNode(endParent)&&domUtils.remove(endParent),modifyEnd=1}}modifyStart||range.setStartBefore(me.document.getElementById(bko.start)),bko.end&&!modifyEnd&&range.setEndAfter(me.document.getElementById(bko.end)),range.enlarge(!0,function(node){return notExchange[node.tagName]}),frag=me.document.createDocumentFragment();for(var tmpNode,bk=range.createBookmark(),current=domUtils.getNextDomNode(bk.start,!1,filterFn),tmpRange=range.cloneRange(),block=domUtils.isBlockElm;current&&current!==bk.end&&domUtils.getPosition(current,bk.end)&domUtils.POSITION_PRECEDING;)if(3==current.nodeType||dtd.li[current.tagName]){if(1==current.nodeType&&dtd.$list[current.tagName]){for(;current.firstChild;)frag.appendChild(current.firstChild);tmpNode=domUtils.getNextDomNode(current,!1,filterFn),domUtils.remove(current),current=tmpNode;continue}for(tmpNode=current,tmpRange.setStartBefore(current);current&&current!==bk.end&&(!block(current)||domUtils.isBookmarkNode(current));)tmpNode=current,current=domUtils.getNextDomNode(current,!1,null,function(node){return!notExchange[node.tagName]});current&&block(current)&&(tmp=domUtils.getNextDomNode(tmpNode,!1,filterFn),tmp&&domUtils.isBookmarkNode(tmp)&&(current=domUtils.getNextDomNode(tmp,!1,filterFn),tmpNode=tmp)),tmpRange.setEndAfter(tmpNode),current=domUtils.getNextDomNode(tmpNode,!1,filterFn);var li=range.document.createElement("li");li.appendChild(tmpRange.extractContents()),frag.appendChild(li)}else current=domUtils.getNextDomNode(current,!0,filterFn);range.moveToBookmark(bk).collapse(!0),list=me.document.createElement(tag),domUtils.setStyle(list,"list-style-type",style),list.appendChild(frag),range.insertNode(list),adjustList(list,tag,style);for(var ci,i=0,tmpDivs=domUtils.getElementsByTagName(list,"div");ci=tmpDivs[i++];)ci.getAttribute("tmpDiv")&&domUtils.remove(ci,!0);range.moveToBookmark(bko).select()},queryCommandState:function(command){return this.highlight?-1:domUtils.filterNodeList(this.selection.getStartElementPath(),"insertorderedlist"==command.toLowerCase()?"ol":"ul")?1:0},queryCommandValue:function(command){var node=domUtils.filterNodeList(this.selection.getStartElementPath(),"insertorderedlist"==command.toLowerCase()?"ol":"ul");return node?domUtils.getComputedStyle(node,"list-style-type"):null}}},function(){function SourceFormater(config){config=config||{},this.indentChar=config.indentChar||"    ",this.breakChar=config.breakChar||"\n",this.selfClosingEnd=config.selfClosingEnd||" />"}function printAttrs(attrs){var buff=[];for(var k in attrs)buff.push(k+'="'+unhtml1(attrs[k])+'"');return buff.join(" ")}var unhtml1=function(){function rep(m){return map[m]}var map={"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};return function(str){return str+="",str?str.replace(/[<>"']/g,rep):""}}(),inline=utils.extend({a:1,A:1},dtd.$inline,!0);SourceFormater.prototype={format:function(html){var node=UE.serialize.parseHTML(html);return this.buff=[],this.indents="",this.indenting=1,this.visitNode(node),this.buff.join("")},visitNode:function(node){if("fragment"==node.type)this.visitChildren(node.children);else if("element"==node.type){var selfClosing=dtd.$empty[node.tag];this.visitTag(node.tag,node.attributes,selfClosing),this.visitChildren(node.children),selfClosing||this.visitEndTag(node.tag)}else"comment"==node.type?this.visitComment(node.data):this.visitText(node.data,dtd.$notTransContent[node.parent.tag])},visitChildren:function(children){for(var i=0;children.length>i;i++)this.visitNode(children[i])},visitTag:function(tag,attrs,selfClosing){this.indenting?this.indent():inline[tag]||(this.newline(),this.indent()),this.buff.push("<",tag);var attrPart=printAttrs(attrs);attrPart&&this.buff.push(" ",attrPart),selfClosing?(this.buff.push(this.selfClosingEnd),"br"==tag&&this.newline()):(this.buff.push(">"),this.indents+=this.indentChar),inline[tag]||this.newline()},indent:function(){this.buff.push(this.indents),this.indenting=0},newline:function(){this.buff.push(this.breakChar),this.indenting=1},visitEndTag:function(tag){this.indents=this.indents.slice(0,-this.indentChar.length),this.indenting?this.indent():inline[tag]||(this.newline(),this.indent()),this.buff.push("</",tag,">")},visitText:function(text){this.indenting&&this.indent(),text=text.replace(/&nbsp;/g," "),this.buff.push(text)},visitComment:function(text){this.indenting&&this.indent(),this.buff.push("<!--",text,"-->")}};var sourceEditors={textarea:function(editor,holder){var textarea=holder.ownerDocument.createElement("textarea");return textarea.style.cssText="position:absolute;resize:none;width:100%;height:100%;border:0;padding:0;margin:0;overflow-y:auto;",browser.ie&&8>browser.version&&(textarea.style.width=holder.offsetWidth+"px",textarea.style.height=holder.offsetHeight+"px",holder.onresize=function(){textarea.style.width=holder.offsetWidth+"px",textarea.style.height=holder.offsetHeight+"px"}),holder.appendChild(textarea),{setContent:function(content){textarea.value=content},getContent:function(){return textarea.value},select:function(){var range;browser.ie?(range=textarea.createTextRange(),range.collapse(!0),range.select()):(textarea.setSelectionRange(0,0),textarea.focus())},dispose:function(){holder.removeChild(textarea),holder.onresize=null,textarea=null,holder=null}}},codemirror:function(editor,holder){var codeEditor=window.CodeMirror(holder,{mode:"text/html",tabMode:"indent",lineNumbers:!0,lineWrapping:!0}),dom=codeEditor.getWrapperElement();return dom.style.cssText='position:absolute;left:0;top:0;width:100%;height:100%;font-family:consolas,"Courier new",monospace;font-size:13px;',codeEditor.getScrollerElement().style.cssText="position:absolute;left:0;top:0;width:100%;height:100%;",codeEditor.refresh(),{getCodeMirror:function(){return codeEditor},setContent:function(content){codeEditor.setValue(content)},getContent:function(){return codeEditor.getValue()},select:function(){codeEditor.focus()},dispose:function(){holder.removeChild(dom),dom=null,codeEditor=null}}}};UE.plugins.source=function(){function createSourceEditor(holder){return sourceEditors["codemirror"==opt.sourceEditor&&window.CodeMirror?"codemirror":"textarea"](me,holder)}var sourceEditor,me=this,opt=this.options,formatter=new SourceFormater(opt.source),sourceMode=!1;opt.sourceEditor=browser.ie&&8>browser.version?"textarea":opt.sourceEditor||"codemirror",me.setOpt({sourceEditorFirst:!1});var bakCssText,oldGetContent=me.getContent;me.commands.source={execCommand:function(){if(sourceMode=!sourceMode){me.undoManger&&me.undoManger.save(),this.currentSelectedArr&&domUtils.clearSelectedArr(this.currentSelectedArr),browser.gecko&&(me.body.contentEditable=!1),bakCssText=me.iframe.style.cssText,me.iframe.style.cssText+="position:absolute;left:-32768px;top:-32768px;";var content=formatter.format(me.hasContents()?me.getContent():"");sourceEditor=createSourceEditor(me.iframe.parentNode),sourceEditor.setContent(content),setTimeout(function(){sourceEditor.select(),me.addListener("fullscreenchanged",function(){try{sourceEditor.getCodeMirror().refresh()}catch(e){}})}),me.getContent=function(){var cont=sourceEditor.getContent()||"<p>"+(browser.ie?"":"<br/>")+"</p>";return cont=cont.replace(/>[\n\r\t]+([ ]{4})+/g,">").replace(/[\n\r\t]+([ ]{4})+</g,"<").replace(/>[\n\r\t]+</g,"><"),me.setContent(cont,!0),oldGetContent.apply(this)}}else{me.iframe.style.cssText=bakCssText;var cont=sourceEditor.getContent()||"<p>"+(browser.ie?"":"<br/>")+"</p>";cont=cont.replace(/>[\n\r\t]+([ ]{4})+/g,">").replace(/[\n\r\t]+([ ]{4})+</g,"<").replace(/>[\n\r\t]+</g,"><"),me.setContent(cont),sourceEditor.dispose(),sourceEditor=null,me.getContent=oldGetContent,setTimeout(function(){var first=me.body.firstChild;for(first||(me.body.innerHTML="<p>"+(browser.ie?"":"<br/>")+"</p>",first=me.body.firstChild),me.undoManger&&me.undoManger.save(!0);first&&first.firstChild;)first=first.firstChild;var range=me.selection.getRange();if(3==first.nodeType||dtd.$empty[first.tagName]?range.setStartBefore(first):range.setStart(first,0),browser.gecko){var input=document.createElement("input");input.style.cssText="position:absolute;left:0;top:-32768px",document.body.appendChild(input),me.body.contentEditable=!1,setTimeout(function(){domUtils.setViewportOffset(input,{left:-32768,top:0}),input.focus(),setTimeout(function(){me.body.contentEditable=!0,range.setCursor(!1,!0),domUtils.remove(input)})})}else range.setCursor(!1,!0)})}this.fireEvent("sourcemodechanged",sourceMode)},queryCommandState:function(){return 0|sourceMode},notNeedUndo:1};var oldQueryCommandState=me.queryCommandState;me.queryCommandState=function(cmdName){return cmdName=cmdName.toLowerCase(),sourceMode?cmdName in{source:1,fullscreen:1}?1:-1:oldQueryCommandState.apply(this,arguments)},"codemirror"==opt.sourceEditor&&me.addListener("ready",function(){utils.loadFile(document,{src:opt.codeMirrorJsUrl||opt.UEDITOR_HOME_URL+"third-party/codemirror/codemirror.js",tag:"script",type:"text/javascript",defer:"defer"},function(){opt.sourceEditorFirst&&setTimeout(function(){me.execCommand("source")},0)}),utils.loadFile(document,{tag:"link",rel:"stylesheet",type:"text/css",href:opt.codeMirrorCssUrl||opt.UEDITOR_HOME_URL+"third-party/codemirror/codemirror.css"})})}}(),UE.plugins.shortcutkeys=function(){var me=this,shortcutkeys={"ctrl+66":"Bold","ctrl+90":"Undo","ctrl+89":"Redo","ctrl+73":"Italic","ctrl+85":"Underline","ctrl+shift+67":"removeformat","ctrl+shift+76":"justify:left","ctrl+shift+82":"justify:right","ctrl+65":"selectAll","ctrl+13":"autosubmit"};me.addListener("keydown",function(type,e){var value,keyCode=e.keyCode||e.which;for(var i in shortcutkeys)(/^(ctrl)(\+shift)?\+(\d+)$/.test(i.toLowerCase())||/^(\d+)$/.test(i))&&(("ctrl"==RegExp.$1?e.ctrlKey||e.metaKey||browser.opera&&17==keyCode:0)&&(""!=RegExp.$2?e[RegExp.$2.slice(1)+"Key"]:1)&&keyCode==RegExp.$3||keyCode==RegExp.$1)&&(value=shortcutkeys[i].split(":"),me.execCommand(value[0],value[1]),domUtils.preventDefault(e))})},UE.plugins.enterkey=function(){var hTag,me=this,tag=me.options.enterTag;me.addListener("keyup",function(type,evt){var keyCode=evt.keyCode||evt.which;if(13==keyCode){var doSave,range=me.selection.getRange(),start=range.startContainer;if(!browser.ie){if(/h\d/i.test(hTag)){if(browser.gecko){var h=domUtils.findParentByTagName(start,["h1","h2","h3","h4","h5","h6","blockquote"],!0);h||(me.document.execCommand("formatBlock",!1,"<p>"),doSave=1)}else if(1==start.nodeType){var div,tmp=me.document.createTextNode("");if(range.insertNode(tmp),div=domUtils.findParentByTagName(tmp,"div",!0)){for(var p=me.document.createElement("p");div.firstChild;)p.appendChild(div.firstChild);div.parentNode.insertBefore(p,div),domUtils.remove(div),range.setStartBefore(tmp).setCursor(),doSave=1}domUtils.remove(tmp)}me.undoManger&&doSave&&me.undoManger.save()}browser.opera&&range.select()}setTimeout(function(){me.selection.getRange().scrollToView(me.autoHeightEnabled,me.autoHeightEnabled?domUtils.getXY(me.iframe).y:0)},50)}}),me.addListener("keydown",function(type,evt){var keyCode=evt.keyCode||evt.which;if(13==keyCode){me.undoManger&&me.undoManger.save(),hTag="";var range=me.selection.getRange();if(!range.collapsed){var start=range.startContainer,end=range.endContainer,startTd=domUtils.findParentByTagName(start,"td",!0),endTd=domUtils.findParentByTagName(end,"td",!0);if(startTd&&endTd&&startTd!==endTd||!startTd&&endTd||startTd&&!endTd)return evt.preventDefault?evt.preventDefault():evt.returnValue=!1,void 0}if(me.currentSelectedArr&&domUtils.clearSelectedArr(me.currentSelectedArr),"p"==tag)browser.ie||(start=domUtils.findParentByTagName(range.startContainer,["ol","ul","p","h1","h2","h3","h4","h5","h6","blockquote"],!0),start||browser.opera?(hTag=start.tagName,"p"==start.tagName.toLowerCase()&&browser.gecko&&domUtils.removeDirtyAttr(start)):(me.document.execCommand("formatBlock",!1,"<p>"),browser.gecko&&(range=me.selection.getRange(),start=domUtils.findParentByTagName(range.startContainer,"p",!0),start&&domUtils.removeDirtyAttr(start))));else if(evt.preventDefault?evt.preventDefault():evt.returnValue=!1,range.collapsed){br=range.document.createElement("br"),range.insertNode(br);var parent=br.parentNode;parent.lastChild===br?(br.parentNode.insertBefore(br.cloneNode(!0),br),range.setStartBefore(br)):range.setStartAfter(br),range.setCursor()}else if(range.deleteContents(),start=range.startContainer,1==start.nodeType&&(start=start.childNodes[range.startOffset])){for(;1==start.nodeType;){if(dtd.$empty[start.tagName])return range.setStartBefore(start).setCursor(),me.undoManger&&me.undoManger.save(),!1;if(!start.firstChild){var br=range.document.createElement("br");return start.appendChild(br),range.setStart(start,0).setCursor(),me.undoManger&&me.undoManger.save(),!1}start=start.firstChild}start===range.startContainer.childNodes[range.startOffset]?(br=range.document.createElement("br"),range.insertNode(br).setCursor()):range.setStart(start,0).setCursor()}else br=range.document.createElement("br"),range.insertNode(br).setStartAfter(br).setCursor()}})},UE.plugins.keystrokes=function(){function sameListNode(nodeA,nodeB){return nodeA.tagName!==nodeB.tagName||domUtils.getComputedStyle(nodeA,"list-style-type")!==domUtils.getComputedStyle(nodeB,"list-style-type")?!1:!0}var me=this,flag=0,keys=domUtils.keys,trans={B:"strong",I:"em",FONT:"span"},sizeMap=[0,10,12,16,18,24,32,48],listStyle={OL:["decimal","lower-alpha","lower-roman","upper-alpha","upper-roman"],UL:["circle","disc","square"]};me.addListener("keydown",function(type,evt){var keyCode=evt.keyCode||evt.which;if(this.selectAll&&(this.selectAll=!1,8==keyCode||46==keyCode))return me.undoManger&&me.undoManger.save(),me.body.innerHTML="<p>"+(browser.ie?"":"<br/>")+"</p>",new dom.Range(me.document).setStart(me.body.firstChild,0).setCursor(!1,!0),me.undoManger&&me.undoManger.save(),browser.ie&&me._selectionChange(),domUtils.preventDefault(evt),void 0;if(8==keyCode){var start,end,range=me.selection.getRange();if(range.collapsed&&(start=range.startContainer,domUtils.isWhitespace(start)&&(start=start.parentNode),domUtils.isEmptyNode(start)&&start===me.body.firstChild))return"P"!=start.tagName&&(p=me.document.createElement("p"),me.body.insertBefore(p,start),domUtils.fillNode(me.document,p),range.setStart(p,0).setCursor(!1,!0),domUtils.remove(start)),domUtils.preventDefault(evt),void 0;if(range.collapsed&&3==range.startContainer.nodeType&&0==range.startContainer.nodeValue.replace(RegExp(domUtils.fillChar,"g"),"").length&&range.setStartBefore(range.startContainer).collapse(!0),start=range.getClosedNode())return me.undoManger&&me.undoManger.save(),range.setStartBefore(start),domUtils.remove(start),range.setCursor(),me.undoManger&&me.undoManger.save(),domUtils.preventDefault(evt),void 0;if(!browser.ie&&(start=domUtils.findParentByTagName(range.startContainer,"table",!0),end=domUtils.findParentByTagName(range.endContainer,"table",!0),start&&!end||!start&&end||start!==end))return evt.preventDefault(),void 0;me.undoManger&&(range.collapsed||(me.undoManger.save(),flag=1))}if(9==keyCode){range=me.selection.getRange(),me.undoManger&&me.undoManger.save();for(var i=0,txt="",tabSize=me.options.tabSize||4,tabNode=me.options.tabNode||"&nbsp;";tabSize>i;i++)txt+=tabNode;var span=me.document.createElement("span");if(span.innerHTML=txt,range.collapsed){var li=domUtils.findParentByTagName(range.startContainer,"li",!0);if(li&&domUtils.isStartInblock(range)){bk=range.createBookmark();var parentLi=li.parentNode,list=me.document.createElement(parentLi.tagName),index=utils.indexOf(listStyle[list.tagName],domUtils.getComputedStyle(parentLi,"list-style-type"));index=index+1==listStyle[list.tagName].length?0:index+1,domUtils.setStyle(list,"list-style-type",listStyle[list.tagName][index]),parentLi.insertBefore(list,li),list.appendChild(li);var preList=list.previousSibling;preList&&sameListNode(preList,list)&&(domUtils.moveChild(list,preList),domUtils.remove(list),list=preList);var nextList=list.nextSibling;nextList&&sameListNode(nextList,list)&&(domUtils.moveChild(nextList,list),domUtils.remove(nextList)),range.moveToBookmark(bk).select()}else range.insertNode(span.cloneNode(!0).firstChild).setCursor(!0)}else{if(start=domUtils.findParentByTagName(range.startContainer,"table",!0),end=domUtils.findParentByTagName(range.endContainer,"table",!0),start||end)return evt.preventDefault?evt.preventDefault():evt.returnValue=!1,void 0;if(start=domUtils.findParentByTagName(range.startContainer,["ol","ul"],!0),end=domUtils.findParentByTagName(range.endContainer,["ol","ul"],!0),start&&end&&start===end){var bk=range.createBookmark();if(start=domUtils.findParentByTagName(range.startContainer,"li",!0),end=domUtils.findParentByTagName(range.endContainer,"li",!0),start===start.parentNode.firstChild){var parentList=me.document.createElement(start.parentNode.tagName);start.parentNode.parentNode.insertBefore(parentList,start.parentNode),parentList.appendChild(start.parentNode)}else{parentLi=start.parentNode,list=me.document.createElement(parentLi.tagName),index=utils.indexOf(listStyle[list.tagName],domUtils.getComputedStyle(parentLi,"list-style-type")),index=index+1==listStyle[list.tagName].length?0:index+1,domUtils.setStyle(list,"list-style-type",listStyle[list.tagName][index]),start.parentNode.insertBefore(list,start);for(var nextLi;start!==end;)nextLi=start.nextSibling,list.appendChild(start),start=nextLi;list.appendChild(end)}range.moveToBookmark(bk).select()}else{if(start||end)return evt.preventDefault?evt.preventDefault():evt.returnValue=!1,void 0;if(start=domUtils.findParent(range.startContainer,filterFn),end=domUtils.findParent(range.endContainer,filterFn),start&&end&&start===end)range.deleteContents(),range.insertNode(span.cloneNode(!0).firstChild).setCursor(!0);else{var bookmark=range.createBookmark(),filterFn=function(node){return domUtils.isBlockElm(node)};range.enlarge(!0);for(var bookmark2=range.createBookmark(),current=domUtils.getNextDomNode(bookmark2.start,!1,filterFn);current&&!(domUtils.getPosition(current,bookmark2.end)&domUtils.POSITION_FOLLOWING);)current.insertBefore(span.cloneNode(!0).firstChild,current.firstChild),current=domUtils.getNextDomNode(current,!1,filterFn);range.moveToBookmark(bookmark2).moveToBookmark(bookmark).select()}}}me.undoManger&&me.undoManger.save(),evt.preventDefault?evt.preventDefault():evt.returnValue=!1}if(browser.gecko&&46==keyCode&&(range=me.selection.getRange(),range.collapsed&&(start=range.startContainer,domUtils.isEmptyBlock(start)))){for(var parent=start.parentNode;1==domUtils.getChildCount(parent)&&!domUtils.isBody(parent);)start=parent,parent=parent.parentNode;return start===parent.lastChild&&evt.preventDefault(),void 0}}),me.addListener("keyup",function(type,evt){var keyCode=evt.keyCode||evt.which;if(!(browser.gecko||keys[keyCode]||evt.ctrlKey||evt.metaKey||evt.shiftKey||evt.altKey)&&(range=me.selection.getRange(),range.collapsed)){for(var start=range.startContainer,isFixed=0;!domUtils.isBlockElm(start);){if(1==start.nodeType&&-1!=utils.indexOf(["FONT","B","I"],start.tagName)){var tmpNode=me.document.createElement(trans[start.tagName]);for("FONT"==start.tagName&&(tmpNode.style.cssText=(start.getAttribute("size")?"font-size:"+(sizeMap[start.getAttribute("size")]||12)+"px":"")+";"+(start.getAttribute("color")?"color:"+start.getAttribute("color"):"")+";"+(start.getAttribute("face")?"font-family:"+start.getAttribute("face"):"")+";"+start.style.cssText);start.firstChild;)tmpNode.appendChild(start.firstChild);start.parentNode.insertBefore(tmpNode,start),domUtils.remove(start),isFixed||range.setEnd(tmpNode,tmpNode.childNodes.length).collapse(!0),start=tmpNode,isFixed=1}start=start.parentNode}isFixed&&range.select()}if(8==keyCode){if(browser.gecko)for(var li,i=0,lis=domUtils.getElementsByTagName(this.body,"li");li=lis[i++];)if(domUtils.isEmptyNode(li)&&!li.previousSibling){var liOfPn=li.parentNode;domUtils.remove(li),domUtils.isEmptyNode(liOfPn)&&domUtils.remove(liOfPn)}var range,start,parent,tds=this.currentSelectedArr;if(tds&&tds.length>0){for(var ti,i=0;ti=tds[i++];)ti.innerHTML=browser.ie?9>browser.version?"&#65279":"":"<br/>";return range=new dom.Range(this.document),range.setStart(tds[0],0).setCursor(),flag&&(me.undoManger.save(),flag=0),browser.webkit&&evt.preventDefault(),void 0}range=me.selection.getRange(),start=range.startContainer,domUtils.isWhitespace(start)&&(start=start.parentNode);for(var removeFlag=0;1==start.nodeType&&domUtils.isEmptyNode(start)&&dtd.$removeEmpty[start.tagName];)removeFlag=1,parent=start.parentNode,domUtils.remove(start),start=parent;if(removeFlag&&1==start.nodeType&&domUtils.isEmptyNode(start)){if(browser.ie){var span=range.document.createElement("span");if(start.appendChild(span),range.setStart(start,0).setCursor(),li=domUtils.findParentByTagName(start,"li",!0))for(var next=li.nextSibling;next&&domUtils.isEmptyBlock(next);)li=next,next=next.nextSibling,domUtils.remove(li)}else start.innerHTML="<br/>",range.setStart(start,0).setCursor(!1,!0);setTimeout(function(){browser.ie&&domUtils.remove(span),flag&&(me.undoManger.save(),flag=0)},0)}else flag&&(me.undoManger.save(),flag=0)}})},UE.plugins.fiximgclick=function(){var me=this;browser.webkit&&me.addListener("click",function(type,e){if("IMG"==e.target.tagName){var range=new dom.Range(me.document);range.selectNode(e.target).select()}})},UE.plugins.autoheight=function(){function adjustHeight(){clearTimeout(timer),timer=setTimeout(function(){1!=me.queryCommandState("source")&&(span||(span=me.document.createElement("span"),span.style.cssText="display:block;width:0;margin:0;padding:0;border:0;clear:both;",span.innerHTML="."),tmpNode=span.cloneNode(!0),me.body.appendChild(tmpNode),currentHeight=Math.max(domUtils.getXY(tmpNode).y+tmpNode.offsetHeight,Math.max(options.minFrameHeight,options.initialFrameHeight)),currentHeight!=lastHeight&&(me.setHeight(currentHeight),lastHeight=currentHeight),domUtils.remove(tmpNode))},50)}var me=this;if(me.autoHeightEnabled=me.options.autoHeightEnabled!==!1,me.autoHeightEnabled){var bakOverflow,span,tmpNode,currentHeight,timer,lastHeight=0,options=me.options;me.addListener("destroy",function(){me.removeListener("contentchange",adjustHeight),me.removeListener("keyup",adjustHeight),me.removeListener("mouseup",adjustHeight)}),me.enableAutoHeight=function(){if(me.autoHeightEnabled){var doc=me.document;me.autoHeightEnabled=!0,bakOverflow=doc.body.style.overflowY,doc.body.style.overflowY="hidden",me.addListener("contentchange",adjustHeight),me.addListener("keyup",adjustHeight),me.addListener("mouseup",adjustHeight),setTimeout(function(){adjustHeight()
},browser.gecko?100:0),me.fireEvent("autoheightchanged",me.autoHeightEnabled)}},me.disableAutoHeight=function(){me.body.style.overflowY=bakOverflow||"",me.removeListener("contentchange",adjustHeight),me.removeListener("keyup",adjustHeight),me.removeListener("mouseup",adjustHeight),me.autoHeightEnabled=!1,me.fireEvent("autoheightchanged",me.autoHeightEnabled)},me.addListener("ready",function(){me.enableAutoHeight();var timer;domUtils.on(browser.ie?me.body:me.document,browser.webkit?"dragover":"drop",function(){clearTimeout(timer),timer=setTimeout(function(){adjustHeight()},100)})})}},UE.plugins.autofloat=function(){function checkHasUI(editor){return editor.ui?1:(alert(lang.autofloatMsg),0)}function fixIE6FixedPos(){var docStyle=document.body.style;docStyle.backgroundImage='url("about:blank")',docStyle.backgroundAttachment="fixed"}function setFloating(){var toobarBoxPos=domUtils.getXY(toolbarBox),origalFloat=domUtils.getComputedStyle(toolbarBox,"position"),origalLeft=domUtils.getComputedStyle(toolbarBox,"left");toolbarBox.style.width=toolbarBox.offsetWidth+"px",toolbarBox.style.zIndex=1*me.options.zIndex+1,toolbarBox.parentNode.insertBefore(placeHolder,toolbarBox),LteIE6||quirks&&browser.ie?("absolute"!=toolbarBox.style.position&&(toolbarBox.style.position="absolute"),toolbarBox.style.top=(document.body.scrollTop||document.documentElement.scrollTop)-orgTop+topOffset+"px"):(browser.ie7Compat&&flag&&(flag=!1,toolbarBox.style.left=domUtils.getXY(toolbarBox).x-document.documentElement.getBoundingClientRect().left+2+"px"),"fixed"!=toolbarBox.style.position&&(toolbarBox.style.position="fixed",toolbarBox.style.top=topOffset+"px",("absolute"==origalFloat||"relative"==origalFloat)&&parseFloat(origalLeft)&&(toolbarBox.style.left=toobarBoxPos.x+"px")))}function unsetFloating(){flag=!0,placeHolder.parentNode&&placeHolder.parentNode.removeChild(placeHolder),toolbarBox.style.cssText=bakCssText}function updateFloating(){var rect3=getPosition(me.container);0>rect3.top&&rect3.bottom-toolbarBox.offsetHeight>0?setFloating():unsetFloating()}var me=this,lang=me.getLang();me.setOpt({topOffset:0});var optsAutoFloatEnabled=me.options.autoFloatEnabled!==!1,topOffset=me.options.topOffset;if(optsAutoFloatEnabled){var bakCssText,toolbarBox,orgTop,getPosition,uiUtils=UE.ui.uiUtils,LteIE6=browser.ie&&6>=browser.version,quirks=browser.quirks,placeHolder=document.createElement("div"),flag=!0,defer_updateFloating=utils.defer(function(){updateFloating()},browser.ie?200:100,!0);me.addListener("destroy",function(){domUtils.un(window,["scroll","resize"],updateFloating),me.removeListener("keydown",defer_updateFloating)}),me.addListener("ready",function(){checkHasUI(me)&&(getPosition=uiUtils.getClientRect,toolbarBox=me.ui.getDom("toolbarbox"),orgTop=getPosition(toolbarBox).top,bakCssText=toolbarBox.style.cssText,placeHolder.style.height=toolbarBox.offsetHeight+"px",LteIE6&&fixIE6FixedPos(),me.addListener("autoheightchanged",function(t,enabled){enabled?(domUtils.on(window,["scroll","resize"],updateFloating),me.addListener("keydown",defer_updateFloating)):(domUtils.un(window,["scroll","resize"],updateFloating),me.removeListener("keydown",defer_updateFloating))}),me.addListener("beforefullscreenchange",function(t,enabled){enabled&&unsetFloating()}),me.addListener("fullscreenchanged",function(t,enabled){enabled||updateFloating()}),me.addListener("sourcemodechanged",function(){setTimeout(function(){updateFloating()},0)}))})}},UE.plugins.highlightcode=function(){function adjustHeight(){setTimeout(function(){var div=me.document.getElementById(SyntaxHighlighter.getHighlighterDivId());if(div)for(var li,ri,tds=div.getElementsByTagName("td"),i=0;li=tds[0].childNodes[i];i++)ri=tds[1].firstChild.childNodes[i],ri&&(ri.style.height=li.style.height=ri.offsetHeight+"px")})}function changePre(){for(var pr,i=0,pres=domUtils.getElementsByTagName(me.document,"pre");pr=pres[i++];)if(pr.className.indexOf("brush")>-1){var txt,div,pre=document.createElement("pre");pre.className=pr.className,pre.style.display="none",pre.appendChild(document.createTextNode(pr[browser.ie?"innerText":"textContent"])),document.body.appendChild(pre);try{txt=SyntaxHighlighter.highlight(pre,null,!0)}catch(e){return domUtils.remove(pre),void 0}div=me.document.createElement("div"),div.innerHTML=txt,div.firstChild.setAttribute("highlighter",pre.className),pr.parentNode.insertBefore(div.firstChild,pr),domUtils.remove(pre),domUtils.remove(pr),adjustHeight()}}var me=this;/highlightcode/i.test(me.options.toolbars.join(""))&&(me.commands.highlightcode={execCommand:function(cmdName,code,syntax){if(code&&syntax){var pre=document.createElement("pre");pre.className="brush: "+syntax+";toolbar:false;",pre.style.display="",pre.appendChild(document.createTextNode(code)),document.body.appendChild(pre),me.queryCommandState("highlightcode")&&me.execCommand("highlightcode"),me.execCommand("inserthtml",SyntaxHighlighter.highlight(pre,null,!0),!0);var div=me.document.getElementById(SyntaxHighlighter.getHighlighterDivId());div.setAttribute("highlighter",pre.className),domUtils.remove(pre),adjustHeight()}else{var codediv,range=this.selection.getRange(),start=domUtils.findParentByTagName(range.startContainer,"table",!0),end=domUtils.findParentByTagName(range.endContainer,"table",!0);if(start&&end&&start===end&&start.parentNode.className.indexOf("syntaxhighlighter")>-1){if(codediv=start.parentNode,domUtils.isBody(codediv.parentNode)&&!codediv.nextSibling){var p=me.document.createElement("p");p.innerHTML=browser.ie?"":"<br/>",me.body.insertBefore(p,codediv),range.setStart(p,0)}else range.setStartBefore(codediv);range.setCursor(),domUtils.remove(codediv)}}},queryCommandState:function(){var start,end,range=this.selection.getRange();return range.adjustmentBoundary(),start=domUtils.findParent(range.startContainer,function(node){return 1==node.nodeType&&"DIV"==node.tagName&&domUtils.hasClass(node,"syntaxhighlighter")},!0),end=domUtils.findParent(range.endContainer,function(node){return 1==node.nodeType&&"DIV"==node.tagName&&domUtils.hasClass(node,"syntaxhighlighter")},!0),start&&end&&start==end?1:0}},me.addListener("beforeselectionchange afterselectionchange",function(type){me.highlight=/^b/.test(type)?me.queryCommandState("highlightcode"):0}),me.addListener("ready",function(){"undefined"==typeof XRegExp&&utils.loadFile(document,{id:"syntaxhighlighter_js",src:me.options.highlightJsUrl||me.options.UEDITOR_HOME_URL+"third-party/SyntaxHighlighter/shCore.js",tag:"script",type:"text/javascript",defer:"defer"},function(){changePre()}),me.document.getElementById("syntaxhighlighter_css")||utils.loadFile(me.document,{id:"syntaxhighlighter_css",tag:"link",rel:"stylesheet",type:"text/css",href:me.options.highlightCssUrl||me.options.UEDITOR_HOME_URL+"third-party/SyntaxHighlighter/shCoreDefault.css"})}),me.addListener("beforegetcontent",function(){for(var di,i=0,divs=domUtils.getElementsByTagName(me.body,"div");di=divs[i++];)if("container"==di.className){for(var pN=di.parentNode;pN&&("DIV"!=pN.tagName||!/highlighter/.test(pN.id));)pN=pN.parentNode;if(!pN)return;for(var ci,pre=me.document.createElement("pre"),str=[],c=0;ci=di.childNodes[c++];)str.push(ci[browser.ie?"innerText":"textContent"]);pre.appendChild(me.document.createTextNode(str.join("\n"))),pre.className=pN.getAttribute("highlighter"),pN.parentNode.insertBefore(pre,pN),domUtils.remove(pN)}}),me.addListener("aftergetcontent aftersetcontent",changePre),me.addListener("getAllHtml",function(type,html){for(var ci,coreHtml="",i=0,divs=domUtils.getElementsByTagName(me.document,"div");ci=divs[i++];)if(domUtils.hasClass(ci,"syntaxhighlighter")){me.document.getElementById("syntaxhighlighter_css")||(coreHtml='<link id="syntaxhighlighter_css" rel="stylesheet" type="text/css" href="'+(me.options.highlightCssUrl||me.options.UEDITOR_HOME_URL+'third-party/SyntaxHighlighter/shCoreDefault.css"')+" ></link>"),me.window.XRegExp||(coreHtml+='<script id="syntaxhighlighter_js"  type="text/javascript" src="'+(me.options.highlightJsUrl||me.options.UEDITOR_HOME_URL+'third-party/SyntaxHighlighter/shCore.js"')+" ></script>"+'<script type="text/javascript">window.onload = function(){SyntaxHighlighter.highlight();'+"setTimeout(function(){"+"for(var i=0,di;di=SyntaxHighlighter.highlightContainers[i++];){"+'var tds = di.getElementsByTagName("td");'+"for(var j=0,li,ri;li=tds[0].childNodes[j];j++){"+"ri = tds[1].firstChild.childNodes[j];"+'ri.style.height = li.style.height = ri.offsetHeight + "px";'+"}"+"}},100)}</script>");break}if(!coreHtml){var tmpNode;(tmpNode=me.document.getElementById("syntaxhighlighter_css"))&&domUtils.remove(tmpNode),(tmpNode=me.document.getElementById("syntaxhighlighter_js"))&&domUtils.remove(tmpNode)}html.html+=coreHtml}),me.addListener("fullscreenchanged",function(){for(var di,div=domUtils.getElementsByTagName(me.document,"div"),j=0;di=div[j++];)if(/^highlighter/.test(di.id))for(var li,ri,tds=di.getElementsByTagName("td"),i=0;li=tds[0].childNodes[i];i++)ri=tds[1].firstChild.childNodes[i],ri.style.height=li.style.height=ri.offsetHeight+"px"}))},UE.plugins.serialize=function(){function ptToPx(value){return/pt/.test(value)?value.replace(/([\d.]+)pt/g,function(str){return Math.round(96*parseFloat(str)/72)+"px"}):value}function transNode(node,word_img_flag){var attr,sizeMap=[0,10,12,16,18,24,32,48];switch(utils.indexOf,node.tag){case"script":node.tag="div",node.attributes._ue_org_tagName="script",node.attributes._ue_div_script=1,node.attributes._ue_script_data=node.children[0]?encodeURIComponent(node.children[0].data):"",node.attributes._ue_custom_node_=1,node.children=[];break;case"style":node.tag="div",node.attributes._ue_div_style=1,node.attributes._ue_org_tagName="style",node.attributes._ue_style_data=node.children[0]?encodeURIComponent(node.children[0].data):"",node.attributes._ue_custom_node_=1,node.children=[];break;case"img":if(node.attributes.src&&/^data:/.test(node.attributes.src))return{type:"fragment",children:[]};if(node.attributes.src&&/^(?:file)/.test(node.attributes.src)){if(!/(gif|bmp|png|jpg|jpeg)$/.test(node.attributes.src))return{type:"fragment",children:[]};node.attributes.word_img=node.attributes.src,node.attributes.src=me.options.UEDITOR_HOME_URL+"themes/default/images/spacer.gif";var flag=128>parseInt(node.attributes.width)||43>parseInt(node.attributes.height);node.attributes.style="background:url("+(flag?me.options.themePath+me.options.theme+"/images/word.gif":me.options.langPath+me.options.lang+"/images/localimage.png")+") no-repeat center center;border:1px solid #ddd",word_img_flag&&(word_img_flag.flag=1)}browser.ie&&7>browser.version&&(node.attributes.orgSrc=node.attributes.src),node.attributes.data_ue_src=node.attributes.data_ue_src||node.attributes.src;break;case"li":var child=node.children[0];if(!child||"element"!=child.type||"p"!=child.tag&&dtd.p[child.tag]){var tmpPNode={type:"element",tag:"p",attributes:{},parent:node};tmpPNode.children=child?node.children:[browser.ie?{type:"text",data:domUtils.fillChar,parent:tmpPNode}:{type:"element",tag:"br",attributes:{},closed:!0,children:[],parent:tmpPNode}],node.children=[tmpPNode]}break;case"table":case"td":optStyle(node);break;case"a":node.attributes.anchorname&&(node.tag="img",node.attributes={"class":"anchorclass",anchorname:node.attributes.name},node.closed=1),node.attributes.href&&(node.attributes.data_ue_src=node.attributes.href);break;case"b":node.tag=node.name="strong";break;case"i":node.tag=node.name="em";break;case"u":node.tag=node.name="span",node.attributes.style=(node.attributes.style||"")+";text-decoration:underline;";break;case"s":case"del":node.tag=node.name="span",node.attributes.style=(node.attributes.style||"")+";text-decoration:line-through;",1==node.children.length&&(child=node.children[0],child.tag==node.tag&&(node.attributes.style+=";"+child.attributes.style,node.children=child.children));break;case"span":var style=node.attributes.style;if(style&&(!node.attributes.style||browser.webkit&&"white-space:nowrap;"==style)&&delete node.attributes.style,browser.gecko&&10902>=browser.version&&node.parent){var parent=node.parent;"span"==parent.tag&&parent.attributes&&parent.attributes.style&&(node.attributes.style=parent.attributes.style+";"+node.attributes.style)}utils.isEmptyObject(node.attributes)&&autoClearEmptyNode&&(node.type="fragment");break;case"font":for(node.tag=node.name="span",attr=node.attributes,node.attributes={style:(attr.size?"font-size:"+(sizeMap[attr.size]||12)+"px":"")+";"+(attr.color?"color:"+attr.color:"")+";"+(attr.face?"font-family:"+attr.face:"")+";"+(attr.style||"")};node.parent.tag==node.tag&&1==node.parent.children.length;)node.attributes.style&&(node.parent.attributes.style?node.parent.attributes.style+=";"+node.attributes.style:node.parent.attributes.style=node.attributes.style),node.parent.children=node.children,node=node.parent;break;case"p":node.attributes.align&&(node.attributes.style=(node.attributes.style||"")+";text-align:"+node.attributes.align+";",delete node.attributes.align)}return node}function optStyle(node){if(ie&&node.attributes.style){var style=node.attributes.style;node.attributes.style=style.replace(/;\s*/g,";"),node.attributes.style=node.attributes.style.replace(/^\s*|\s*$/,"")}}function transOutNode(node){switch(node.tag){case"div":node.attributes._ue_div_script&&(node.tag="script",node.children=[{type:"cdata",data:node.attributes._ue_script_data?decodeURIComponent(node.attributes._ue_script_data):"",parent:node}],delete node.attributes._ue_div_script,delete node.attributes._ue_script_data,delete node.attributes._ue_custom_node_,delete node.attributes._ue_org_tagName),node.attributes._ue_div_style&&(node.tag="style",node.children=[{type:"cdata",data:node.attributes._ue_style_data?decodeURIComponent(node.attributes._ue_style_data):"",parent:node}],delete node.attributes._ue_div_style,delete node.attributes._ue_style_data,delete node.attributes._ue_custom_node_,delete node.attributes._ue_org_tagName);break;case"table":!node.attributes.style&&delete node.attributes.style,ie&&node.attributes.style&&optStyle(node),"noBorderTable"==node.attributes["class"]&&delete node.attributes["class"];break;case"td":case"th":if(/display\s*:\s*none/i.test(node.attributes.style))return{type:"fragment",children:[]};if(ie&&!node.children.length){var txtNode={type:"text",data:domUtils.fillChar,parent:node};node.children[0]=txtNode}ie&&node.attributes.style&&optStyle(node),"selectTdClass"==node.attributes["class"]&&delete node.attributes["class"];break;case"img":node.attributes.anchorname?(node.tag="a",node.attributes={name:node.attributes.anchorname,anchorname:1},node.closed=null):node.attributes.data_ue_src&&(node.attributes.src=node.attributes.data_ue_src,delete node.attributes.data_ue_src);break;case"a":node.attributes.data_ue_src&&(node.attributes.href=node.attributes.data_ue_src,delete node.attributes.data_ue_src)}return node}function childrenAccept(node,visit,ctx){if(!node.children||!node.children.length)return node;for(var children=node.children,i=0;children.length>i;i++){var newNode=visit(children[i],ctx);if("fragment"==newNode.type){var args=[i,1];args.push.apply(args,newNode.children),children.splice.apply(children,args),children.length||(node={type:"fragment",children:[]}),i--}else children[i]=newNode}return node}function Serialize(rules){this.rules=rules}var ie=browser.ie,version=browser.version,me=this,autoClearEmptyNode=me.options.autoClearEmptyNode,EMPTY_TAG=dtd.$empty,parseHTML=function(){function parse(html,callbacks){var match,tagName,cdata,nextIndex=0;for(RE_PART.exec("");match=RE_PART.exec(html);){var tagIndex=match.index;if(tagIndex>nextIndex){var text=html.slice(nextIndex,tagIndex);cdata?cdata.push(text):callbacks.onText(text)}if(nextIndex=RE_PART.lastIndex,!(tagName=match[1])||(tagName=tagName.toLowerCase(),cdata&&tagName==cdata._tag_name&&(callbacks.onCDATA(cdata.join("")),cdata=null),cdata))if(cdata)cdata.push(match[0]);else if(tagName=match[3]){if(/="/.test(tagName))continue;tagName=tagName.toLowerCase();var attrMatch,attrPart=match[4],attrMap={},selfClosing=attrPart&&"/"==attrPart.slice(-1);if(attrPart)for(RE_ATTR.exec("");attrMatch=RE_ATTR.exec(attrPart);){var attrName=attrMatch[1].toLowerCase(),attrValue=attrMatch[2]||attrMatch[3]||attrMatch[4]||"";!attrValue&&EMPTY_ATTR[attrName]&&(attrValue=attrName),"style"==attrName&&ie&&6>=version&&(attrValue=attrValue.replace(/(?!;)\s*([\w-]+):/g,function(m,p1){return p1.toLowerCase()+":"})),attrValue&&(attrMap[attrName]=attrValue.replace(/:\s*/g,":"))}callbacks.onTagOpen(tagName,attrMap,selfClosing),!cdata&&CDATA_TAG[tagName]&&(cdata=[],cdata._tag_name=tagName)}else(tagName=match[2])&&callbacks.onComment(tagName);else callbacks.onTagClose(tagName)}html.length>nextIndex&&callbacks.onText(html.slice(nextIndex,html.length))}var RE_PART=/<(?:(?:\/([^>]+)>)|(?:!--([\S|\s]*?)-->)|(?:([^\s\/>]+)\s*((?:(?:"[^"]*")|(?:'[^']*')|[^"'<>])*)\/?>))/g,RE_ATTR=/([\w\-:.]+)(?:(?:\s*=\s*(?:(?:"([^"]*)")|(?:'([^']*)')|([^\s>]+)))|(?=\s|$))/g,EMPTY_ATTR={checked:1,compact:1,declare:1,defer:1,disabled:1,ismap:1,multiple:1,nohref:1,noresize:1,noshade:1,nowrap:1,readonly:1,selected:1},CDATA_TAG={script:1,style:1},NEED_PARENT_TAG={li:{$:"ul",ul:1,ol:1},dd:{$:"dl",dl:1},dt:{$:"dl",dl:1},option:{$:"select",select:1},td:{$:"tr",tr:1},th:{$:"tr",tr:1},tr:{$:"tbody",tbody:1,thead:1,tfoot:1,table:1},tbody:{$:"table",table:1,colgroup:1},thead:{$:"table",table:1},tfoot:{$:"table",table:1},col:{$:"colgroup",colgroup:1}},NEED_CHILD_TAG={table:"td",tbody:"td",thead:"td",tfoot:"td",tr:"td",colgroup:"col",ul:"li",ol:"li",dl:"dd",select:"option"};return function(html,forceDtd){function addChild(node){node.parent=currentNode,currentNode.children.push(node)}function addElement(element,open){var node=element;if(NEED_PARENT_TAG[node.tag]){for(;NEED_PARENT_TAG[currentNode.tag]&&NEED_PARENT_TAG[currentNode.tag][node.tag];)currentNode=currentNode.parent;for(currentNode.tag==node.tag&&(currentNode=currentNode.parent);NEED_PARENT_TAG[node.tag]&&!NEED_PARENT_TAG[node.tag][currentNode.tag];)node=node.parent={type:"element",tag:NEED_PARENT_TAG[node.tag].$,attributes:{},children:[node]}}if(forceDtd)for(;dtd[node.tag]&&!("span"==currentNode.tag?utils.extend(dtd.strong,{a:1,A:1}):dtd[currentNode.tag]||dtd.div)[node.tag];)if(!tagEnd(currentNode)){if(!currentNode.parent)break;currentNode=currentNode.parent}return node.parent=currentNode,currentNode.children.push(node),open&&(currentNode=element),element.attributes.style&&(element.attributes.style=element.attributes.style.toLowerCase()),element}function tagEnd(node){var needTag;return!node.children.length&&(needTag=NEED_CHILD_TAG[node.tag])?(addElement({type:"element",tag:needTag,attributes:{},children:[]},!0),!0):!1}var fragment={type:"fragment",parent:null,children:[]},currentNode=fragment;for(parse(html,{onText:function(text){for(;!(dtd[currentNode.tag]||dtd.div)["#"];)tagEnd(currentNode)||(currentNode=currentNode.parent);addChild({type:"text",data:text})},onComment:function(text){addChild({type:"comment",data:text})},onCDATA:function(text){for(;!(dtd[currentNode.tag]||dtd.div)["#"];)tagEnd(currentNode)||(currentNode=currentNode.parent);addChild({type:"cdata",data:text})},onTagOpen:function(tag,attrs,closed){closed=closed||EMPTY_TAG[tag],addElement({type:"element",tag:tag,attributes:attrs,closed:closed,children:[]},!closed)},onTagClose:function(tag){for(var node=currentNode;node&&tag!=node.tag;)node=node.parent;if(node){for(var tnode=currentNode;tnode!==node.parent;tnode=tnode.parent)tagEnd(tnode);currentNode=node.parent}else dtd.$removeEmpty[tag]||dtd.$removeEmptyBlock[tag]||"embed"==tag||(node={type:"element",tag:tag,attributes:{},children:[]},addElement(node,!0),tagEnd(node),currentNode=node.parent)}});currentNode!==fragment;)tagEnd(currentNode),currentNode=currentNode.parent;return fragment}}(),unhtml1=function(){function rep(m){return map[m]}var map={"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};return function(str){return str+="",str?str.replace(/[<>"']/g,rep):""}}(),toHTML=function(){function printChildren(node,pasteplain){for(var ci,children=node.children,buff=[],i=0;ci=children[i];i++)buff.push(toHTML(ci,pasteplain));return buff.join("")}function printAttrs(attrs){var buff=[];for(var k in attrs){var value=attrs[k];"style"==k&&(value=ptToPx(value),/rgba?\s*\([^)]*\)/.test(value)&&(value=value.replace(/rgba?\s*\(([^)]*)\)/g,function(str){return utils.fixColor("color",str)})),attrs[k]=utils.optCss(value.replace(/windowtext/g,"#000")).replace(/white-space[^;]+;/g,"")),buff.push(k+'="'+unhtml1(attrs[k])+'"')}return buff.join(" ")}function printData(node,notTrans){return notTrans?node.data.replace(/&nbsp;/g," "):unhtml1(node.data).replace(/ /g,"&nbsp;")}function printElement(node,pasteplain){if("element"==node.type&&!node.children.length&&dtd.$removeEmpty[node.tag]&&"a"!=node.tag&&utils.isEmptyObject(node.attributes)&&autoClearEmptyNode)return html;var tag=node.tag;if(pasteplain&&"td"==tag)html||(html=""),html+=printChildren(node,pasteplain)+"&nbsp;&nbsp;&nbsp;";else{var attrs=printAttrs(node.attributes),html="<"+(pasteplain&&transHtml[tag]?transHtml[tag]:tag)+(attrs?" "+attrs:"")+(EMPTY_TAG[tag]?" />":">");EMPTY_TAG[tag]||("p"!=tag||node.children.length||(html+=browser.ie?"&nbsp;":"<br/>"),html+=printChildren(node,pasteplain),html+="</"+(pasteplain&&transHtml[tag]?transHtml[tag]:tag)+">")}return html}var transHtml={div:"p",li:"p",tr:"p",br:"br",p:"p"};return function(node,pasteplain){return"fragment"==node.type?printChildren(node,pasteplain):"element"==node.type?printElement(node,pasteplain):"text"==node.type||"cdata"==node.type?printData(node,dtd.$notTransContent[node.parent.tag]):"comment"==node.type?"<!--"+node.data+"-->":""}}(),NODE_NAME_MAP={text:"#text",comment:"#comment",cdata:"#cdata-section",fragment:"#document-fragment"};Serialize.prototype={rules:null,filter:function(node,rules,modify){function visitNode(node,parent){if(node.name="element"==node.type?node.tag:NODE_NAME_MAP[node.type],null==parent)return childrenAccept(node,visitNode,node);if(blackList&&(blackList[node.name]||node.attributes&&node.attributes._ue_org_tagName&&blackList[node.attributes._ue_org_tagName]))return modify&&(modify.flag=1),{type:"fragment",children:[]};if(whiteList&&"element"==node.type)if("fragment"==parent.type?whiteList[node.name]:whiteList[node.name]&&whiteList[parent.name][node.name]){var props;if(props=whiteList[node.name].$){var oldAttrs=node.attributes,newAttrs={};for(var k in props)oldAttrs[k]&&(newAttrs[k]=oldAttrs[k]);node.attributes=newAttrs}}else modify&&(modify.flag=1),node.type="fragment",node.name=parent.name;return(blackList||whiteList)&&childrenAccept(node,visitNode,node),node}rules=rules||this.rules;var whiteList=rules&&rules.whiteList,blackList=rules&&rules.blackList;return visitNode(node,null)},transformInput:function(node,word_img_flag){function visitNode(node){return node=transNode(node,word_img_flag),node=childrenAccept(node,visitNode,node),me.options.pageBreakTag&&"text"==node.type&&node.data.replace(/\s/g,"")==me.options.pageBreakTag&&(node.type="element",node.name=node.tag="hr",delete node.data,node.attributes={"class":"pagebreak",noshade:"noshade",size:"5",unselectable:"on",style:"moz-user-select:none;-khtml-user-select: none;"},node.children=[]),"text"!=node.type||dtd.$notTransContent[node.parent.tag]||(node.data=node.data.replace(/[\r\t\n]*/g,"")),node}return visitNode(node)},transformOutput:function(node){function visitNode(node){return"hr"==node.tag&&"pagebreak"==node.attributes["class"]&&(delete node.tag,node.type="text",node.data=me.options.pageBreakTag,delete node.children),node=transOutNode(node),node=childrenAccept(node,visitNode,node)}return visitNode(node)},toHTML:toHTML,parseHTML:parseHTML,word:UE.filterWord},me.serialize=new Serialize(me.options.serialize||{}),UE.serialize=new Serialize({})},UE.plugins.basestyle=function(){var basestyles={bold:["strong","b"],italic:["em","i"],subscript:["sub"],superscript:["sup"]},getObj=function(editor,tagNames){return domUtils.filterNodeList(editor.selection.getStartElementPath(),tagNames)},me=this;for(var style in basestyles)(function(cmd,tagNames){me.commands[cmd]={execCommand:function(cmdName){var range=new dom.Range(me.document),obj="";if(me.currentSelectedArr&&me.currentSelectedArr.length>0){for(var ci,i=0;ci=me.currentSelectedArr[i++];)"none"!=ci.style.display&&(range.selectNodeContents(ci).select(),!obj&&(obj=getObj(this,tagNames)),("superscript"==cmdName||"subscript"==cmdName)&&(obj&&obj.tagName.toLowerCase()==cmdName||range.removeInlineStyle(["sub","sup"])),obj?range.removeInlineStyle(tagNames):range.applyInlineStyle(tagNames[0]));range.selectNodeContents(me.currentSelectedArr[0]).select()}else{if(range=me.selection.getRange(),obj=getObj(this,tagNames),range.collapsed){if(obj){var tmpText=me.document.createTextNode("");range.insertNode(tmpText).removeInlineStyle(tagNames),range.setStartBefore(tmpText),domUtils.remove(tmpText)}else{var tmpNode=range.document.createElement(tagNames[0]);("superscript"==cmdName||"subscript"==cmdName)&&(tmpText=me.document.createTextNode(""),range.insertNode(tmpText).removeInlineStyle(["sub","sup"]).setStartBefore(tmpText).collapse(!0)),range.insertNode(tmpNode).setStart(tmpNode,0)}range.collapse(!0)}else("superscript"==cmdName||"subscript"==cmdName)&&(obj&&obj.tagName.toLowerCase()==cmdName||range.removeInlineStyle(["sub","sup"])),obj?range.removeInlineStyle(tagNames):range.applyInlineStyle(tagNames[0]);range.select()}return!0},queryCommandState:function(){return this.highlight?-1:getObj(this,tagNames)?1:0}}})(style,basestyles[style])},UE.plugins.selectall=function(){var me=this;me.commands.selectall={execCommand:function(){var me=this,body=me.body,range=me.selection.getRange();range.selectNodeContents(body),domUtils.isEmptyBlock(body)&&(browser.opera&&body.firstChild&&1==body.firstChild.nodeType&&range.setStartAtFirst(body.firstChild),range.collapse(!0)),range.select(!0),this.selectAll=!0},notNeedUndo:1},me.addListener("ready",function(){domUtils.on(me.document,"click",function(){me.selectAll=!1})})},UE.commands.horizontal={execCommand:function(cmdName){var me=this;if(-1!==me.queryCommandState(cmdName)){me.execCommand("insertHtml","<hr>");var range=me.selection.getRange(),start=range.startContainer;if(1==start.nodeType&&!start.childNodes[range.startOffset]){var tmp;(tmp=start.childNodes[range.startOffset-1])&&1==tmp.nodeType&&"HR"==tmp.tagName&&("p"==me.options.enterTag?(tmp=me.document.createElement("p"),range.insertNode(tmp),range.setStart(tmp,0).setCursor()):(tmp=me.document.createElement("br"),range.insertNode(tmp),range.setStartBefore(tmp).setCursor()))}return!0}},queryCommandState:function(){return this.highlight||domUtils.filterNodeList(this.selection.getStartElementPath(),"table")?-1:0}},UE.commands.kimage={execCommand:function(){$("#btn-image").trigger("click")}},UE.commands.klink={execCommand:function(){$("#btn-link").trigger("click")}},UE.commands.kvideo={execCommand:function(){$("#btn-video").trigger("click")}},UE.plugins.cleanformat=function(){function isLine(node,notEmpty){return node&&3!=node.nodeType?domUtils.isBr(node)?1:node&&node.parentNode&&tags[node.tagName.toLowerCase()]?highlightCont&&highlightCont.contains(node)||node.getAttribute("pagebreak")?0:notEmpty?!domUtils.isEmptyBlock(node):domUtils.isEmptyBlock(node):void 0:0}function autotype(type,html){var cont;if(html){if(!opt.pasteFilter)return;cont=me.document.createElement("div"),cont.innerHTML=html.html}else cont=me.document.body;for(var ci,nodes=domUtils.getElementsByTagName(cont,"*"),i=0;ci=nodes[i++];){if(!highlightCont&&"DIV"==ci.tagName&&ci.getAttribute("highlighter")&&(highlightCont=ci),domUtils.removeAttributes(ci,["style"]),isLine(ci)){if(opt.mergeEmptyline)for(var tmpNode,next=ci.nextSibling,isBr=domUtils.isBr(ci);isLine(next)&&(tmpNode=next,next=tmpNode.nextSibling,!isBr||next&&(!next||domUtils.isBr(next)));)domUtils.remove(tmpNode);if(opt.removeEmptyline&&domUtils.inDoc(ci,cont)&&!remainTag[ci.parentNode.tagName.toLowerCase()]){if(domUtils.isBr(ci)&&(next=ci.nextSibling,next&&!domUtils.isBr(next)))continue;domUtils.remove(ci);continue}}if(isLine(ci,!0)&&"SPAN"!=ci.tagName&&(opt.indent&&(ci.style.textIndent=opt.indentValue),opt.textAlign&&(ci.style.textAlign=opt.textAlign)),opt.removeClass&&ci.className&&!remainClass[ci.className.toLowerCase()]){if(highlightCont&&highlightCont.contains(ci))continue;domUtils.removeAttributes(ci,["class"])}opt.removeEmptyNode&&opt.removeTagNames[ci.tagName.toLowerCase()]&&domUtils.hasNoAttributes(ci)&&domUtils.isEmptyBlock(ci)&&domUtils.remove(ci)}html&&(html.html=cont.innerHTML)}this.setOpt({cleanformat:{mergeEmptyline:!0,removeClass:!0,removeEmptyline:!1,textAlign:"left",imageBlockLine:"center",pasteFilter:!0,removeEmptyNode:!1,removeTagNames:utils.extend({div:1},dtd.$removeEmpty),indent:!1,indentValue:"2em"}});var highlightCont,me=this,opt=me.options.cleanformat,remainClass={selectTdClass:1,pagebreak:1,anchorclass:1},remainTag={li:1},tags={div:1,p:1,blockquote:1,center:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,span:1};opt&&(opt.pasteFilter&&me.addListener("beforepaste",autotype),me.commands.cleanformat={execCommand:function(){me.removeListener("beforepaste",autotype),opt.pasteFilter&&me.addListener("beforepaste",autotype),autotype()}})};var baidu=baidu||{};baidu.editor=baidu.editor||{},baidu.editor.ui={},function(){function updateFixedOffset(){var layer=document.getElementById("edui_fixedlayer");uiUtils.setViewportOffset(layer,{left:0,top:0})}function bindFixedLayer(){domUtils.on(window,"scroll",updateFixedOffset),domUtils.on(window,"resize",baidu.editor.utils.defer(updateFixedOffset,0,!0))}var browser=baidu.editor.browser,domUtils=baidu.editor.dom.domUtils,magic="$EDITORUI",root=window[magic]={},uidMagic="ID"+magic,uidCount=0,uiUtils=baidu.editor.ui.uiUtils={uid:function(obj){return obj?obj[uidMagic]||(obj[uidMagic]=++uidCount):++uidCount},hook:function(fn,callback){var dg;return fn&&fn._callbacks?dg=fn:(dg=function(){var q;fn&&(q=fn.apply(this,arguments));for(var callbacks=dg._callbacks,k=callbacks.length;k--;){var r=callbacks[k].apply(this,arguments);void 0===q&&(q=r)}return q},dg._callbacks=[]),dg._callbacks.push(callback),dg},createElementByHtml:function(html){var el=document.createElement("div");return el.innerHTML=html,el=el.firstChild,el.parentNode.removeChild(el),el},getViewportElement:function(){return browser.ie&&browser.quirks?document.body:document.documentElement},getClientRect:function(element){var bcr;try{bcr=element.getBoundingClientRect()}catch(e){bcr={left:0,top:0,height:0,width:0}}for(var doc,rect={left:Math.round(bcr.left),top:Math.round(bcr.top),height:Math.round(bcr.bottom-bcr.top),width:Math.round(bcr.right-bcr.left)};(doc=element.ownerDocument)!==document&&(element=domUtils.getWindow(doc).frameElement);)bcr=element.getBoundingClientRect(),rect.left+=bcr.left,rect.top+=bcr.top;return rect.bottom=rect.top+rect.height,rect.right=rect.left+rect.width,rect},getViewportRect:function(){var viewportEl=uiUtils.getViewportElement(),width=0|(window.innerWidth||viewportEl.clientWidth),height=0|(window.innerHeight||viewportEl.clientHeight);return{left:0,top:0,height:height,width:width,bottom:height,right:width}},setViewportOffset:function(element,offset){var fixedLayer=uiUtils.getFixedLayer();element.parentNode===fixedLayer?(element.style.left=offset.left+"px",element.style.top=offset.top+"px"):domUtils.setViewportOffset(element,offset)},getEventOffset:function(evt){var el=evt.target||evt.srcElement,rect=uiUtils.getClientRect(el),offset=uiUtils.getViewportOffsetByEvent(evt);return{left:offset.left-rect.left,top:offset.top-rect.top}},getViewportOffsetByEvent:function(evt){var el=evt.target||evt.srcElement,frameEl=domUtils.getWindow(el).frameElement,offset={left:evt.clientX,top:evt.clientY};if(frameEl&&el.ownerDocument!==document){var rect=uiUtils.getClientRect(frameEl);offset.left+=rect.left,offset.top+=rect.top}return offset},setGlobal:function(id,obj){return root[id]=obj,magic+'["'+id+'"]'},unsetGlobal:function(id){delete root[id]},copyAttributes:function(tgt,src){for(var attributes=src.attributes,k=attributes.length;k--;){var attrNode=attributes[k];
"style"==attrNode.nodeName||"class"==attrNode.nodeName||browser.ie&&!attrNode.specified||tgt.setAttribute(attrNode.nodeName,attrNode.nodeValue)}src.className&&domUtils.addClass(tgt,src.className),src.style.cssText&&(tgt.style.cssText+=";"+src.style.cssText)},removeStyle:function(el,styleName){if(el.style.removeProperty)el.style.removeProperty(styleName);else{if(!el.style.removeAttribute)throw"";el.style.removeAttribute(styleName)}},contains:function(elA,elB){return elA&&elB&&(elA===elB?!1:elA.contains?elA.contains(elB):16&elA.compareDocumentPosition(elB))},startDrag:function(evt,callbacks,doc){function handleMouseMove(evt){var x=evt.clientX-startX,y=evt.clientY-startY;callbacks.ondragmove(x,y),evt.stopPropagation?evt.stopPropagation():evt.cancelBubble=!0}function handleMouseUp(){doc.removeEventListener("mousemove",handleMouseMove,!0),doc.removeEventListener("mouseup",handleMouseMove,!0),window.removeEventListener("mouseup",handleMouseUp,!0),callbacks.ondragstop()}function releaseCaptrue(){elm.releaseCapture(),elm.detachEvent("onmousemove",handleMouseMove),elm.detachEvent("onmouseup",releaseCaptrue),elm.detachEvent("onlosecaptrue",releaseCaptrue),callbacks.ondragstop()}var doc=doc||document,startX=evt.clientX,startY=evt.clientY;if(doc.addEventListener)doc.addEventListener("mousemove",handleMouseMove,!0),doc.addEventListener("mouseup",handleMouseUp,!0),window.addEventListener("mouseup",handleMouseUp,!0),evt.preventDefault();else{var elm=evt.srcElement;elm.setCapture(),elm.attachEvent("onmousemove",handleMouseMove),elm.attachEvent("onmouseup",releaseCaptrue),elm.attachEvent("onlosecaptrue",releaseCaptrue),evt.returnValue=!1}callbacks.ondragstart()},getFixedLayer:function(){var layer=document.getElementById("edui_fixedlayer");return null==layer&&(layer=document.createElement("div"),layer.id="edui_fixedlayer",document.body.appendChild(layer),browser.ie&&8>=browser.version?(layer.style.position="absolute",bindFixedLayer(),setTimeout(updateFixedOffset)):layer.style.position="fixed",layer.style.left="0",layer.style.top="0",layer.style.width="0",layer.style.height="0"),layer},makeUnselectable:function(element){if(browser.opera||browser.ie&&9>browser.version){if(element.unselectable="on",element.hasChildNodes())for(var i=0;element.childNodes.length>i;i++)1==element.childNodes[i].nodeType&&uiUtils.makeUnselectable(element.childNodes[i])}else void 0!==element.style.MozUserSelect?element.style.MozUserSelect="none":void 0!==element.style.WebkitUserSelect?element.style.WebkitUserSelect="none":void 0!==element.style.KhtmlUserSelect&&(element.style.KhtmlUserSelect="none")}}}(),function(){var utils=baidu.editor.utils,uiUtils=baidu.editor.ui.uiUtils,EventBase=baidu.editor.EventBase,UIBase=baidu.editor.ui.UIBase=function(){};UIBase.prototype={className:"",uiName:"",initOptions:function(options){var me=this;for(var k in options)me[k]=options[k];this.id=this.id||"edui"+uiUtils.uid()},initUIBase:function(){this._globalKey=utils.unhtml(uiUtils.setGlobal(this.id,this))},render:function(holder){for(var node,html=this.renderHtml(),el=uiUtils.createElementByHtml(html),list=domUtils.getElementsByTagName(el,"*"),theme="edui-"+(this.theme||this.editor.options.theme),layer=document.getElementById("edui_fixedlayer"),i=0;node=list[i++];)domUtils.addClass(node,theme);domUtils.addClass(el,theme),layer&&(layer.className="",domUtils.addClass(layer,theme));var seatEl=this.getDom();null!=seatEl?(seatEl.parentNode.replaceChild(el,seatEl),uiUtils.copyAttributes(el,seatEl)):("string"==typeof holder&&(holder=document.getElementById(holder)),holder=holder||uiUtils.getFixedLayer(),domUtils.addClass(holder,theme),holder.appendChild(el)),this.postRender()},getDom:function(name){return name?document.getElementById(this.id+"_"+name):document.getElementById(this.id)},postRender:function(){this.fireEvent("postrender")},getHtmlTpl:function(){return""},formatHtml:function(tpl){var prefix="edui-"+this.uiName;return tpl.replace(/##/g,this.id).replace(/%%-/g,this.uiName?prefix+"-":"").replace(/%%/g,(this.uiName?prefix:"")+" "+this.className).replace(/\$\$/g,this._globalKey)},renderHtml:function(){return this.formatHtml(this.getHtmlTpl())},dispose:function(){var box=this.getDom();box&&baidu.editor.dom.domUtils.remove(box),uiUtils.unsetGlobal(this.id)}},utils.inherits(UIBase,EventBase)}(),function(){var utils=baidu.editor.utils,UIBase=baidu.editor.ui.UIBase,Separator=baidu.editor.ui.Separator=function(options){this.initOptions(options),this.initSeparator()};Separator.prototype={uiName:"separator",initSeparator:function(){this.initUIBase()},getHtmlTpl:function(){return'<div id="##" class="edui-box %%"></div>'}},utils.inherits(Separator,UIBase)}(),function(){var utils=baidu.editor.utils,domUtils=baidu.editor.dom.domUtils,UIBase=baidu.editor.ui.UIBase,uiUtils=baidu.editor.ui.uiUtils,Mask=baidu.editor.ui.Mask=function(options){this.initOptions(options),this.initUIBase()};Mask.prototype={getHtmlTpl:function(){return'<div id="##" class="edui-mask %%" onmousedown="return $$._onMouseDown(event, this);"></div>'},postRender:function(){var me=this;domUtils.on(window,"resize",function(){setTimeout(function(){me.isHidden()||me._fill()})})},show:function(zIndex){this._fill(),this.getDom().style.display="",this.getDom().style.zIndex=zIndex},hide:function(){this.getDom().style.display="none",this.getDom().style.zIndex=""},isHidden:function(){return"none"==this.getDom().style.display},_onMouseDown:function(){return!1},_fill:function(){var el=this.getDom(),vpRect=uiUtils.getViewportRect();el.style.width=vpRect.width+"px",el.style.height=vpRect.height+"px"}},utils.inherits(Mask,UIBase)}(),function(){function closeAllPopup(el){for(var i=0;allPopups.length>i;i++){var pop=allPopups[i];pop.isHidden()||pop.queryAutoHide(el)!==!1&&pop.hide()}}var utils=baidu.editor.utils,uiUtils=baidu.editor.ui.uiUtils,domUtils=baidu.editor.dom.domUtils,UIBase=baidu.editor.ui.UIBase,Popup=baidu.editor.ui.Popup=function(options){this.initOptions(options),this.initPopup()},allPopups=[];Popup.postHide=closeAllPopup;var ANCHOR_CLASSES=["edui-anchor-topleft","edui-anchor-topright","edui-anchor-bottomleft","edui-anchor-bottomright"];Popup.prototype={SHADOW_RADIUS:5,content:null,_hidden:!1,autoRender:!0,canSideLeft:!0,canSideUp:!0,initPopup:function(){this.initUIBase(),allPopups.push(this)},getHtmlTpl:function(){return'<div id="##" class="edui-popup %%"> <div id="##_body" class="edui-popup-body"> <iframe style="position:absolute;z-index:-1;left:0;top:0;background-color: transparent;" frameborder="0" width="100%" height="100%" src="javascript:"></iframe> <div class="edui-shadow"></div> <div id="##_content" class="edui-popup-content">'+this.getContentHtmlTpl()+"  </div>"+" </div>"+"</div>"},getContentHtmlTpl:function(){return this.content?"string"==typeof this.content?this.content:this.content.renderHtml():""},_UIBase_postRender:UIBase.prototype.postRender,postRender:function(){this.content instanceof UIBase&&this.content.postRender(),this.fireEvent("postRenderAfter"),this.hide(!0),this._UIBase_postRender()},_doAutoRender:function(){!this.getDom()&&this.autoRender&&this.render()},mesureSize:function(){var box=this.getDom("content");return uiUtils.getClientRect(box)},fitSize:function(){var popBodyEl=this.getDom("body");popBodyEl.style.width="",popBodyEl.style.height="";var size=this.mesureSize();return popBodyEl.style.width=size.width+"px",popBodyEl.style.height=size.height+"px",size},showAnchor:function(element,hoz){this.showAnchorRect(uiUtils.getClientRect(element),hoz)},showAnchorRect:function(rect,hoz){this._doAutoRender();var vpRect=uiUtils.getViewportRect();this._show();var sideLeft,sideUp,left,top,popSize=this.fitSize();hoz?(sideLeft=this.canSideLeft&&rect.right+popSize.width>vpRect.right&&rect.left>popSize.width,sideUp=this.canSideUp&&rect.top+popSize.height>vpRect.bottom&&rect.bottom>popSize.height,left=sideLeft?rect.left-popSize.width:rect.right,top=sideUp?rect.bottom-popSize.height:rect.top):(sideLeft=this.canSideLeft&&rect.right+popSize.width>vpRect.right&&rect.left>popSize.width,sideUp=this.canSideUp&&rect.top+popSize.height>vpRect.bottom&&rect.bottom>popSize.height,left=sideLeft?rect.right-popSize.width:rect.left,top=sideUp?rect.top-popSize.height:rect.bottom);var popEl=this.getDom();uiUtils.setViewportOffset(popEl,{left:left,top:top}),domUtils.removeClasses(popEl,ANCHOR_CLASSES),popEl.className+=" "+ANCHOR_CLASSES[2*(sideUp?1:0)+(sideLeft?1:0)],this.editor&&(popEl.style.zIndex=1*this.editor.container.style.zIndex+10,baidu.editor.ui.uiUtils.getFixedLayer().style.zIndex=popEl.style.zIndex-1)},showAt:function(offset){var left=offset.left,top=offset.top,rect={left:left,top:top,right:left,bottom:top,height:0,width:0};this.showAnchorRect(rect,!1,!0)},_show:function(){if(this._hidden){var box=this.getDom();box.style.display="",this._hidden=!1,this.fireEvent("show")}},isHidden:function(){return this._hidden},show:function(){this._doAutoRender(),this._show()},hide:function(notNofity){!this._hidden&&this.getDom()&&(this.getDom().style.display="none",this._hidden=!0,notNofity||this.fireEvent("hide"))},queryAutoHide:function(el){return!el||!uiUtils.contains(this.getDom(),el)}},utils.inherits(Popup,UIBase),domUtils.on(document,"mousedown",function(evt){var el=evt.target||evt.srcElement;closeAllPopup(el)}),domUtils.on(window,"scroll",function(){closeAllPopup()})}(),function(){function genColorPicker(noColorText,editor){for(var html='<div id="##" class="edui-colorpicker %%"><div class="edui-colorpicker-topbar edui-clearfix"><div unselectable="on" id="##_preview" class="edui-colorpicker-preview"></div><div unselectable="on" class="edui-colorpicker-nocolor" onclick="$$._onPickNoColor(event, this);">'+noColorText+"</div>"+"</div>"+'<table  class="edui-box" style="border-collapse: collapse;" onmouseover="$$._onTableOver(event, this);" onmouseout="$$._onTableOut(event, this);" onclick="return $$._onTableClick(event, this);" cellspacing="0" cellpadding="0">'+'<tr style="border-bottom: 1px solid #ddd;font-size: 13px;line-height: 25px;color:#39C;padding-top: 2px"><td colspan="10">'+editor.getLang("themeColor")+"</td> </tr>"+'<tr class="edui-colorpicker-tablefirstrow" >',i=0;COLORS.length>i;i++)i&&0===i%10&&(html+="</tr>"+(60==i?'<tr style="border-bottom: 1px solid #ddd;font-size: 13px;line-height: 25px;color:#39C;"><td colspan="10">'+editor.getLang("standardColor")+"</td></tr>":"")+"<tr"+(60==i?' class="edui-colorpicker-tablefirstrow"':"")+">"),html+=70>i?'<td style="padding: 0 2px;"><a hidefocus title="'+COLORS[i]+'" onclick="return false;" href="javascript:" unselectable="on" class="edui-box edui-colorpicker-colorcell"'+' data-color="#'+COLORS[i]+'"'+' style="background-color:#'+COLORS[i]+";border:solid #ccc;"+(10>i||i>=60?"border-width:1px;":i>=10&&20>i?"border-width:1px 1px 0 1px;":"border-width:0 1px 0 1px;")+'"'+"></a></td>":"";return html+="</tr></table></div>"}var utils=baidu.editor.utils,UIBase=baidu.editor.ui.UIBase,ColorPicker=baidu.editor.ui.ColorPicker=function(options){this.initOptions(options),this.noColorText=this.noColorText||this.editor.getLang("clearColor"),this.initUIBase()};ColorPicker.prototype={getHtmlTpl:function(){return genColorPicker(this.noColorText,this.editor)},_onTableClick:function(evt){var tgt=evt.target||evt.srcElement,color=tgt.getAttribute("data-color");color&&this.fireEvent("pickcolor",color)},_onTableOver:function(evt){var tgt=evt.target||evt.srcElement,color=tgt.getAttribute("data-color");color&&(this.getDom("preview").style.backgroundColor=color)},_onTableOut:function(){this.getDom("preview").style.backgroundColor=""},_onPickNoColor:function(){this.fireEvent("picknocolor")}},utils.inherits(ColorPicker,UIBase);var COLORS="ffffff,000000,eeece1,1f497d,4f81bd,c0504d,9bbb59,8064a2,4bacc6,f79646,f2f2f2,7f7f7f,ddd9c3,c6d9f0,dbe5f1,f2dcdb,ebf1dd,e5e0ec,dbeef3,fdeada,d8d8d8,595959,c4bd97,8db3e2,b8cce4,e5b9b7,d7e3bc,ccc1d9,b7dde8,fbd5b5,bfbfbf,3f3f3f,938953,548dd4,95b3d7,d99694,c3d69b,b2a2c7,92cddc,fac08f,a5a5a5,262626,494429,17365d,366092,953734,76923c,5f497a,31859b,e36c09,7f7f7f,0c0c0c,1d1b10,0f243e,244061,632423,4f6128,3f3151,205867,974806,c00000,ff0000,ffc000,ffff00,92d050,00b050,00b0f0,0070c0,002060,7030a0,".split(",")}(),function(){var browser=baidu.editor.browser,domUtils=baidu.editor.dom.domUtils,uiUtils=baidu.editor.ui.uiUtils,TPL_STATEFUL='onmousedown="$$.Stateful_onMouseDown(event, this);" onmouseup="$$.Stateful_onMouseUp(event, this);"'+(browser.ie?' onmouseenter="$$.Stateful_onMouseEnter(event, this);" onmouseleave="$$.Stateful_onMouseLeave(event, this);"':' onmouseover="$$.Stateful_onMouseOver(event, this);" onmouseout="$$.Stateful_onMouseOut(event, this);"');baidu.editor.ui.Stateful={alwalysHoverable:!1,Stateful_init:function(){this._Stateful_dGetHtmlTpl=this.getHtmlTpl,this.getHtmlTpl=this.Stateful_getHtmlTpl},Stateful_getHtmlTpl:function(){var tpl=this._Stateful_dGetHtmlTpl();return tpl.replace(/stateful/g,function(){return TPL_STATEFUL})},Stateful_onMouseEnter:function(){(!this.isDisabled()||this.alwalysHoverable)&&(this.addState("hover"),this.fireEvent("over"))},Stateful_onMouseLeave:function(){(!this.isDisabled()||this.alwalysHoverable)&&(this.removeState("hover"),this.removeState("active"),this.fireEvent("out"))},Stateful_onMouseOver:function(evt,el){var rel=evt.relatedTarget;uiUtils.contains(el,rel)||el===rel||this.Stateful_onMouseEnter(evt,el)},Stateful_onMouseOut:function(evt,el){var rel=evt.relatedTarget;uiUtils.contains(el,rel)||el===rel||this.Stateful_onMouseLeave(evt,el)},Stateful_onMouseDown:function(){this.isDisabled()||this.addState("active")},Stateful_onMouseUp:function(){this.isDisabled()||this.removeState("active")},Stateful_postRender:function(){this.disabled&&!this.hasState("disabled")&&this.addState("disabled")},hasState:function(state){return domUtils.hasClass(this.getStateDom(),"edui-state-"+state)},addState:function(state){this.hasState(state)||(this.getStateDom().className+=" edui-state-"+state)},removeState:function(state){this.hasState(state)&&domUtils.removeClasses(this.getStateDom(),["edui-state-"+state])},getStateDom:function(){return this.getDom("state")},isChecked:function(){return this.hasState("checked")},setChecked:function(checked){!this.isDisabled()&&checked?this.addState("checked"):this.removeState("checked")},isDisabled:function(){return this.hasState("disabled")},setDisabled:function(disabled){disabled?(this.removeState("hover"),this.removeState("checked"),this.removeState("active"),this.addState("disabled")):this.removeState("disabled")}}}(),function(){var utils=baidu.editor.utils,UIBase=baidu.editor.ui.UIBase,Stateful=baidu.editor.ui.Stateful,Button=baidu.editor.ui.Button=function(options){this.initOptions(options),this.initButton()};Button.prototype={uiName:"button",label:"",title:"",showIcon:!0,showText:!0,initButton:function(){this.initUIBase(),this.Stateful_init()},getHtmlTpl:function(){return'<div id="##" class="edui-box %%"><div id="##_state" stateful><div class="%%-wrap"><div id="##_body" unselectable="on" '+(this.title?'title="'+this.title+'"':"")+' class="%%-body" onmousedown="return false;" onclick="return $$._onClick();">'+(this.showIcon?'<div class="edui-box edui-icon"></div>':"")+(this.showText?'<div class="edui-box edui-label">'+this.label+"</div>":"")+"</div>"+"</div>"+"</div></div>"},postRender:function(){this.Stateful_postRender(),this.setDisabled(this.disabled)},_onClick:function(){this.isDisabled()||this.fireEvent("click")}},utils.inherits(Button,UIBase),utils.extend(Button.prototype,Stateful)}(),function(){var utils=baidu.editor.utils,uiUtils=baidu.editor.ui.uiUtils,UIBase=(baidu.editor.dom.domUtils,baidu.editor.ui.UIBase),Stateful=baidu.editor.ui.Stateful,SplitButton=baidu.editor.ui.SplitButton=function(options){this.initOptions(options),this.initSplitButton()};SplitButton.prototype={popup:null,uiName:"splitbutton",title:"",initSplitButton:function(){if(this.initUIBase(),this.Stateful_init(),null!=this.popup){var popup=this.popup;this.popup=null,this.setPopup(popup)}},_UIBase_postRender:UIBase.prototype.postRender,postRender:function(){this.Stateful_postRender(),this._UIBase_postRender()},setPopup:function(popup){this.popup!==popup&&(null!=this.popup&&this.popup.dispose(),popup.addListener("show",utils.bind(this._onPopupShow,this)),popup.addListener("hide",utils.bind(this._onPopupHide,this)),popup.addListener("postrender",utils.bind(function(){popup.getDom("body").appendChild(uiUtils.createElementByHtml('<div id="'+this.popup.id+'_bordereraser" class="edui-bordereraser edui-background" style="width:'+(uiUtils.getClientRect(this.getDom()).width-2)+'px"></div>')),popup.getDom().className+=" "+this.className},this)),this.popup=popup)},_onPopupShow:function(){this.addState("opened")},_onPopupHide:function(){this.removeState("opened")},getHtmlTpl:function(){return'<div id="##" class="edui-box %%"><div '+(this.title?'title="'+this.title+'"':"")+' id="##_state" stateful><div class="%%-body">'+'<div id="##_button_body" class="edui-box edui-button-body" onclick="$$._onButtonClick(event, this);">'+'<div class="edui-box edui-icon"></div>'+"</div>"+'<div class="edui-box edui-splitborder"></div>'+'<div class="edui-box edui-arrow" onclick="$$._onArrowClick();"></div>'+"</div></div></div>"},showPopup:function(){var rect=uiUtils.getClientRect(this.getDom());rect.top-=this.popup.SHADOW_RADIUS,rect.height+=this.popup.SHADOW_RADIUS,this.popup.showAnchorRect(rect)},_onArrowClick:function(){this.isDisabled()||this.showPopup()},_onButtonClick:function(){this.isDisabled()||this.fireEvent("buttonclick")}},utils.inherits(SplitButton,UIBase),utils.extend(SplitButton.prototype,Stateful,!0)}(),function(){var utils=baidu.editor.utils,uiUtils=baidu.editor.ui.uiUtils,ColorPicker=baidu.editor.ui.ColorPicker,Popup=baidu.editor.ui.Popup,SplitButton=baidu.editor.ui.SplitButton,ColorButton=baidu.editor.ui.ColorButton=function(options){this.initOptions(options),this.initColorButton()};ColorButton.prototype={initColorButton:function(){var me=this;this.popup=new Popup({content:new ColorPicker({noColorText:me.editor.getLang("clearColor"),editor:me.editor,onpickcolor:function(t,color){me._onPickColor(color)},onpicknocolor:function(t,color){me._onPickNoColor(color)}}),editor:me.editor}),this.initSplitButton()},_SplitButton_postRender:SplitButton.prototype.postRender,postRender:function(){this._SplitButton_postRender(),this.getDom("button_body").appendChild(uiUtils.createElementByHtml('<div id="'+this.id+'_colorlump" class="edui-colorlump"></div>')),this.getDom().className+=" edui-colorbutton"},setColor:function(color){this.getDom("colorlump").style.backgroundColor=color,this.color=color},_onPickColor:function(color){this.fireEvent("pickcolor",color)!==!1&&(this.setColor(color),this.popup.hide())},_onPickNoColor:function(){this.fireEvent("picknocolor")!==!1&&this.popup.hide()}},utils.inherits(ColorButton,SplitButton)}(),function(){var utils=baidu.editor.utils,UIBase=baidu.editor.ui.UIBase,AutoTypeSetPicker=baidu.editor.ui.AutoTypeSetPicker=function(options){this.initOptions(options),this.initAutoTypeSetPicker()};AutoTypeSetPicker.prototype={initAutoTypeSetPicker:function(){this.initUIBase()},getHtmlTpl:function(){var me=this.editor,opt=me.options.autotypeset,lang=me.getLang("autoTypeSet");return'<div id="##" class="edui-autotypesetpicker %%"><div class="edui-autotypesetpicker-body"><table ><tr><td nowrap colspan="2"><input type="checkbox" name="mergeEmptyline" '+(opt.mergeEmptyline?"checked":"")+">"+lang.mergeLine+'</td><td colspan="2"><input type="checkbox" name="removeEmptyline" '+(opt.removeEmptyline?"checked":"")+">"+lang.delLine+"</td></tr>"+'<tr><td nowrap colspan="2"><input type="checkbox" name="removeClass" '+(opt.removeClass?"checked":"")+">"+lang.removeFormat+'</td><td colspan="2"><input type="checkbox" name="indent" '+(opt.indent?"checked":"")+">"+lang.indent+"</td></tr>"+'<tr><td nowrap colspan="2"><input type="checkbox" name="textAlign" '+(opt.textAlign?"checked":"")+">"+lang.alignment+'</td><td colspan="2" id="textAlignValue"><input type="radio" name="textAlignValue" value="left" '+(opt.textAlign&&"left"==opt.textAlign?"checked":"")+">"+me.getLang("justifyleft")+'<input type="radio" name="textAlignValue" value="center" '+(opt.textAlign&&"center"==opt.textAlign?"checked":"")+">"+me.getLang("justifycenter")+'<input type="radio" name="textAlignValue" value="right" '+(opt.textAlign&&"right"==opt.textAlign?"checked":"")+">"+me.getLang("justifyright")+" </tr>"+'<tr><td nowrap colspan="2"><input type="checkbox" name="imageBlockLine" '+(opt.imageBlockLine?"checked":"")+">"+lang.imageFloat+"</td>"+'<td nowrap colspan="2" id="imageBlockLineValue">'+'<input type="radio" name="imageBlockLineValue" value="none" '+(opt.imageBlockLine&&"none"==opt.imageBlockLine?"checked":"")+">"+me.getLang("default")+'<input type="radio" name="imageBlockLineValue" value="left" '+(opt.imageBlockLine&&"left"==opt.imageBlockLine?"checked":"")+">"+me.getLang("justifyleft")+'<input type="radio" name="imageBlockLineValue" value="center" '+(opt.imageBlockLine&&"center"==opt.imageBlockLine?"checked":"")+">"+me.getLang("justifycenter")+'<input type="radio" name="imageBlockLineValue" value="right" '+(opt.imageBlockLine&&"right"==opt.imageBlockLine?"checked":"")+">"+me.getLang("justifyright")+"</tr>"+'<tr><td nowrap colspan="2"><input type="checkbox" name="clearFontSize" '+(opt.clearFontSize?"checked":"")+">"+lang.removeFontsize+'</td><td colspan="2"><input type="checkbox" name="clearFontFamily" '+(opt.clearFontFamily?"checked":"")+">"+lang.removeFontFamily+"</td></tr>"+'<tr><td nowrap colspan="4"><input type="checkbox" name="removeEmptyNode" '+(opt.removeEmptyNode?"checked":"")+">"+lang.removeHtml+"</td></tr>"+'<tr><td nowrap colspan="4"><input type="checkbox" name="pasteFilter" '+(opt.pasteFilter?"checked":"")+">"+lang.pasteFilter+"</td></tr>"+'<tr><td nowrap colspan="4" align="right"><button >'+lang.run+"</button></td></tr>"+"</table>"+"</div>"+"</div>"},_UIBase_render:UIBase.prototype.render},utils.inherits(AutoTypeSetPicker,UIBase)}(),function(){function getPara(me){for(var ipt,opt=me.editor.options.autotypeset,cont=me.getDom(),ipts=domUtils.getElementsByTagName(cont,"input"),i=ipts.length-1;ipt=ipts[i--];)if("checkbox"==ipt.getAttribute("type")){var attrName=ipt.getAttribute("name");if(opt[attrName]&&delete opt[attrName],ipt.checked){var attrValue=document.getElementById(attrName+"Value");if(attrValue){if(/input/gi.test(attrValue.tagName))opt[attrName]=attrValue.value;else for(var iptchild,iptChilds=attrValue.getElementsByTagName("input"),j=iptChilds.length-1;iptchild=iptChilds[j--];)if(iptchild.checked){opt[attrName]=iptchild.value;break}}else opt[attrName]=!0}}for(var si,selects=domUtils.getElementsByTagName(cont,"select"),i=0;si=selects[i++];){var attr=si.getAttribute("name");opt[attr]=opt[attr]?si.value:""}me.editor.options.autotypeset=opt}var utils=baidu.editor.utils,Popup=baidu.editor.ui.Popup,AutoTypeSetPicker=baidu.editor.ui.AutoTypeSetPicker,SplitButton=baidu.editor.ui.SplitButton,AutoTypeSetButton=baidu.editor.ui.AutoTypeSetButton=function(options){this.initOptions(options),this.initAutoTypeSetButton()};AutoTypeSetButton.prototype={initAutoTypeSetButton:function(){var me=this;this.popup=new Popup({content:new AutoTypeSetPicker({editor:me.editor}),editor:me.editor,hide:function(){!this._hidden&&this.getDom()&&(getPara(this),this.getDom().style.display="none",this._hidden=!0,this.fireEvent("hide"))}});var flag=0;this.popup.addListener("postRenderAfter",function(){var popupUI=this;if(!flag){var cont=this.getDom(),btn=cont.getElementsByTagName("button")[0];btn.onclick=function(){getPara(popupUI),me.editor.execCommand("autotypeset"),popupUI.hide()},flag=1}}),this.initSplitButton()}},utils.inherits(AutoTypeSetButton,SplitButton)}(),function(){var utils=baidu.editor.utils,uiUtils=baidu.editor.ui.uiUtils,UIBase=baidu.editor.ui.UIBase,Toolbar=baidu.editor.ui.Toolbar=function(options){this.initOptions(options),this.initToolbar()};Toolbar.prototype={items:null,initToolbar:function(){this.items=this.items||[],this.initUIBase()},add:function(item){this.items.push(item)},getHtmlTpl:function(){for(var buff=[],i=0;this.items.length>i;i++)buff[i]=this.items[i].renderHtml();return'<div id="##" class="edui-toolbar %%" onselectstart="return false;" onmousedown="return $$._onMouseDown(event, this);">'+buff.join("")+"</div>"},postRender:function(){for(var box=this.getDom(),i=0;this.items.length>i;i++)this.items[i].postRender();uiUtils.makeUnselectable(box)},_onMouseDown:function(){return!1}},utils.inherits(Toolbar,UIBase)}(),function(){var utils=baidu.editor.utils,domUtils=baidu.editor.dom.domUtils,uiUtils=baidu.editor.ui.uiUtils,UIBase=baidu.editor.ui.UIBase,Popup=baidu.editor.ui.Popup,Stateful=baidu.editor.ui.Stateful,Menu=baidu.editor.ui.Menu=function(options){this.initOptions(options),this.initMenu()},menuSeparator={renderHtml:function(){return'<div class="edui-menuitem edui-menuseparator"><div class="edui-menuseparator-inner"></div></div>'},postRender:function(){},queryAutoHide:function(){return!0}};Menu.prototype={items:null,uiName:"menu",initMenu:function(){this.items=this.items||[],this.initPopup(),this.initItems()},initItems:function(){for(var i=0;this.items.length>i;i++){var item=this.items[i];"-"==item?this.items[i]=this.getSeparator():item instanceof MenuItem||(item.theme=this.editor.options.theme,this.items[i]=this.createItem(item))}},getSeparator:function(){return menuSeparator},createItem:function(item){return new MenuItem(item)},_Popup_getContentHtmlTpl:Popup.prototype.getContentHtmlTpl,getContentHtmlTpl:function(){if(0==this.items.length)return this._Popup_getContentHtmlTpl();for(var buff=[],i=0;this.items.length>i;i++){var item=this.items[i];buff[i]=item.renderHtml()}return'<div class="%%-body">'+buff.join("")+"</div>"},_Popup_postRender:Popup.prototype.postRender,postRender:function(){for(var me=this,i=0;this.items.length>i;i++){var item=this.items[i];item.ownerMenu=this,item.postRender()}domUtils.on(this.getDom(),"mouseover",function(evt){evt=evt||event;var rel=evt.relatedTarget||evt.fromElement,el=me.getDom();uiUtils.contains(el,rel)||el===rel||me.fireEvent("over")}),this._Popup_postRender()},queryAutoHide:function(el){if(el){if(uiUtils.contains(this.getDom(),el))return!1;for(var i=0;this.items.length>i;i++){var item=this.items[i];if(item.queryAutoHide(el)===!1)return!1}}},clearItems:function(){for(var i=0;this.items.length>i;i++){var item=this.items[i];clearTimeout(item._showingTimer),clearTimeout(item._closingTimer),item.subMenu&&item.subMenu.destroy()}this.items=[]},destroy:function(){this.getDom()&&domUtils.remove(this.getDom()),this.clearItems()},dispose:function(){this.destroy()}},utils.inherits(Menu,Popup);var MenuItem=baidu.editor.ui.MenuItem=function(options){this.initOptions(options),this.initUIBase(),this.Stateful_init(),!this.subMenu||this.subMenu instanceof Menu||(this.subMenu=new Menu(this.subMenu))};MenuItem.prototype={label:"",subMenu:null,ownerMenu:null,uiName:"menuitem",alwalysHoverable:!0,getHtmlTpl:function(){return'<div id="##" class="%%" stateful onclick="$$._onClick(event, this);"><div class="%%-body">'+this.renderLabelHtml()+"</div>"+"</div>"},postRender:function(){var me=this;this.addListener("over",function(){me.ownerMenu.fireEvent("submenuover",me),me.subMenu&&me.delayShowSubMenu()}),this.subMenu&&(this.getDom().className+=" edui-hassubmenu",this.subMenu.render(),this.addListener("out",function(){me.delayHideSubMenu()}),this.subMenu.addListener("over",function(){clearTimeout(me._closingTimer),me._closingTimer=null,me.addState("opened")}),this.ownerMenu.addListener("hide",function(){me.hideSubMenu()}),this.ownerMenu.addListener("submenuover",function(t,subMenu){subMenu!==me&&me.delayHideSubMenu()}),this.subMenu._bakQueryAutoHide=this.subMenu.queryAutoHide,this.subMenu.queryAutoHide=function(el){return el&&uiUtils.contains(me.getDom(),el)?!1:this._bakQueryAutoHide(el)}),this.getDom().style.tabIndex="-1",uiUtils.makeUnselectable(this.getDom()),this.Stateful_postRender()},delayShowSubMenu:function(){var me=this;me.isDisabled()||(me.addState("opened"),clearTimeout(me._showingTimer),clearTimeout(me._closingTimer),me._closingTimer=null,me._showingTimer=setTimeout(function(){me.showSubMenu()},250))},delayHideSubMenu:function(){var me=this;me.isDisabled()||(me.removeState("opened"),clearTimeout(me._showingTimer),me._closingTimer||(me._closingTimer=setTimeout(function(){me.hasState("opened")||me.hideSubMenu(),me._closingTimer=null},400)))},renderLabelHtml:function(){return'<div class="edui-arrow"></div><div class="edui-box edui-icon"></div><div class="edui-box edui-label %%-label">'+(this.label||"")+"</div>"},getStateDom:function(){return this.getDom()},queryAutoHide:function(el){return this.subMenu&&this.hasState("opened")?this.subMenu.queryAutoHide(el):void 0},_onClick:function(event,this_){this.hasState("disabled")||this.fireEvent("click",event,this_)!==!1&&(this.subMenu?this.showSubMenu():Popup.postHide())},showSubMenu:function(){var rect=uiUtils.getClientRect(this.getDom());rect.right-=5,rect.left+=2,rect.width-=7,rect.top-=4,rect.bottom+=4,rect.height+=8,this.subMenu.showAnchorRect(rect,!0,!0)},hideSubMenu:function(){this.subMenu.hide()}},utils.inherits(MenuItem,UIBase),utils.extend(MenuItem.prototype,Stateful,!0)}(),function(){var utils=baidu.editor.utils,uiUtils=baidu.editor.ui.uiUtils,Menu=baidu.editor.ui.Menu,SplitButton=baidu.editor.ui.SplitButton,Combox=baidu.editor.ui.Combox=function(options){this.initOptions(options),this.initCombox()};Combox.prototype={uiName:"combox",initCombox:function(){var me=this;this.items=this.items||[];for(var i=0;this.items.length>i;i++){var item=this.items[i];item.uiName="listitem",item.index=i,item.onclick=function(){me.selectByIndex(this.index)}}this.popup=new Menu({items:this.items,uiName:"list",editor:this.editor}),this.initSplitButton()},_SplitButton_postRender:SplitButton.prototype.postRender,postRender:function(){this._SplitButton_postRender(),this.setLabel(this.label||""),this.setValue(this.initValue||"")},showPopup:function(){var rect=uiUtils.getClientRect(this.getDom());rect.top+=1,rect.bottom-=1,rect.height-=2,this.popup.showAnchorRect(rect)},getValue:function(){return this.value},setValue:function(value){var index=this.indexByValue(value);-1!=index?(this.selectedIndex=index,this.setLabel(this.items[index].label),this.value=this.items[index].value):(this.selectedIndex=-1,this.setLabel(this.getLabelForUnknowValue(value)),this.value=value)},setLabel:function(label){this.getDom("button_body").innerHTML=label,this.label=label},getLabelForUnknowValue:function(value){return value},indexByValue:function(value){for(var i=0;this.items.length>i;i++)if(value==this.items[i].value)return i;return-1},getItem:function(index){return this.items[index]},selectByIndex:function(index){this.items.length>index&&this.fireEvent("select",index)!==!1&&(this.selectedIndex=index,this.value=this.items[index].value,this.setLabel(this.items[index].label))}},utils.inherits(Combox,SplitButton)}(),function(){var modalMask,dragMask,utils=baidu.editor.utils,domUtils=baidu.editor.dom.domUtils,uiUtils=baidu.editor.ui.uiUtils,Mask=baidu.editor.ui.Mask,UIBase=baidu.editor.ui.UIBase,Button=baidu.editor.ui.Button,Dialog=baidu.editor.ui.Dialog=function(options){this.initOptions(utils.extend({autoReset:!0,draggable:!0,onok:function(){},oncancel:function(){},onclose:function(t,ok){return ok?this.onok():this.oncancel()}},options)),this.initDialog()};Dialog.prototype={draggable:!1,uiName:"dialog",initDialog:function(){var me=this,theme=this.editor.options.theme;if(this.initUIBase(),this.modalMask=modalMask||(modalMask=new Mask({className:"edui-dialog-modalmask",theme:theme})),this.dragMask=dragMask||(dragMask=new Mask({className:"edui-dialog-dragmask",theme:theme})),this.closeButton=new Button({className:"edui-dialog-closebutton",title:me.closeDialog,theme:theme,onclick:function(){me.close(!1)}}),this.buttons)for(var i=0;this.buttons.length>i;i++)this.buttons[i]instanceof Button||(this.buttons[i]=new Button(this.buttons[i]))
},fitSize:function(){var popBodyEl=this.getDom("body"),size=this.mesureSize();return popBodyEl.style.width=size.width+"px",popBodyEl.style.height=size.height+"px",size},safeSetOffset:function(offset){var me=this,el=me.getDom(),vpRect=uiUtils.getViewportRect(),rect=uiUtils.getClientRect(el),left=offset.left;left+rect.width>vpRect.right&&(left=vpRect.right-rect.width);var top=offset.top;top+rect.height>vpRect.bottom&&(top=vpRect.bottom-rect.height),el.style.left=Math.max(left,0)+"px",el.style.top=Math.max(top,0)+"px"},showAtCenter:function(){this.getDom().style.display="";var vpRect=uiUtils.getViewportRect(),popSize=this.fitSize(),titleHeight=0|this.getDom("titlebar").offsetHeight,left=vpRect.width/2-popSize.width/2,top=vpRect.height/2-(popSize.height-titleHeight)/2-titleHeight,popEl=this.getDom();this.safeSetOffset({left:Math.max(0|left,0),top:Math.max(0|top,0)}),domUtils.hasClass(popEl,"edui-state-centered")||(popEl.className+=" edui-state-centered"),this._show()},getContentHtml:function(){var contentHtml="";return"string"==typeof this.content?contentHtml=this.content:this.iframeUrl&&(contentHtml='<span id="'+this.id+'_contmask" class="dialogcontmask"></span><iframe id="'+this.id+'_iframe" class="%%-iframe" height="100%" width="100%" frameborder="0" src="'+this.iframeUrl+'"></iframe>'),contentHtml},getHtmlTpl:function(){var footHtml="";if(this.buttons){for(var buff=[],i=0;this.buttons.length>i;i++)buff[i]=this.buttons[i].renderHtml();footHtml='<div class="%%-foot"><div id="##_buttons" class="%%-buttons">'+buff.join("")+"</div>"+"</div>"}return'<div id="##" class="%%"><div class="%%-wrap"><div id="##_body" class="%%-body"><div class="%%-shadow"></div><div id="##_titlebar" class="%%-titlebar"><div class="%%-draghandle" onmousedown="$$._onTitlebarMouseDown(event, this);"><span class="%%-caption">'+(this.title||"")+"</span>"+"</div>"+this.closeButton.renderHtml()+"</div>"+'<div id="##_content" class="%%-content">'+(this.autoReset?"":this.getContentHtml())+"</div>"+footHtml+"</div></div></div>"},postRender:function(){this.modalMask.getDom()||(this.modalMask.render(),this.modalMask.hide()),this.dragMask.getDom()||(this.dragMask.render(),this.dragMask.hide());var me=this;if(this.addListener("show",function(){me.modalMask.show(this.getDom().style.zIndex-2)}),this.addListener("hide",function(){me.modalMask.hide()}),this.buttons)for(var i=0;this.buttons.length>i;i++)this.buttons[i].postRender();domUtils.on(window,"resize",function(){setTimeout(function(){me.isHidden()||me.safeSetOffset(uiUtils.getClientRect(me.getDom()))})}),this._hide()},mesureSize:function(){var body=this.getDom("body"),width=uiUtils.getClientRect(this.getDom("content")).width,dialogBodyStyle=body.style;return dialogBodyStyle.width=width,uiUtils.getClientRect(body)},_onTitlebarMouseDown:function(evt){if(this.draggable){var rect;uiUtils.getViewportRect();var me=this;uiUtils.startDrag(evt,{ondragstart:function(){rect=uiUtils.getClientRect(me.getDom()),me.getDom("contmask").style.visibility="visible",me.dragMask.show(me.getDom().style.zIndex-1)},ondragmove:function(x,y){var left=rect.left+x,top=rect.top+y;me.safeSetOffset({left:left,top:top})},ondragstop:function(){me.getDom("contmask").style.visibility="hidden",domUtils.removeClasses(me.getDom(),["edui-state-centered"]),me.dragMask.hide()}})}},reset:function(){this.getDom("content").innerHTML=this.getContentHtml()},_show:function(){this._hidden&&(this.getDom().style.display="",this.editor.container.style.zIndex&&(this.getDom().style.zIndex=1*this.editor.container.style.zIndex+10),this._hidden=!1,this.fireEvent("show"),baidu.editor.ui.uiUtils.getFixedLayer().style.zIndex=this.getDom().style.zIndex-4)},isHidden:function(){return this._hidden},_hide:function(){this._hidden||(this.getDom().style.display="none",this.getDom().style.zIndex="",this._hidden=!0,this.fireEvent("hide"))},open:function(){if(this.autoReset)try{this.reset()}catch(e){this.render(),this.open()}if(this.showAtCenter(),this.iframeUrl)try{this.getDom("iframe").focus()}catch(ex){}},_onCloseButtonClick:function(){this.close(!1)},close:function(ok){this.fireEvent("close",ok)!==!1&&this._hide()}},utils.inherits(Dialog,UIBase)}(),function(){var utils=baidu.editor.utils,Menu=baidu.editor.ui.Menu,SplitButton=baidu.editor.ui.SplitButton,MenuButton=baidu.editor.ui.MenuButton=function(options){this.initOptions(options),this.initMenuButton()};MenuButton.prototype={initMenuButton:function(){var me=this;this.uiName="menubutton",this.popup=new Menu({items:me.items,className:me.className,editor:me.editor}),this.popup.addListener("show",function(){for(var list=this,i=0;list.items.length>i;i++)list.items[i].removeState("checked"),list.items[i].value==me._value&&(list.items[i].addState("checked"),this.value=me._value)}),this.initSplitButton()},setValue:function(value){this._value=value}},utils.inherits(MenuButton,SplitButton)}(),function(){var utils=baidu.editor.utils,editorui=baidu.editor.ui,_Dialog=editorui.Dialog;editorui.Dialog=function(options){var dialog=new _Dialog(options);return dialog.addListener("hide",function(){if(dialog.editor){var editor=dialog.editor;try{if(browser.gecko){var y=editor.window.scrollY,x=editor.window.scrollX;editor.body.focus(),editor.window.scrollTo(x,y)}else editor.focus()}catch(ex){}}}),dialog};for(var ci,iframeUrlMap={anchor:"~/dialogs/anchor/anchor.html",insertimage:"~/dialogs/image/image.html",inserttable:"~/dialogs/table/table.html",link:"~/dialogs/link/link.html",spechars:"~/dialogs/spechars/spechars.html",searchreplace:"~/dialogs/searchreplace/searchreplace.html",map:"~/dialogs/map/map.html",gmap:"~/dialogs/gmap/gmap.html",insertvideo:"~/dialogs/video/video.html",help:"~/dialogs/help/help.html",highlightcode:"~/dialogs/highlightcode/highlightcode.html",emotion:"~/dialogs/emotion/emotion.html",wordimage:"~/dialogs/wordimage/wordimage.html",attachment:"~/dialogs/attachment/attachment.html",insertframe:"~/dialogs/insertframe/insertframe.html",edittd:"~/dialogs/table/edittd.html",webapp:"~/dialogs/webapp/webapp.html",snapscreen:"~/dialogs/snapscreen/snapscreen.html",scrawl:"~/dialogs/scrawl/scrawl.html",music:"~/dialogs/music/music.html",template:"~/dialogs/template/template.html",background:"~/dialogs/background/background.html"},btnCmds=["klink","kimage","kvideo","undo","redo","formatmatch","bold","italic","underline","touppercase","tolowercase","strikethrough","subscript","superscript","source","indent","outdent","blockquote","pasteplain","pagebreak","selectall","print","preview","horizontal","removeformat","time","date","unlink","insertparagraphbeforetable","insertrow","insertcol","mergeright","mergedown","deleterow","deletecol","splittorows","splittocols","splittocells","mergecells","deletetable"],i=0;ci=btnCmds[i++];)ci=ci.toLowerCase(),editorui[ci]=function(cmd){return function(editor){var ui=new editorui.Button({className:"edui-for-"+cmd,title:editor.options.labelMap[cmd]||editor.getLang("labelMap."+cmd)||"",onclick:function(){editor.execCommand(cmd)},theme:editor.options.theme,showText:!1});return editor.addListener("selectionchange",function(type,causeByUi,uiReady){var state=editor.queryCommandState(cmd);-1==state?(ui.setDisabled(!0),ui.setChecked(!1)):uiReady||(ui.setDisabled(!1),ui.setChecked(state))}),ui}}(ci);editorui.cleardoc=function(editor){var ui=new editorui.Button({className:"edui-for-cleardoc",title:editor.options.labelMap.cleardoc||editor.getLang("labelMap.cleardoc")||"",theme:editor.options.theme,onclick:function(){confirm(editor.getLang("confirmClear"))&&editor.execCommand("cleardoc")}});return editor.addListener("selectionchange",function(){ui.setDisabled(-1==editor.queryCommandState("cleardoc"))}),ui};var typeset={justify:["left","right","center","justify"],imagefloat:["none","left","center","right"],directionality:["ltr","rtl"]};for(var p in typeset)(function(cmd,val){for(var ci,i=0;ci=val[i++];)(function(cmd2){editorui[cmd.replace("float","")+cmd2]=function(editor){var ui=new editorui.Button({className:"edui-for-"+cmd.replace("float","")+cmd2,title:editor.options.labelMap[cmd.replace("float","")+cmd2]||editor.getLang("labelMap."+cmd.replace("float","")+cmd2)||"",theme:editor.options.theme,onclick:function(){editor.execCommand(cmd,cmd2)}});return editor.addListener("selectionchange",function(type,causeByUi,uiReady){ui.setDisabled(-1==editor.queryCommandState(cmd)),ui.setChecked(editor.queryCommandValue(cmd)==cmd2&&!uiReady)}),ui}})(ci)})(p,typeset[p]);for(var ci,i=0;ci=["backcolor","forecolor"][i++];)editorui[ci]=function(cmd){return function(editor){var ui=new editorui.ColorButton({className:"edui-for-"+cmd,color:"default",title:editor.options.labelMap[cmd]||editor.getLang("labelMap."+cmd)||"",editor:editor,onpickcolor:function(t,color){editor.execCommand(cmd,color)},onpicknocolor:function(){editor.execCommand(cmd,"default"),this.setColor("transparent"),this.color="default"},onbuttonclick:function(){editor.execCommand(cmd,this.color)}});return editor.addListener("selectionchange",function(){ui.setDisabled(-1==editor.queryCommandState(cmd))}),ui}}(ci);var dialogBtns={noOk:["searchreplace","help","spechars","webapp"],ok:["attachment","anchor","link","insertimage","map","gmap","insertframe","wordimage","insertvideo","highlightcode","insertframe","edittd","scrawl","template","music","background"]};for(var p in dialogBtns)(function(type,vals){for(var ci,i=0;ci=vals[i++];)browser.opera&&"searchreplace"===ci||function(cmd){editorui[cmd]=function(editor,iframeUrl,title){iframeUrl=iframeUrl||(editor.options.iframeUrlMap||{})[cmd]||iframeUrlMap[cmd],title=editor.options.labelMap[cmd]||editor.getLang("labelMap."+cmd)||"";var dialog;iframeUrl&&(dialog=new editorui.Dialog(utils.extend({iframeUrl:editor.ui.mapUrl(iframeUrl),editor:editor,className:"edui-for-"+cmd,title:title,closeDialog:editor.getLang("closeDialog")},"ok"==type?{buttons:[{className:"edui-okbutton",label:editor.getLang("ok"),editor:editor,onclick:function(){dialog.close(!0)}},{className:"edui-cancelbutton",label:editor.getLang("cancel"),editor:editor,onclick:function(){dialog.close(!1)}}]}:{})),editor.ui._dialogs[cmd+"Dialog"]=dialog);var ui=new editorui.Button({className:"edui-for-"+cmd,title:title,onclick:function(){if(dialog)switch(cmd){case"wordimage":editor.execCommand("wordimage","word_img"),editor.word_img&&(dialog.render(),dialog.open());break;case"scrawl":-1!=editor.queryCommandState("scrawl")&&(dialog.render(),dialog.open());break;default:dialog.render(),dialog.open()}},theme:editor.options.theme,disabled:"scrawl"==cmd&&-1==editor.queryCommandState("scrawl")});return editor.addListener("selectionchange",function(){var unNeedCheckState={edittd:1,edittable:1};if(!(cmd in unNeedCheckState)){var state=editor.queryCommandState(cmd);ui.getDom()&&(ui.setDisabled(-1==state),ui.setChecked(state))}}),ui}}(ci.toLowerCase())})(p,dialogBtns[p]);editorui.snapscreen=function(editor,iframeUrl,title){title=editor.options.labelMap.snapscreen||editor.getLang("labelMap.snapscreen")||"";var ui=new editorui.Button({className:"edui-for-snapscreen",title:title,onclick:function(){editor.execCommand("snapscreen")},theme:editor.options.theme,disabled:!browser.ie});if(browser.ie&&(iframeUrl=iframeUrl||(editor.options.iframeUrlMap||{}).snapscreen||iframeUrlMap.snapscreen)){var dialog=new editorui.Dialog({iframeUrl:editor.ui.mapUrl(iframeUrl),editor:editor,className:"edui-for-snapscreen",title:title,buttons:[{className:"edui-okbutton",label:editor.getLang("ok"),editor:editor,onclick:function(){dialog.close(!0)}},{className:"edui-cancelbutton",label:editor.getLang("cancel"),editor:editor,onclick:function(){dialog.close(!1)}}]});dialog.render(),editor.ui._dialogs.snapscreenDialog=dialog}return editor.addListener("selectionchange",function(){ui.setDisabled(-1==editor.queryCommandState("snapscreen"))}),ui},editorui.fontfamily=function(editor,list,title){if(list=editor.options.fontfamily||[],title=editor.options.labelMap.fontfamily||editor.getLang("labelMap.fontfamily")||"",list.length){for(var ci,i=0,items=[];ci=list[i];i++){var langLabel=editor.getLang("fontfamily")[ci.name]||"";(function(key,val){items.push({label:key,value:val,theme:editor.options.theme,renderLabelHtml:function(){return'<div class="edui-label %%-label" style="font-family:'+utils.unhtml(this.value)+'">'+(this.label||"")+"</div>"}})})(ci.label||langLabel,ci.val)}var ui=new editorui.Combox({editor:editor,items:items,onselect:function(t,index){editor.execCommand("FontFamily",this.items[index].value)},onbuttonclick:function(){this.showPopup()},title:title,initValue:title,className:"edui-for-fontfamily",indexByValue:function(value){if(value)for(var ci,i=0;ci=this.items[i];i++)if(-1!=ci.value.indexOf(value))return i;return-1}});return editor.addListener("selectionchange",function(type,causeByUi,uiReady){if(!uiReady){var state=editor.queryCommandState("FontFamily");if(-1==state)ui.setDisabled(!0);else{ui.setDisabled(!1);var value=editor.queryCommandValue("FontFamily");value&&(value=value.replace(/['"]/g,"").split(",")[0]),ui.setValue(value)}}}),ui}},editorui.fontsize=function(editor,list,title){if(title=editor.options.labelMap.fontsize||editor.getLang("labelMap.fontsize")||"",list=list||editor.options.fontsize||[],list.length){for(var items=[],i=0;list.length>i;i++){var size=list[i]+"px";items.push({label:size,value:size,theme:editor.options.theme,renderLabelHtml:function(){return'<div class="edui-label %%-label" style="line-height:1;font-size:'+this.value+'">'+(this.label||"")+"</div>"}})}var ui=new editorui.Combox({editor:editor,items:items,title:title,initValue:title,onselect:function(t,index){editor.execCommand("FontSize",this.items[index].value)},onbuttonclick:function(){this.showPopup()},className:"edui-for-fontsize"});return editor.addListener("selectionchange",function(type,causeByUi,uiReady){if(!uiReady){var state=editor.queryCommandState("FontSize");-1==state?ui.setDisabled(!0):(ui.setDisabled(!1),ui.setValue(editor.queryCommandValue("FontSize")))}}),ui}},editorui.paragraph=function(editor,list,title){if(title=editor.options.labelMap.paragraph||editor.getLang("labelMap.paragraph")||"",list=editor.options.paragraph||[],!utils.isEmptyObject(list)){var items=[];for(var i in list)items.push({value:i,label:list[i]||editor.getLang("paragraph")[i],theme:editor.options.theme,renderLabelHtml:function(){return'<div class="edui-label %%-label"><span class="edui-for-'+this.value+'">'+(this.label||"")+"</span></div>"}});var ui=new editorui.Combox({editor:editor,items:items,title:title,initValue:title,className:"edui-for-paragraph",onselect:function(t,index){editor.execCommand("Paragraph",this.items[index].value)},onbuttonclick:function(){this.showPopup()}});return editor.addListener("selectionchange",function(type,causeByUi,uiReady){if(!uiReady){var state=editor.queryCommandState("Paragraph");if(-1==state)ui.setDisabled(!0);else{ui.setDisabled(!1);var value=editor.queryCommandValue("Paragraph"),index=ui.indexByValue(value);-1!=index?ui.setValue(value):ui.setValue(ui.initValue)}}}),ui}},editorui.customstyle=function(editor){var list=editor.options.customstyle||[],title=editor.options.labelMap.customstyle||editor.getLang("labelMap.customstyle")||"";if(list.length){for(var t,langCs=editor.getLang("customstyle"),i=0,items=[];t=list[i++];)(function(t){var ck={};ck.label=t.label?t.label:langCs[t.name],ck.style=t.style,ck.className=t.className,ck.tag=t.tag,items.push({label:ck.label,value:ck,theme:editor.options.theme,renderLabelHtml:function(){return'<div class="edui-label %%-label"><'+ck.tag+" "+(ck.className?' class="'+ck.className+'"':"")+(ck.style?' style="'+ck.style+'"':"")+">"+ck.label+"</"+ck.tag+">"+"</div>"}})})(t);var ui=new editorui.Combox({editor:editor,items:items,title:title,initValue:title,className:"edui-for-customstyle",onselect:function(t,index){editor.execCommand("customstyle",this.items[index].value)},onbuttonclick:function(){this.showPopup()},indexByValue:function(value){for(var ti,i=0;ti=this.items[i++];)if(ti.label==value)return i-1;return-1}});return editor.addListener("selectionchange",function(type,causeByUi,uiReady){if(!uiReady){var state=editor.queryCommandState("customstyle");if(-1==state)ui.setDisabled(!0);else{ui.setDisabled(!1);var value=editor.queryCommandValue("customstyle"),index=ui.indexByValue(value);-1!=index?ui.setValue(value):ui.setValue(ui.initValue)}}}),ui}},editorui.inserttable=function(editor,iframeUrl,title){if(iframeUrl=iframeUrl||(editor.options.iframeUrlMap||{}).inserttable||iframeUrlMap.inserttable,title=editor.options.labelMap.inserttable||editor.getLang("labelMap.inserttable")||"",iframeUrl){var dialog=new editorui.Dialog({iframeUrl:editor.ui.mapUrl(iframeUrl),editor:editor,className:"edui-for-inserttable",title:title,buttons:[{className:"edui-okbutton",label:editor.getLang("ok"),editor:editor,onclick:function(){dialog.close(!0)}},{className:"edui-cancelbutton",label:editor.getLang("cancel"),editor:editor,onclick:function(){dialog.close(!1)}}]});dialog.render(),editor.ui._dialogs.inserttableDialog=dialog}var openDialog=function(){dialog&&(browser.webkit&&(dialog.open(),dialog.close()),dialog.open())},ui=new editorui.TableButton({editor:editor,title:title,className:"edui-for-inserttable",onpicktable:function(t,numCols,numRows){editor.execCommand("InsertTable",{numRows:numRows,numCols:numCols,border:1})},onmore:openDialog,onbuttonclick:openDialog});return editor.addListener("selectionchange",function(){ui.setDisabled(-1==editor.queryCommandState("inserttable"))}),ui},editorui.lineheight=function(editor){var val=editor.options.lineheight||[];if(val.length){for(var ci,i=0,items=[];ci=val[i++];)items.push({label:ci,value:ci,theme:editor.options.theme,onclick:function(){editor.execCommand("lineheight",this.value)}});var ui=new editorui.MenuButton({editor:editor,className:"edui-for-lineheight",title:editor.options.labelMap.lineheight||editor.getLang("labelMap.lineheight")||"",items:items,onbuttonclick:function(){var value=editor.queryCommandValue("LineHeight")||this.value;editor.execCommand("LineHeight",value)}});return editor.addListener("selectionchange",function(){var state=editor.queryCommandState("LineHeight");if(-1==state)ui.setDisabled(!0);else{ui.setDisabled(!1);var value=editor.queryCommandValue("LineHeight");value&&ui.setValue((value+"").replace(/cm/,"")),ui.setChecked(state)}}),ui}};for(var ri,rowspacings=["top","bottom"],r=0;ri=rowspacings[r++];)(function(cmd){editorui["rowspacing"+cmd]=function(editor){var val=editor.options["rowspacing"+cmd]||[];if(!val.length)return null;for(var ci,i=0,items=[];ci=val[i++];)items.push({label:ci,value:ci,theme:editor.options.theme,onclick:function(){editor.execCommand("rowspacing",this.value,cmd)}});var ui=new editorui.MenuButton({editor:editor,className:"edui-for-rowspacing"+cmd,title:editor.options.labelMap["rowspacing"+cmd]||editor.getLang("labelMap.rowspacing"+cmd)||"",items:items,onbuttonclick:function(){var value=editor.queryCommandValue("rowspacing",cmd)||this.value;editor.execCommand("rowspacing",value,cmd)}});return editor.addListener("selectionchange",function(){var state=editor.queryCommandState("rowspacing",cmd);if(-1==state)ui.setDisabled(!0);else{ui.setDisabled(!1);var value=editor.queryCommandValue("rowspacing",cmd);value&&ui.setValue((value+"").replace(/%/,"")),ui.setChecked(state)}}),ui}})(ri);for(var cl,lists=["insertorderedlist","insertunorderedlist"],l=0;cl=lists[l++];)(function(cmd){editorui[cmd]=function(editor){var vals=editor.options[cmd],_onMenuClick=function(){editor.execCommand(cmd,this.value)},items=[];for(var i in vals)items.push({label:vals[i]||editor.getLang()[cmd][i]||"",value:i,theme:editor.options.theme,onclick:_onMenuClick});var ui=new editorui.MenuButton({editor:editor,className:"edui-for-"+cmd,title:editor.getLang("labelMap."+cmd)||"",items:items,onbuttonclick:function(){var value=editor.queryCommandValue(cmd)||this.value;editor.execCommand(cmd,value)}});return editor.addListener("selectionchange",function(){var state=editor.queryCommandState(cmd);if(-1==state)ui.setDisabled(!0);else{ui.setDisabled(!1);var value=editor.queryCommandValue(cmd);ui.setValue(value),ui.setChecked(state)}}),ui}})(cl);editorui.fullscreen=function(editor,title){title=editor.options.labelMap.fullscreen||editor.getLang("labelMap.fullscreen")||"";var ui=new editorui.Button({className:"edui-for-fullscreen",title:title,theme:editor.options.theme,onclick:function(){editor.ui.getDom("scale"),editor.ui&&editor.ui.setFullScreen(!editor.ui.isFullScreen()),this.setChecked(editor.ui.isFullScreen())}});return editor.addListener("selectionchange",function(){var state=editor.queryCommandState("fullscreen");ui.setDisabled(-1==state),ui.setChecked(editor.ui.isFullScreen())}),ui},editorui.emotion=function(editor,iframeUrl){var ui=new editorui.MultiMenuPop({title:editor.options.labelMap.emotion||editor.getLang("labelMap.emotion")||"",editor:editor,className:"edui-for-emotion",iframeUrl:editor.ui.mapUrl(iframeUrl||(editor.options.iframeUrlMap||{}).emotion||iframeUrlMap.emotion)});return editor.addListener("selectionchange",function(){ui.setDisabled(-1==editor.queryCommandState("emotion"))}),ui},editorui.autotypeset=function(editor){var ui=new editorui.AutoTypeSetButton({editor:editor,title:editor.options.labelMap.autotypeset||editor.getLang("labelMap.autotypeset")||"",className:"edui-for-autotypeset",onbuttonclick:function(){editor.execCommand("autotypeset")}});return editor.addListener("selectionchange",function(){ui.setDisabled(-1==editor.queryCommandState("autotypeset"))}),ui}}(),function(){function EditorUI(options){this.initOptions(options),this.initEditorUI()}var utils=baidu.editor.utils,uiUtils=baidu.editor.ui.uiUtils,UIBase=baidu.editor.ui.UIBase,domUtils=baidu.editor.dom.domUtils,nodeStack=[];EditorUI.prototype={uiName:"editor",initEditorUI:function(){this.editor.ui=this,this._dialogs={},this.initUIBase(),this._initToolbars();var editor=this.editor,me=this;editor.addListener("ready",function(){editor.getDialog=function(name){return editor.ui._dialogs[name+"Dialog"]},domUtils.on(editor.window,"scroll",function(){baidu.editor.ui.Popup.postHide()}),editor.options.elementPathEnabled&&(editor.ui.getDom("elementpath").innerHTML='<div class="edui-editor-breadcrumb">'+editor.getLang("elementPathTip")+":</div>"),editor.options.wordCount&&(editor.ui.getDom("wordcount").innerHTML=editor.getLang("wordCountTip"),editor.addListener("keyup",function(type,evt){var keyCode=evt.keyCode||evt.which;32==keyCode&&me._wordCount()})),editor.ui._scale(),editor.options.scaleEnabled?(editor.autoHeightEnabled&&editor.disableAutoHeight(),me.enableScale()):me.disableScale(),editor.options.elementPathEnabled||editor.options.wordCount||editor.options.scaleEnabled||(editor.ui.getDom("elementpath").style.display="none",editor.ui.getDom("wordcount").style.display="none",editor.ui.getDom("scale").style.display="none"),editor.selection.isFocus()&&editor.fireEvent("selectionchange",!1,!0)}),editor.addListener("mousedown",function(t,evt){var el=evt.target||evt.srcElement;baidu.editor.ui.Popup.postHide(el)}),editor.addListener("contextmenu",function(){baidu.editor.ui.Popup.postHide()}),editor.addListener("selectionchange",function(){editor.options.elementPathEnabled&&me[(-1==editor.queryCommandState("elementpath")?"dis":"en")+"ableElementPath"](),editor.options.wordCount&&me[(-1==editor.queryCommandState("wordcount")?"dis":"en")+"ableWordCount"](),editor.options.scaleEnabled&&me[(-1==editor.queryCommandState("scale")?"dis":"en")+"ableScale"]()});var popup=new baidu.editor.ui.Popup({editor:editor,content:"",className:"edui-bubble",_onEditButtonClick:function(){this.hide(),editor.ui._dialogs.linkDialog.open()},_onImgEditButtonClick:function(name){this.hide(),editor.ui._dialogs[name]&&editor.ui._dialogs[name].open()},_onImgSetFloat:function(value){this.hide(),editor.execCommand("imagefloat",value)},_setIframeAlign:function(value){var frame=popup.anchorEl,newFrame=frame.cloneNode(!0);switch(value){case-2:newFrame.setAttribute("align","");break;case-1:newFrame.setAttribute("align","left");break;case 1:newFrame.setAttribute("align","right");break;case 2:newFrame.setAttribute("align","middle")}frame.parentNode.insertBefore(newFrame,frame),domUtils.remove(frame),popup.anchorEl=newFrame,popup.showAnchor(popup.anchorEl)},_updateIframe:function(){editor._iframe=popup.anchorEl,editor.ui._dialogs.insertframeDialog.open(),popup.hide()},_onRemoveButtonClick:function(cmdName){editor.execCommand(cmdName),this.hide()},queryAutoHide:function(el){return el&&el.ownerDocument==editor.document&&("img"==el.tagName.toLowerCase()||domUtils.findParentByTagName(el,"a",!0))?el!==popup.anchorEl:baidu.editor.ui.Popup.prototype.queryAutoHide.call(this,el)}});popup.render(),editor.options.imagePopup&&(editor.addListener("mouseover",function(t,evt){evt=evt||window.event;var el=evt.target||evt.srcElement;if(editor.ui._dialogs.insertframeDialog&&/iframe/gi.test(el.tagName)){var html=popup.formatHtml("<nobr>"+editor.getLang("property")+': <span onclick=$$._setIframeAlign(-2) class="edui-clickable">'+editor.getLang("default")+'</span>&nbsp;&nbsp;<span onclick=$$._setIframeAlign(-1) class="edui-clickable">'+editor.getLang("justifyleft")+'</span>&nbsp;&nbsp;<span onclick=$$._setIframeAlign(1) class="edui-clickable">'+editor.getLang("justifyright")+"</span>&nbsp;&nbsp;"+'<span onclick=$$._setIframeAlign(2) class="edui-clickable">'+editor.getLang("justifycenter")+"</span>"+' <span onclick="$$._updateIframe( this);" class="edui-clickable">'+editor.getLang("modify")+"</span></nobr>");html?(popup.getDom("content").innerHTML=html,popup.anchorEl=el,popup.showAnchor(popup.anchorEl)):popup.hide()}}),editor.addListener("selectionchange",function(t,causeByUi){if(causeByUi){var html="",img=editor.selection.getRange().getClosedNode(),dialogs=editor.ui._dialogs;if(img&&"IMG"==img.tagName){var dialogName="insertimageDialog";if(-1!=img.className.indexOf("edui-faked-video")&&(dialogName="insertvideoDialog"),-1!=img.className.indexOf("edui-faked-webapp")&&(dialogName="webappDialog"),-1!=img.src.indexOf("http://api.map.baidu.com")&&(dialogName="mapDialog"),-1!=img.className.indexOf("edui-faked-music")&&(dialogName="musicDialog"),-1!=img.src.indexOf("http://maps.google.com/maps/api/staticmap")&&(dialogName="gmapDialog"),img.getAttribute("anchorname")&&(dialogName="anchorDialog",html=popup.formatHtml("<nobr>"+editor.getLang("property")+': <span onclick=$$._onImgEditButtonClick("anchorDialog") class="edui-clickable">'+editor.getLang("modify")+"</span>&nbsp;&nbsp;"+"<span onclick=$$._onRemoveButtonClick('anchor') class=\"edui-clickable\">"+editor.getLang("delete")+"</span></nobr>")),img.getAttribute("word_img")&&(editor.word_img=[img.getAttribute("word_img")],dialogName="wordimageDialog"),!dialogs[dialogName])return;!html&&(html=popup.formatHtml("<nobr>"+editor.getLang("property")+': <span onclick=$$._onImgSetFloat("none") class="edui-clickable">'+editor.getLang("default")+"</span>&nbsp;&nbsp;"+'<span onclick=$$._onImgSetFloat("left") class="edui-clickable">'+editor.getLang("justifyleft")+"</span>&nbsp;&nbsp;"+'<span onclick=$$._onImgSetFloat("right") class="edui-clickable">'+editor.getLang("justifyright")+"</span>&nbsp;&nbsp;"+'<span onclick=$$._onImgSetFloat("center") class="edui-clickable">'+editor.getLang("justifycenter")+"</span>&nbsp;&nbsp;"+"<span onclick=\"$$._onImgEditButtonClick('"+dialogName+'\');" class="edui-clickable">'+editor.getLang("modify")+"</span></nobr>"))}if(editor.ui._dialogs.linkDialog){var url,link=editor.queryCommandValue("link");if(link&&(url=link.getAttribute("data_ue_src")||link.getAttribute("href",2))){var txt=url;url.length>30&&(txt=url.substring(0,20)+"..."),html&&(html+='<div style="height:5px;"></div>'),html+=popup.formatHtml("<nobr>"+editor.getLang("anthorMsg")+': <a target="_blank" href="'+url+'" title="'+url+'" >'+txt+"</a>"+' <span class="edui-clickable" onclick="$$._onEditButtonClick();">'+editor.getLang("modify")+"</span>"+' <span class="edui-clickable" onclick="$$._onRemoveButtonClick(\'unlink\');"> '+editor.getLang("clear")+"</span></nobr>"),popup.showAnchor(link)}}html?(popup.getDom("content").innerHTML=html,popup.anchorEl=img||link,popup.showAnchor(popup.anchorEl)):popup.hide()}}))},_initToolbars:function(){for(var editor=this.editor,toolbars=this.toolbars||[],toolbarUis=[],i=0;toolbars.length>i;i++){for(var toolbar=toolbars[i],toolbarUi=new baidu.editor.ui.Toolbar({theme:editor.options.theme}),j=0;toolbar.length>j;j++){var toolbarItem=toolbar[j],toolbarItemUi=null;if("string"==typeof toolbarItem){if(toolbarItem=toolbarItem.toLowerCase(),"|"==toolbarItem&&(toolbarItem="Separator"),baidu.editor.ui[toolbarItem]&&(toolbarItemUi=new baidu.editor.ui[toolbarItem](editor)),"fullscreen"==toolbarItem){toolbarUis&&toolbarUis[0]?toolbarUis[0].items.splice(0,0,toolbarItemUi):toolbarItemUi&&toolbarUi.items.splice(0,0,toolbarItemUi);continue}}else toolbarItemUi=toolbarItem;toolbarItemUi&&toolbarItemUi.id&&toolbarUi.add(toolbarItemUi)}toolbarUis[i]=toolbarUi}this.toolbars=toolbarUis},getHtmlTpl:function(){return'<div id="##" class="%%"><div id="##_toolbarbox" class="%%-toolbarbox">'+(this.toolbars.length?'<div id="##_toolbarboxouter" class="%%-toolbarboxouter"><div class="%%-toolbarboxinner">'+this.renderToolbarBoxHtml()+"</div></div>":"")+'<div id="##_toolbarmsg" class="%%-toolbarmsg" style="display:none;">'+'<div id = "##_upload_dialog" class="%%-toolbarmsg-upload" onclick="$$.showWordImageDialog();">'+this.editor.getLang("clickToUpload")+"</div>"+'<div class="%%-toolbarmsg-close" onclick="$$.hideToolbarMsg();">x</div>'+'<div id="##_toolbarmsg_label" class="%%-toolbarmsg-label"></div>'+'<div style="height:0;overflow:hidden;clear:both;"></div>'+"</div>"+"</div>"+'<div id="##_iframeholder" class="%%-iframeholder"></div>'+'<div id="##_bottombar" class="%%-bottomContainer"><table><tr>'+'<td id="##_elementpath" class="%%-bottombar"></td>'+'<td id="##_wordcount" class="%%-wordcount"></td>'+'<td id="##_scale" class="%%-scale"><div class="%%-icon"></div></td>'+"</tr></table></div>"+'<div id="##_scalelayer"></div>'+"</div>"},showWordImageDialog:function(){this.editor.execCommand("wordimage","word_img"),this._dialogs.wordimageDialog.open()},renderToolbarBoxHtml:function(){for(var buff=[],i=0;this.toolbars.length>i;i++)buff.push(this.toolbars[i].renderHtml());return buff.join("")},setFullScreen:function(fullscreen){var editor=this.editor,container=editor.container.parentNode.parentNode;if(this._fullscreen!=fullscreen){if(this._fullscreen=fullscreen,this.editor.fireEvent("beforefullscreenchange",fullscreen),baidu.editor.browser.gecko)var bk=editor.selection.getRange().createBookmark();if(fullscreen){for(;"BODY"!=container.tagName;){var position=baidu.editor.dom.domUtils.getComputedStyle(container,"position");nodeStack.push(position),container.style.position="static",container=container.parentNode}this._bakHtmlOverflow=document.documentElement.style.overflow,this._bakBodyOverflow=document.body.style.overflow,this._bakAutoHeight=this.editor.autoHeightEnabled,this._bakScrollTop=Math.max(document.documentElement.scrollTop,document.body.scrollTop),this._bakAutoHeight&&(editor.autoHeightEnabled=!1,this.editor.disableAutoHeight()),document.documentElement.style.overflow="hidden",document.body.style.overflow="hidden",this._bakCssText=this.getDom().style.cssText,this._bakCssText1=this.getDom("iframeholder").style.cssText,this._updateFullScreen()}else{for(;"BODY"!=container.tagName;)container.style.position=nodeStack.shift(),container=container.parentNode;this.getDom().style.cssText=this._bakCssText,this.getDom("iframeholder").style.cssText=this._bakCssText1,this._bakAutoHeight&&(editor.autoHeightEnabled=!0,this.editor.enableAutoHeight()),document.documentElement.style.overflow=this._bakHtmlOverflow,document.body.style.overflow=this._bakBodyOverflow,window.scrollTo(0,this._bakScrollTop)}if(baidu.editor.browser.gecko){var input=document.createElement("input");document.body.appendChild(input),editor.body.contentEditable=!1,setTimeout(function(){input.focus(),setTimeout(function(){editor.body.contentEditable=!0,editor.selection.getRange().moveToBookmark(bk).select(!0),baidu.editor.dom.domUtils.remove(input),fullscreen&&window.scroll(0,0)
},0)},0)}this.editor.fireEvent("fullscreenchanged",fullscreen),this.triggerLayout()}},_wordCount:function(){var wdcount=this.getDom("wordcount");return this.editor.options.wordCount?(wdcount.innerHTML=this.editor.queryCommandValue("wordcount"),void 0):(wdcount.style.display="none",void 0)},disableWordCount:function(){var w=this.getDom("wordcount");w.innerHTML="",w.style.display="none",this.wordcount=!1},enableWordCount:function(){var w=this.getDom("wordcount");w.style.display="",this.wordcount=!0,this._wordCount()},_updateFullScreen:function(){if(this._fullscreen){var vpRect=uiUtils.getViewportRect();this.getDom().style.cssText="border:0;position:absolute;left:0;top:"+(this.editor.options.topOffset||0)+"px;width:"+vpRect.width+"px;height:"+vpRect.height+"px;z-index:"+(1*this.getDom().style.zIndex+100),uiUtils.setViewportOffset(this.getDom(),{left:0,top:this.editor.options.topOffset||0}),this.editor.setHeight(vpRect.height-this.getDom("toolbarbox").offsetHeight-this.getDom("bottombar").offsetHeight-(this.editor.options.topOffset||0))}},_updateElementPath:function(){var list,bottom=this.getDom("elementpath");if(this.elementPathEnabled&&(list=this.editor.queryCommandValue("elementpath"))){for(var ci,buff=[],i=0;ci=list[i];i++)buff[i]=this.formatHtml('<span unselectable="on" onclick="$$.editor.execCommand(&quot;elementpath&quot;, &quot;'+i+'&quot;);">'+ci+"</span>");bottom.innerHTML='<div class="edui-editor-breadcrumb" onmousedown="return false;">'+this.editor.getLang("elementPathTip")+": "+buff.join(" &gt; ")+"</div>"}else bottom.style.display="none"},disableElementPath:function(){var bottom=this.getDom("elementpath");bottom.innerHTML="",bottom.style.display="none",this.elementPathEnabled=!1},enableElementPath:function(){var bottom=this.getDom("elementpath");bottom.style.display="",this.elementPathEnabled=!0,this._updateElementPath()},_scale:function(){function down(){position=domUtils.getXY(editorHolder),minEditorHeight||(minEditorHeight=editor.options.minFrameHeight+toolbarBox.offsetHeight+bottombar.offsetHeight),scalelayer.style.cssText="position:absolute;left:0;display:;top:0;background-color:#41ABFF;opacity:0.4;filter: Alpha(opacity=40);width:"+editorHolder.offsetWidth+"px;height:"+editorHolder.offsetHeight+"px;z-index:"+(editor.options.zIndex+1),domUtils.on(doc,"mousemove",move),domUtils.on(editorDocument,"mouseup",up),domUtils.on(doc,"mouseup",up)}function move(event){clearSelection();var e=event||window.event;pageX=e.pageX||doc.documentElement.scrollLeft+e.clientX,pageY=e.pageY||doc.documentElement.scrollTop+e.clientY,scaleWidth=pageX-position.x,scaleHeight=pageY-position.y,scaleWidth>=minEditorWidth&&(isMouseMove=!0,scalelayer.style.width=scaleWidth+"px"),scaleHeight>=minEditorHeight&&(isMouseMove=!0,scalelayer.style.height=scaleHeight+"px")}function up(){isMouseMove&&(isMouseMove=!1,editorHolder.style.width=scalelayer.offsetWidth-2+"px",editor.setHeight(scalelayer.offsetHeight-bottombar.offsetHeight-toolbarBox.offsetHeight-2)),scalelayer&&(scalelayer.style.display="none"),clearSelection(),domUtils.un(doc,"mousemove",move),domUtils.un(editorDocument,"mouseup",up),domUtils.un(doc,"mouseup",up)}function clearSelection(){browser.ie?doc.selection.clear():window.getSelection().removeAllRanges()}var doc=document,editor=this.editor,editorHolder=editor.container,editorDocument=editor.document,toolbarBox=this.getDom("toolbarbox"),bottombar=this.getDom("bottombar"),scale=this.getDom("scale"),scalelayer=this.getDom("scalelayer"),isMouseMove=!1,position=null,minEditorHeight=0,minEditorWidth=editor.options.minFrameWidth,pageX=0,pageY=0,scaleWidth=0,scaleHeight=0,me=this;this.editor.addListener("fullscreenchanged",function(e,fullScreen){if(fullScreen)me.disableScale();else if(me.editor.options.scaleEnabled){me.enableScale();var tmpNode=me.editor.document.createElement("span");me.editor.body.appendChild(tmpNode),me.editor.body.style.height=Math.max(domUtils.getXY(tmpNode).y,me.editor.iframe.offsetHeight-20)+"px",domUtils.remove(tmpNode)}}),this.enableScale=function(){1!=editor.queryCommandState("source")&&(scale.style.display="",this.scaleEnabled=!0,domUtils.on(scale,"mousedown",down))},this.disableScale=function(){scale.style.display="none",this.scaleEnabled=!1,domUtils.un(scale,"mousedown",down)}},isFullScreen:function(){return this._fullscreen},postRender:function(){UIBase.prototype.postRender.call(this);for(var i=0;this.toolbars.length>i;i++)this.toolbars[i].postRender();var timerId,me=this,domUtils=baidu.editor.dom.domUtils,updateFullScreenTime=function(){clearTimeout(timerId),timerId=setTimeout(function(){me._updateFullScreen()})};domUtils.on(window,"resize",updateFullScreenTime),me.addListener("destroy",function(){domUtils.un(window,"resize",updateFullScreenTime),clearTimeout(timerId)})},showToolbarMsg:function(msg,flag){if(this.getDom("toolbarmsg_label").innerHTML=msg,this.getDom("toolbarmsg").style.display="",!flag){var w=this.getDom("upload_dialog");w.style.display="none"}},hideToolbarMsg:function(){this.getDom("toolbarmsg").style.display="none"},mapUrl:function(url){return url?url.replace("~/",this.editor.options.UEDITOR_HOME_URL||""):""},triggerLayout:function(){var dom=this.getDom();dom.style.zoom="1"==dom.style.zoom?"100%":"1"}},utils.inherits(EditorUI,baidu.editor.ui.UIBase);var instances={};UE.ui.Editor=function(options){var editor=new baidu.editor.Editor(options);editor.options.editor=editor,utils.loadFile(document,{href:editor.options.themePath+editor.options.theme+"/css/ueditor.css",tag:"link",type:"text/css",rel:"stylesheet"});var oldRender=editor.render;return editor.render=function(holder){holder.constructor===String&&(editor.key=holder,instances[holder]=editor),utils.domReady(function(){function renderUI(){if(editor.setOpt({labelMap:editor.options.labelMap||editor.getLang("labelMap")}),new EditorUI(editor.options),holder&&(holder.constructor===String&&(holder=document.getElementById(holder)),holder&&holder.getAttribute("name")&&(editor.options.textarea=holder.getAttribute("name")),holder&&/script|textarea/gi.test(holder.tagName))){var newDiv=document.createElement("div");holder.parentNode.insertBefore(newDiv,holder);var cont=holder.value||holder.innerHTML;editor.options.initialContent=/^[\t\r\n ]*$/.test(cont)?editor.options.initialContent:cont.replace(/>[\n\r\t]+([ ]{4})+/g,">").replace(/[\n\r\t]+([ ]{4})+</g,"<").replace(/>[\n\r\t]+</g,"><"),holder.className&&(newDiv.className=holder.className),holder.style.cssText&&(newDiv.style.cssText=holder.style.cssText),/textarea/i.test(holder.tagName)?(editor.textarea=holder,editor.textarea.style.display="none"):(holder.parentNode.removeChild(holder),holder.id&&(newDiv.id=holder.id)),holder=newDiv,holder.innerHTML=""}domUtils.addClass(holder,"edui-"+editor.options.theme),editor.ui.render(holder);var iframeholder=editor.ui.getDom("iframeholder");editor.container=editor.ui.getDom(),editor.container.style.cssText="z-index:"+editor.options.zIndex+";width:"+editor.options.initialFrameWidth+"px",oldRender.call(editor,iframeholder)}editor.langIsReady?renderUI():editor.addListener("langReady",renderUI)})},editor},UE.getEditor=function(id,opt){var editor=instances[id];return editor||(editor=instances[id]=new UE.ui.Editor(opt),editor.render(id)),editor},UE.delEditor=function(id){var editor;(editor=instances[id])&&(editor.key&&editor.destroy(),delete instances[id])}}(),function(){var utils=baidu.editor.utils,Popup=baidu.editor.ui.Popup,SplitButton=baidu.editor.ui.SplitButton,MultiMenuPop=baidu.editor.ui.MultiMenuPop=function(options){this.initOptions(options),this.initMultiMenu()};MultiMenuPop.prototype={initMultiMenu:function(){var me=this;this.popup=new Popup({content:"",editor:me.editor,iframe_rendered:!1,onshow:function(){this.iframe_rendered||(this.iframe_rendered=!0,this.getDom("content").innerHTML='<iframe id="'+me.id+'_iframe" src="'+me.iframeUrl+'" frameborder="0"></iframe>',me.editor.container.style.zIndex&&(this.getDom().style.zIndex=1*me.editor.container.style.zIndex+1))}}),this.onbuttonclick=function(){this.showPopup()},this.initSplitButton()}},utils.inherits(MultiMenuPop,SplitButton)}();