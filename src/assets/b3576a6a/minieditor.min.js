function getListener(obj,type,force){var allListeners;return type=type.toLowerCase(),(allListeners=obj.__allListeners||force&&(obj.__allListeners={}))&&(allListeners[type]||force&&(allListeners[type]=[]))}function getDomNode(node,start,ltr,startFromChild,fn,guard){var parent,tmpNode=startFromChild&&node[start];for(!tmpNode&&(tmpNode=node[ltr]);!tmpNode&&(parent=(parent||node).parentNode);){if("BODY"==parent.tagName||guard&&!guard(parent))return null;tmpNode=parent[ltr]}return tmpNode&&fn&&!fn(tmpNode)?getDomNode(tmpNode,start,ltr,!1,fn):tmpNode}UEDITOR_CONFIG=window.UEDITOR_CONFIG||{};var baidu=window.baidu||{};window.baidu=baidu,window.UE=baidu.editor={},UE.plugins={},UE.commands={},UE.instants={},UE.I18N={},UE.version="1.2.4.0";var dom=UE.dom={},browser=UE.browser=function(){var agent=navigator.userAgent.toLowerCase(),opera=window.opera,browser={ie:!!window.ActiveXObject,opera:!!opera&&opera.version,webkit:agent.indexOf(" applewebkit/")>-1,mac:agent.indexOf("macintosh")>-1,quirks:"BackCompat"==document.compatMode};browser.gecko="Gecko"==navigator.product&&!browser.webkit&&!browser.opera;var version=0;if(browser.ie&&(version=parseFloat(agent.match(/msie (\d+)/)[1]),browser.ie9Compat=9==document.documentMode,browser.ie8=!!document.documentMode,browser.ie8Compat=8==document.documentMode,browser.ie7Compat=7==version&&!document.documentMode||7==document.documentMode,browser.ie6Compat=7>version||browser.quirks),browser.gecko){var geckoRelease=agent.match(/rv:([\d\.]+)/);geckoRelease&&(geckoRelease=geckoRelease[1].split("."),version=1e4*geckoRelease[0]+100*(geckoRelease[1]||0)+1*(geckoRelease[2]||0))}return/chrome\/(\d+\.\d)/i.test(agent)&&(browser.chrome=+RegExp.$1),/(\d+\.\d)?(?:\.\d)?\s+safari\/?(\d+\.\d+)?/i.test(agent)&&!/chrome/i.test(agent)&&(browser.safari=+(RegExp.$1||RegExp.$2)),browser.opera&&(version=parseFloat(opera.version())),browser.webkit&&(version=parseFloat(agent.match(/ applewebkit\/(\d+)/)[1])),browser.version=version,browser.isCompatible=!browser.mobile&&(browser.ie&&version>=6||browser.gecko&&version>=10801||browser.opera&&version>=9.5||browser.air&&version>=1||browser.webkit&&version>=522||!1),browser}(),ie=browser.ie,webkit=browser.webkit,gecko=browser.gecko,opera=browser.opera,utils=UE.utils={each:function(obj,iterator,context){if(null!=obj)if(Array.prototype.forEach&&obj.forEach===Array.prototype.forEach)obj.forEach(iterator,context);else if(obj.length===+obj.length){for(var i=0,l=obj.length;l>i;i++)if(iterator.call(context,obj[i],i,obj)===!1)return}else for(var key in obj)if(obj.hasOwnProperty(key)&&iterator.call(context,obj[key],key,obj)===!1)return},makeInstance:function(obj){var noop=Function();return noop.prototype=obj,obj=new noop,noop.prototype=null,obj},extend:function(t,s,b){if(s)for(var k in s)b&&t.hasOwnProperty(k)||(t[k]=s[k]);return t},inherits:function(subClass,superClass){var oldP=subClass.prototype,newP=utils.makeInstance(superClass.prototype);return utils.extend(newP,oldP,!0),subClass.prototype=newP,newP.constructor=subClass},bind:function(fn,context){return function(){return fn.apply(context,arguments)}},defer:function(fn,delay,exclusion){var timerID;return function(){exclusion&&clearTimeout(timerID),timerID=setTimeout(fn,delay)}},indexOf:function(array,item,start){var index=-1;return start=this.isNumber(start)?start:0,this.each(array,function(v,i){return i>=start&&v===item?(index=i,!1):void 0}),index},removeItem:function(array,item){for(var i=0,l=array.length;l>i;i++)array[i]===item&&(array.splice(i,1),i--)},trim:function(str){return str.replace(/(^[ \t\n\r]+)|([ \t\n\r]+$)/g,"")},listToMap:function(list){if(!list)return{};list=utils.isArray(list)?list:list.split(",");for(var ci,i=0,obj={};ci=list[i++];)obj[ci.toUpperCase()]=obj[ci]=1;return obj},unhtml:function(str,reg){return str?str.replace(reg||/[&<">]/g,function(m){return{"<":"&lt;","&":"&amp;",'"':"&quot;",">":"&gt;"}[m]}):""},html:function(str){return str?str.replace(/&((g|l|quo)t|amp);/g,function(m){return{"&lt;":"<","&amp;":"&","&quot;":'"',"&gt;":">"}[m]}):""},cssStyleToDomStyle:function(){var test=document.createElement("div").style,cache={"float":void 0!=test.cssFloat?"cssFloat":void 0!=test.styleFloat?"styleFloat":"float"};return function(cssName){return cache[cssName]||(cache[cssName]=cssName.toLowerCase().replace(/-./g,function(match){return match.charAt(1).toUpperCase()}))}}(),loadFile:function(){function getItem(doc,obj){for(var ci,i=0;ci=tmpList[i++];)try{if(ci.doc===doc&&ci.url==(obj.src||obj.href))return ci}catch(e){continue}}var tmpList=[];return function(doc,obj,fn){var item=getItem(doc,obj);if(item)return item.ready?fn&&fn():item.funs.push(fn),void 0;if(tmpList.push({doc:doc,url:obj.src||obj.href,funs:[fn]}),!doc.body){var html=[];for(var p in obj)"tag"!=p&&html.push(p+'="'+obj[p]+'"');return doc.write("<"+obj.tag+" "+html.join(" ")+" ></"+obj.tag+">"),void 0}if(!obj.id||!doc.getElementById(obj.id)){var element=doc.createElement(obj.tag);delete obj.tag;for(var p in obj)element.setAttribute(p,obj[p]);element.onload=element.onreadystatechange=function(){if(!this.readyState||/loaded|complete/.test(this.readyState)){if(item=getItem(doc,obj),item.funs.length>0){item.ready=1;for(var fi;fi=item.funs.pop();)fi()}element.onload=element.onreadystatechange=null}},doc.getElementsByTagName("head")[0].appendChild(element)}}}(),isEmptyObject:function(obj){if(null==obj)return!0;if(this.isArray(obj)||this.isString(obj))return 0===obj.length;for(var key in obj)if(obj.hasOwnProperty(key))return!1;return!0},fixColor:function(name,value){if(/color/i.test(name)&&/rgba?/.test(value)){var array=value.split(",");if(array.length>3)return"";value="#";for(var color,i=0;color=array[i++];)color=parseInt(color.replace(/[^\d]/gi,""),10).toString(16),value+=1==color.length?"0"+color:color;value=value.toUpperCase()}return value},optCss:function(val){function opt(obj,name){if(!obj)return"";var t=obj.top,b=obj.bottom,l=obj.left,r=obj.right,val="";if(t&&l&&b&&r)val+=";"+name+":"+(t==b&&b==l&&l==r?t:t==b&&l==r?t+" "+l:l==r?t+" "+l+" "+b:t+" "+r+" "+b+" "+l)+";";else for(var p in obj)val+=";"+name+"-"+p+":"+obj[p]+";";return val}var padding,margin;return val=val.replace(/(padding|margin|border)\-([^:]+):([^;]+);?/gi,function(str,key,name,val){if(1==val.split(" ").length)switch(key){case"padding":return!padding&&(padding={}),padding[name]=val,"";case"margin":return!margin&&(margin={}),margin[name]=val,"";case"border":return"initial"==val?"":str}return str}),val+=opt(padding,"padding")+opt(margin,"margin"),val.replace(/^[ \n\r\t;]*|[ \n\r\t]*$/,"").replace(/;([ \n\r\t]+)|\1;/g,";").replace(/(&((l|g)t|quot|#39))?;{2,}/g,function(a,b){return b?b+";;":";"})},clone:function(source,target){var tmp;target=target||{};for(var i in source)source.hasOwnProperty(i)&&(tmp=source[i],"object"==typeof tmp?(target[i]=utils.isArray(tmp)?[]:{},utils.clone(source[i],target[i])):target[i]=tmp);return target},transUnitToPx:function(val){if(!/(pt|cm)/.test(val))return val;var unit;switch(val.replace(/([\d.]+)(\w+)/,function(str,v,u){val=v,unit=u}),unit){case"cm":val=25*parseFloat(val);break;case"pt":val=Math.round(96*parseFloat(val)/72)}return val+(val?"px":"")},domReady:function(){function doReady(doc){doc.isReady=!0;for(var ci;ci=fnArr.pop();ci());}var fnArr=[];return function(onready,win){win=win||window;var doc=win.document;onready&&fnArr.push(onready),"complete"===doc.readyState?doReady(doc):(doc.isReady&&doReady(doc),browser.ie?(function(){if(!doc.isReady){try{doc.documentElement.doScroll("left")}catch(error){return setTimeout(arguments.callee,0),void 0}doReady(doc)}}(),win.attachEvent("onload",function(){doReady(doc)})):(doc.addEventListener("DOMContentLoaded",function(){doc.removeEventListener("DOMContentLoaded",arguments.callee,!1),doReady(doc)},!1),win.addEventListener("load",function(){doReady(doc)},!1)))}}(),cssRule:browser.ie?function(key,style,doc){var indexList,index;doc=doc||document,indexList=doc.indexList?doc.indexList:doc.indexList={};var sheetStyle;if(indexList[key])sheetStyle=doc.styleSheets[indexList[key]];else{if(void 0===style)return"";sheetStyle=doc.createStyleSheet("",index=doc.styleSheets.length),indexList[key]=index}return void 0===style?sheetStyle.cssText:(sheetStyle.cssText=style||"",void 0)}:function(key,style,doc){doc=doc||document;var node,head=doc.getElementsByTagName("head")[0];if(!(node=doc.getElementById(key))){if(void 0===style)return"";node=doc.createElement("style"),node.id=key,head.appendChild(node)}return void 0===style?node.innerHTML:(""!==style?node.innerHTML=style:head.removeChild(node),void 0)}};utils.each(["String","Function","Array","Number"],function(v){UE.utils["is"+v]=function(obj){return Object.prototype.toString.apply(obj)=="[object "+v+"]"}});var EventBase=UE.EventBase=function(){};EventBase.prototype={addListener:function(types,listener){types=utils.trim(types).split(" ");for(var ti,i=0;ti=types[i++];)getListener(this,ti,!0).push(listener)},removeListener:function(types,listener){types=utils.trim(types).split(" ");for(var ti,i=0;ti=types[i++];)utils.removeItem(getListener(this,ti)||[],listener)},fireEvent:function(types){types=utils.trim(types).split(" ");for(var ti,i=0;ti=types[i++];){var r,t,k,listeners=getListener(this,ti);if(listeners)for(k=listeners.length;k--;)t=listeners[k].apply(this,arguments),void 0!==t&&(r=t);(t=this["on"+ti.toLowerCase()])&&(r=t.apply(this,arguments))}return r}};var filterWord=UE.filterWord=function(){function isWordDocument(str){return/(class="?Mso|style="[^"]*\bmso\-|w:WordDocument|<v:)/gi.test(str)}function transUnit(v){return v=v.replace(/[\d.]+\w+/g,function(m){return utils.transUnitToPx(m)})}function filterPasteWord(str){return str.replace(/[\t\r\n]+/g,"").replace(/<!--[\s\S]*?-->/gi,"").replace(/<v:shape [^>]*>[\s\S]*?.<\/v:shape>/gi,function(str){if(browser.opera)return"";try{var width=str.match(/width:([ \d.]*p[tx])/i)[1],height=str.match(/height:([ \d.]*p[tx])/i)[1],src=str.match(/src=\s*"([^"]*)"/i)[1];return'<img width="'+transUnit(width)+'" height="'+transUnit(height)+'" src="'+src+'" />'}catch(e){return""}}).replace(/<\/?div[^>]*>/g,"").replace(/v:\w+=(["']?)[^'"]+\1/g,"").replace(/<(!|script[^>]*>.*?<\/script(?=[>\s])|\/?(\?xml(:\w+)?|xml|meta|link|style|\w+:\w+)(?=[\s\/>]))[^>]*>/gi,"").replace(/<p [^>]*class="?MsoHeading"?[^>]*>(.*?)<\/p>/gi,"<p><strong>$1</strong></p>").replace(/\s+(class|lang|align)\s*=\s*(['"]?)[\w-]+\2/gi,"").replace(/<(font|span)[^>]*>\s*<\/\1>/gi,"").replace(/(<[a-z][^>]*)\sstyle=(["'])([^\2]*?)\2/gi,function(str,tag,tmp,style){for(var v,n=[],s=style.replace(/^\s+|\s+$/,"").replace(/&#39;/g,"'").replace(/&quot;/gi,"'").split(/;\s*/g),i=0;v=s[i];i++){var name,value,parts=v.split(":");if(2==parts.length){if(name=parts[0].toLowerCase(),value=parts[1].toLowerCase(),/^(background)\w*/.test(name)&&0==value.replace(/(initial|\s)/g,"").length||/^(margin)\w*/.test(name)&&/^0\w+$/.test(value))continue;switch(name){case"mso-padding-alt":case"mso-padding-top-alt":case"mso-padding-right-alt":case"mso-padding-bottom-alt":case"mso-padding-left-alt":case"mso-margin-alt":case"mso-margin-top-alt":case"mso-margin-right-alt":case"mso-margin-bottom-alt":case"mso-margin-left-alt":case"mso-height":case"mso-width":case"mso-vertical-align-alt":/<table/.test(tag)||(n[i]=name.replace(/^mso-|-alt$/g,"")+":"+transUnit(value));continue;case"horiz-align":n[i]="text-align:"+value;continue;case"vert-align":n[i]="vertical-align:"+value;continue;case"font-color":case"mso-foreground":n[i]="color:"+value;continue;case"mso-background":case"mso-highlight":n[i]="background:"+value;continue;case"mso-default-height":n[i]="min-height:"+transUnit(value);continue;case"mso-default-width":n[i]="min-width:"+transUnit(value);continue;case"mso-padding-between-alt":n[i]="border-collapse:separate;border-spacing:"+transUnit(value);continue;case"text-line-through":("single"==value||"double"==value)&&(n[i]="text-decoration:line-through");continue;case"mso-zero-height":"yes"==value&&(n[i]="display:none");continue;case"background":break;case"margin":if(!/[1-9]/.test(value))continue}if(/^(mso|column|font-emph|lang|layout|line-break|list-image|nav|panose|punct|row|ruby|sep|size|src|tab-|table-border|text-(?:decor|trans)|top-bar|version|vnd|word-break)/.test(name)||/text\-indent|padding|margin/.test(name)&&/\-[\d.]+/.test(value))continue;n[i]=name+":"+parts[1]}}return tag+(n.length?' style="'+n.join(";").replace(/;{2,}/g,";")+'"':"")}).replace(/[\d.]+(cm|pt)/g,function(str){return utils.transUnitToPx(str)})}return function(html){return(isWordDocument(html)?filterPasteWord(html):html).replace(/>[ \t\r\n]*</g,"><")}}(),dtd=dom.dtd=function(){function _(s){for(var k in s)s[k.toUpperCase()]=s[k];return s}function X(t){for(var a=arguments,i=1;a.length>i;i++){var x=a[i];for(var k in x)t.hasOwnProperty(k)||(t[k]=x[k])}return t}var A=_({isindex:1,fieldset:1}),B=_({input:1,button:1,select:1,textarea:1,label:1}),C=X(_({a:1}),B),D=X({iframe:1},C),E=_({hr:1,ul:1,menu:1,div:1,blockquote:1,noscript:1,table:1,center:1,address:1,dir:1,pre:1,h5:1,dl:1,h4:1,noframes:1,h6:1,ol:1,h1:1,h3:1,h2:1}),F=_({ins:1,del:1,script:1,style:1}),G=X(_({b:1,acronym:1,bdo:1,"var":1,"#":1,abbr:1,code:1,br:1,i:1,cite:1,kbd:1,u:1,strike:1,s:1,tt:1,strong:1,q:1,samp:1,em:1,dfn:1,span:1}),F),H=X(_({sub:1,img:1,embed:1,object:1,sup:1,basefont:1,map:1,applet:1,font:1,big:1,small:1}),G),I=X(_({p:1}),H),J=X(_({iframe:1}),H,B),K=_({img:1,embed:1,noscript:1,br:1,kbd:1,center:1,button:1,basefont:1,h5:1,h4:1,samp:1,h6:1,ol:1,h1:1,h3:1,h2:1,form:1,font:1,"#":1,select:1,menu:1,ins:1,abbr:1,label:1,code:1,table:1,script:1,cite:1,input:1,iframe:1,strong:1,textarea:1,noframes:1,big:1,small:1,span:1,hr:1,sub:1,bdo:1,"var":1,div:1,object:1,sup:1,strike:1,dir:1,map:1,dl:1,applet:1,del:1,isindex:1,fieldset:1,ul:1,b:1,acronym:1,a:1,blockquote:1,i:1,u:1,s:1,tt:1,address:1,q:1,pre:1,p:1,em:1,dfn:1}),L=X(_({a:0}),J),M=_({tr:1}),N=_({"#":1}),O=X(_({param:1}),K),P=X(_({form:1}),A,D,E,I),Q=_({li:1}),R=_({style:1,script:1}),S=_({base:1,link:1,meta:1,title:1}),T=X(S,R),U=_({head:1,body:1}),V=_({html:1}),block=_({address:1,blockquote:1,center:1,dir:1,div:1,dl:1,fieldset:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,isindex:1,menu:1,noframes:1,ol:1,p:1,pre:1,table:1,ul:1}),empty=_({area:1,base:1,br:1,col:1,hr:1,img:1,input:1,link:1,meta:1,param:1,embed:1});return _({$nonBodyContent:X(V,U,S),$block:block,$inline:L,$body:X(_({script:1,style:1}),block),$cdata:_({script:1,style:1}),$empty:empty,$nonChild:_({iframe:1,textarea:1}),$listItem:_({dd:1,dt:1,li:1}),$list:_({ul:1,ol:1,dl:1}),$isNotEmpty:_({table:1,ul:1,ol:1,dl:1,iframe:1,area:1,base:1,col:1,hr:1,img:1,embed:1,input:1,link:1,meta:1,param:1}),$removeEmpty:_({a:1,abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,"var":1}),$removeEmptyBlock:_({p:1,div:1}),$tableContent:_({caption:1,col:1,colgroup:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1,table:1}),$notTransContent:_({pre:1,script:1,style:1,textarea:1}),html:U,head:T,style:N,script:N,body:P,base:{},link:{},meta:{},title:N,col:{},tr:_({td:1,th:1}),img:{},embed:{},colgroup:_({thead:1,col:1,tbody:1,tr:1,tfoot:1}),noscript:P,td:P,br:{},th:P,center:P,kbd:L,button:X(I,E),basefont:{},h5:L,h4:L,samp:L,h6:L,ol:Q,h1:L,h3:L,option:N,h2:L,form:X(A,D,E,I),select:_({optgroup:1,option:1}),font:L,ins:L,menu:Q,abbr:L,label:L,table:_({thead:1,col:1,tbody:1,tr:1,colgroup:1,caption:1,tfoot:1}),code:L,tfoot:M,cite:L,li:P,input:{},iframe:P,strong:L,textarea:N,noframes:P,big:L,small:L,span:_({"#":1,br:1}),hr:L,dt:L,sub:L,optgroup:_({option:1}),param:{},bdo:L,"var":L,div:P,object:O,sup:L,dd:P,strike:L,area:{},dir:Q,map:X(_({area:1,form:1,p:1}),A,F,E),applet:O,dl:_({dt:1,dd:1}),del:L,isindex:{},fieldset:X(_({legend:1}),K),thead:M,ul:Q,acronym:L,b:L,a:X(_({a:1}),J),blockquote:X(_({td:1,tr:1,tbody:1,li:1}),P),caption:L,i:L,u:L,tbody:M,s:L,address:X(D,I),tt:L,legend:L,q:L,pre:X(G,C),p:X(_({a:1}),L),em:L,dfn:L})}(),attrFix=ie&&9>browser.version?{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder"}:{tabindex:"tabIndex",readonly:"readOnly"},styleBlock=utils.listToMap(["-webkit-box","-moz-box","block","list-item","table","table-row-group","table-header-group","table-footer-group","table-row","table-column-group","table-column","table-cell","table-caption"]),domUtils=dom.domUtils={NODE_ELEMENT:1,NODE_DOCUMENT:9,NODE_TEXT:3,NODE_COMMENT:8,NODE_DOCUMENT_FRAGMENT:11,POSITION_IDENTICAL:0,POSITION_DISCONNECTED:1,POSITION_FOLLOWING:2,POSITION_PRECEDING:4,POSITION_IS_CONTAINED:8,POSITION_CONTAINS:16,fillChar:ie&&"6"==browser.version?"﻿":"​",keys:{8:1,46:1,16:1,17:1,18:1,37:1,38:1,39:1,40:1,13:1},getPosition:function(nodeA,nodeB){if(nodeA===nodeB)return 0;var node,parentsA=[nodeA],parentsB=[nodeB];for(node=nodeA;node=node.parentNode;){if(node===nodeB)return 10;parentsA.push(node)}for(node=nodeB;node=node.parentNode;){if(node===nodeA)return 20;parentsB.push(node)}if(parentsA.reverse(),parentsB.reverse(),parentsA[0]!==parentsB[0])return 1;for(var i=-1;i++,parentsA[i]===parentsB[i];);for(nodeA=parentsA[i],nodeB=parentsB[i];nodeA=nodeA.nextSibling;)if(nodeA===nodeB)return 4;return 2},getNodeIndex:function(node,ignoreTextNode){for(var preNode=node,i=0;preNode=preNode.previousSibling;)ignoreTextNode&&3==preNode.nodeType||i++;return i},inDoc:function(node,doc){return 10==domUtils.getPosition(node,doc)},findParent:function(node,filterFn,includeSelf){if(node&&!domUtils.isBody(node))for(node=includeSelf?node:node.parentNode;node;){if(!filterFn||filterFn(node)||domUtils.isBody(node))return filterFn&&!filterFn(node)&&domUtils.isBody(node)?null:node;node=node.parentNode}return null},findParentByTagName:function(node,tagNames,includeSelf,excludeFn){return tagNames=utils.listToMap(utils.isArray(tagNames)?tagNames:[tagNames]),domUtils.findParent(node,function(node){return tagNames[node.tagName]&&!(excludeFn&&excludeFn(node))},includeSelf)},findParents:function(node,includeSelf,filterFn,closerFirst){for(var parents=includeSelf&&(filterFn&&filterFn(node)||!filterFn)?[node]:[];node=domUtils.findParent(node,filterFn);)parents.push(node);return closerFirst?parents:parents.reverse()},insertAfter:function(node,newNode){return node.parentNode.insertBefore(newNode,node.nextSibling)},remove:function(node,keepChildren){var child,parent=node.parentNode;if(parent){if(keepChildren&&node.hasChildNodes())for(;child=node.firstChild;)parent.insertBefore(child,node);parent.removeChild(node)}return node},getNextDomNode:function(node,startFromChild,filterFn,guard){return getDomNode(node,"firstChild","nextSibling",startFromChild,filterFn,guard)},isBookmarkNode:function(node){return 1==node.nodeType&&node.id&&/^_baidu_bookmark_/i.test(node.id)},getWindow:function(node){var doc=node.ownerDocument||node;return doc.defaultView||doc.parentWindow},getCommonAncestor:function(nodeA,nodeB){if(nodeA===nodeB)return nodeA;for(var parentsA=[nodeA],parentsB=[nodeB],parent=nodeA,i=-1;parent=parent.parentNode;){if(parent===nodeB)return parent;parentsA.push(parent)}for(parent=nodeB;parent=parent.parentNode;){if(parent===nodeA)return parent;parentsB.push(parent)}for(parentsA.reverse(),parentsB.reverse();i++,parentsA[i]===parentsB[i];);return 0==i?null:parentsA[i-1]},clearEmptySibling:function(node,ignoreNext,ignorePre){function clear(next,dir){for(var tmpNode;next&&!domUtils.isBookmarkNode(next)&&(domUtils.isEmptyInlineElement(next)||!RegExp("[^	\n\r"+domUtils.fillChar+"]").test(next.nodeValue));)tmpNode=next[dir],domUtils.remove(next),next=tmpNode}!ignoreNext&&clear(node.nextSibling,"nextSibling"),!ignorePre&&clear(node.previousSibling,"previousSibling")},split:function(node,offset){var doc=node.ownerDocument;if(browser.ie&&offset==node.nodeValue.length){var next=doc.createTextNode("");return domUtils.insertAfter(node,next)}var retval=node.splitText(offset);if(browser.ie8){var tmpNode=doc.createTextNode("");domUtils.insertAfter(retval,tmpNode),domUtils.remove(tmpNode)}return retval},isWhitespace:function(node){return!RegExp("[^ 	\n\r"+domUtils.fillChar+"]").test(node.nodeValue)},getXY:function(element){for(var x=0,y=0;element.offsetParent;)y+=element.offsetTop,x+=element.offsetLeft,element=element.offsetParent;return{x:x,y:y}},on:function(element,type,handler){var types=utils.isArray(type)?type:[type],k=types.length;if(k)for(;k--;)if(type=types[k],element.addEventListener)element.addEventListener(type,handler,!1);else{handler._d||(handler._d={els:[]});var key=type+(""+handler),index=utils.indexOf(handler._d.els,element);handler._d[key]&&-1!=index||(-1==index&&handler._d.els.push(element),handler._d[key]||(handler._d[key]=function(evt){return handler.call(evt.srcElement,evt||window.event)}),element.attachEvent("on"+type,handler._d[key]))}element=null},un:function(element,type,handler){var types=utils.isArray(type)?type:[type],k=types.length;if(k)for(;k--;)if(type=types[k],element.removeEventListener)element.removeEventListener(type,handler,!1);else{var key=type+(""+handler);try{element.detachEvent("on"+type,handler._d?handler._d[key]:handler)}catch(e){}if(handler._d&&handler._d[key]){var index=utils.indexOf(handler._d.els,element);-1!=index&&handler._d.els.splice(index,1),0==handler._d.els.length&&delete handler._d[key]}}},isSameElement:function(nodeA,nodeB){if(nodeA.tagName!=nodeB.tagName)return!1;var thisAttrs=nodeA.attributes,otherAttrs=nodeB.attributes;if(!ie&&thisAttrs.length!=otherAttrs.length)return!1;for(var attrA,attrB,al=0,bl=0,i=0;attrA=thisAttrs[i++];){if("style"==attrA.nodeName){if(attrA.specified&&al++,domUtils.isSameStyle(nodeA,nodeB))continue;return!1}if(ie){if(!attrA.specified)continue;al++,attrB=otherAttrs.getNamedItem(attrA.nodeName)}else attrB=nodeB.attributes[attrA.nodeName];if(!attrB.specified||attrA.nodeValue!=attrB.nodeValue)return!1}if(ie){for(i=0;attrB=otherAttrs[i++];)attrB.specified&&bl++;if(al!=bl)return!1}return!0},isSameStyle:function(nodeA,nodeB){var styleA=nodeA.style.cssText.replace(/( ?; ?)/g,";").replace(/( ?: ?)/g,":"),styleB=nodeB.style.cssText.replace(/( ?; ?)/g,";").replace(/( ?: ?)/g,":");if(browser.opera){if(styleA=nodeA.style,styleB=nodeB.style,styleA.length!=styleB.length)return!1;for(var p in styleA)if(!/^(\d+|csstext)$/i.test(p)&&styleA[p]!=styleB[p])return!1;return!0}if(!styleA||!styleB)return styleA==styleB;if(styleA=styleA.split(";"),styleB=styleB.split(";"),styleA.length!=styleB.length)return!1;for(var ci,i=0;ci=styleA[i++];)if(-1==utils.indexOf(styleB,ci))return!1;return!0},isBlockElm:function(node){return 1==node.nodeType&&(dtd.$block[node.tagName]||styleBlock[domUtils.getComputedStyle(node,"display")])&&!dtd.$nonChild[node.tagName]},isBody:function(node){return node&&1==node.nodeType&&"body"==node.tagName.toLowerCase()},breakParent:function(node,parent){var tmpNode,leftNodes,rightNodes,parentClone=node,clone=node;do{for(parentClone=parentClone.parentNode,leftNodes?(tmpNode=parentClone.cloneNode(!1),tmpNode.appendChild(leftNodes),leftNodes=tmpNode,tmpNode=parentClone.cloneNode(!1),tmpNode.appendChild(rightNodes),rightNodes=tmpNode):(leftNodes=parentClone.cloneNode(!1),rightNodes=leftNodes.cloneNode(!1));tmpNode=clone.previousSibling;)leftNodes.insertBefore(tmpNode,leftNodes.firstChild);for(;tmpNode=clone.nextSibling;)rightNodes.appendChild(tmpNode);clone=parentClone}while(parent!==parentClone);return tmpNode=parent.parentNode,tmpNode.insertBefore(leftNodes,parent),tmpNode.insertBefore(rightNodes,parent),tmpNode.insertBefore(node,rightNodes),domUtils.remove(parent),node},isEmptyInlineElement:function(node){if(1!=node.nodeType||!dtd.$removeEmpty[node.tagName])return 0;for(node=node.firstChild;node;){if(domUtils.isBookmarkNode(node))return 0;if(1==node.nodeType&&!domUtils.isEmptyInlineElement(node)||3==node.nodeType&&!domUtils.isWhitespace(node))return 0;node=node.nextSibling}return 1},trimWhiteTextNode:function(node){function remove(dir){for(var child;(child=node[dir])&&3==child.nodeType&&domUtils.isWhitespace(child);)node.removeChild(child)}remove("firstChild"),remove("lastChild")},mergeChild:function(node,tagName,attrs){for(var ci,list=domUtils.getElementsByTagName(node,node.tagName.toLowerCase()),i=0;ci=list[i++];)if(ci.parentNode&&!domUtils.isBookmarkNode(ci))if("span"!=ci.tagName.toLowerCase())domUtils.isSameElement(node,ci)&&domUtils.remove(ci,!0);else{if(node===ci.parentNode&&(domUtils.trimWhiteTextNode(node),1==node.childNodes.length)){node.style.cssText=ci.style.cssText+";"+node.style.cssText,domUtils.remove(ci,!0);continue}if(ci.style.cssText=node.style.cssText+";"+ci.style.cssText,attrs){var style=attrs.style;if(style){style=style.split(";");for(var s,j=0;s=style[j++];)ci.style[utils.cssStyleToDomStyle(s.split(":")[0])]=s.split(":")[1]}}domUtils.isSameStyle(ci,node)&&domUtils.remove(ci,!0)}},getElementsByTagName:function(node,name){for(var ci,list=node.getElementsByTagName(name),arr=[],i=0;ci=list[i++];)arr.push(ci);return arr},mergeToParent:function(node){for(var parent=node.parentNode;parent&&dtd.$removeEmpty[parent.tagName];){if(parent.tagName==node.tagName||"A"==parent.tagName){if(domUtils.trimWhiteTextNode(parent),"SPAN"==parent.tagName&&!domUtils.isSameStyle(parent,node)||"A"==parent.tagName&&"SPAN"==node.tagName){if(parent.childNodes.length>1||parent!==node.parentNode){node.style.cssText=parent.style.cssText+";"+node.style.cssText,parent=parent.parentNode;continue}parent.style.cssText+=";"+node.style.cssText,"A"==parent.tagName&&(parent.style.textDecoration="underline")}if("A"!=parent.tagName){parent===node.parentNode&&domUtils.remove(node,!0);break}}parent=parent.parentNode}},mergeSibling:function(node,ignorePre,ignoreNext){function merge(rtl,start,node){var next;if((next=node[rtl])&&!domUtils.isBookmarkNode(next)&&1==next.nodeType&&domUtils.isSameElement(node,next)){for(;next.firstChild;)"firstChild"==start?node.insertBefore(next.lastChild,node.firstChild):node.appendChild(next.firstChild);domUtils.remove(next)}}!ignorePre&&merge("previousSibling","firstChild",node),!ignoreNext&&merge("nextSibling","lastChild",node)},unSelectable:ie||browser.opera?function(node){node.onselectstart=function(){return!1},node.onclick=node.onkeyup=node.onkeydown=function(){return!1},node.unselectable="on",node.setAttribute("unselectable","on");for(var ci,i=0;ci=node.all[i++];)switch(ci.tagName.toLowerCase()){case"iframe":case"textarea":case"input":case"select":break;default:ci.unselectable="on",node.setAttribute("unselectable","on")}}:function(node){node.style.MozUserSelect=node.style.webkitUserSelect=node.style.KhtmlUserSelect="none"},removeAttributes:function(node,attrNames){for(var ci,i=0;ci=attrNames[i++];){switch(ci=attrFix[ci]||ci){case"className":node[ci]="";break;case"style":node.style.cssText="",!browser.ie&&node.removeAttributeNode(node.getAttributeNode("style"))}node.removeAttribute(ci)}},createElement:function(doc,tag,attrs){return domUtils.setAttributes(doc.createElement(tag),attrs)},setAttributes:function(node,attrs){for(var attr in attrs)if(attrs.hasOwnProperty(attr)){var value=attrs[attr];switch(attr){case"class":node.className=value;break;case"style":node.style.cssText=node.style.cssText+";"+value;break;case"innerHTML":node[attr]=value;break;case"value":node.value=value;break;default:node.setAttribute(attrFix[attr]||attr,value)}}return node},getComputedStyle:function(element,styleName){var pros="width height top left";if(pros.indexOf(styleName)>-1)return element["offset"+styleName.replace(/^\w/,function(s){return s.toUpperCase()})]+"px";if(3==element.nodeType&&(element=element.parentNode),browser.ie&&9>browser.version&&"font-size"==styleName&&!element.style.fontSize&&!dtd.$empty[element.tagName]&&!dtd.$nonChild[element.tagName]){var span=element.ownerDocument.createElement("span");span.style.cssText="padding:0;border:0;font-family:simsun;",span.innerHTML=".",element.appendChild(span);var result=span.offsetHeight;return element.removeChild(span),span=null,result+"px"}try{var value=domUtils.getStyle(element,styleName)||(window.getComputedStyle?domUtils.getWindow(element).getComputedStyle(element,"").getPropertyValue(styleName):(element.currentStyle||element.style)[utils.cssStyleToDomStyle(styleName)])}catch(e){return""}return utils.transUnitToPx(utils.fixColor(styleName,value))},removeClasses:function(elm,classNames){classNames=utils.isArray(classNames)?classNames:utils.trim(classNames).replace(/[ ]{2,}/g," ").split(" ");for(var ci,i=0,cls=elm.className;ci=classNames[i++];)cls=cls.replace(RegExp("\\b"+ci+"\\b"),"");cls=utils.trim(cls).replace(/[ ]{2,}/g," "),cls?elm.className=cls:domUtils.removeAttributes(elm,["class"])},addClass:function(elm,classNames){if(elm){classNames=utils.trim(classNames).replace(/[ ]{2,}/g," ").split(" ");for(var ci,i=0,cls=elm.className;ci=classNames[i++];)RegExp("\\b"+ci+"\\b").test(cls)||(elm.className+=" "+ci)}},hasClass:function(element,className){className=utils.trim(className).replace(/[ ]{2,}/g," ").split(" ");for(var ci,i=0,cls=element.className;ci=className[i++];)if(!RegExp("\\b"+ci+"\\b").test(cls))return!1;return i-1==className.length},preventDefault:function(evt){evt.preventDefault?evt.preventDefault():evt.returnValue=!1},removeStyle:function(element,name){element.style.removeProperty?element.style.removeProperty(name):element.style.removeAttribute(utils.cssStyleToDomStyle(name)),element.style.cssText||domUtils.removeAttributes(element,["style"])},getStyle:function(element,name){var value=element.style[utils.cssStyleToDomStyle(name)];return utils.fixColor(name,value)},setStyle:function(element,name,value){element.style[utils.cssStyleToDomStyle(name)]=value},setStyles:function(element,styles){for(var name in styles)styles.hasOwnProperty(name)&&domUtils.setStyle(element,name,styles[name])},removeDirtyAttr:function(node){for(var ci,i=0,nodes=node.getElementsByTagName("*");ci=nodes[i++];)ci.removeAttribute("_moz_dirty");node.removeAttribute("_moz_dirty")},getChildCount:function(node,fn){var count=0,first=node.firstChild;for(fn=fn||function(){return 1};first;)fn(first)&&count++,first=first.nextSibling;return count},isEmptyNode:function(node){return!node.firstChild||0==domUtils.getChildCount(node,function(node){return!domUtils.isBr(node)&&!domUtils.isBookmarkNode(node)&&!domUtils.isWhitespace(node)})},clearSelectedArr:function(nodes){for(var node;node=nodes.pop();)domUtils.removeAttributes(node,["class"])},scrollToView:function(node,win,offsetTop){var getViewPaneSize=function(){var doc=win.document,mode="CSS1Compat"==doc.compatMode;return{width:(mode?doc.documentElement.clientWidth:doc.body.clientWidth)||0,height:(mode?doc.documentElement.clientHeight:doc.body.clientHeight)||0}},getScrollPosition=function(win){if("pageXOffset"in win)return{x:win.pageXOffset||0,y:win.pageYOffset||0};var doc=win.document;return{x:doc.documentElement.scrollLeft||doc.body.scrollLeft||0,y:doc.documentElement.scrollTop||doc.body.scrollTop||0}},winHeight=getViewPaneSize().height,offset=-1*winHeight+offsetTop;offset+=node.offsetHeight||0;var elementPosition=domUtils.getXY(node);offset+=elementPosition.y;var currentScroll=getScrollPosition(win).y;(offset>currentScroll||currentScroll-winHeight>offset)&&win.scrollTo(0,offset+(0>offset?-20:20))},isBr:function(node){return 1==node.nodeType&&"BR"==node.tagName},isFillChar:function(node){return 3==node.nodeType&&!node.nodeValue.replace(RegExp(domUtils.fillChar),"").length},isStartInblock:function(range){for(var tmp,tmpRange=range.cloneRange(),flag=0,start=tmpRange.startContainer;start&&domUtils.isFillChar(start);)tmp=start,start=start.previousSibling;for(tmp&&(tmpRange.setStartBefore(tmp),start=tmpRange.startContainer),1==start.nodeType&&domUtils.isEmptyNode(start)&&1==tmpRange.startOffset&&tmpRange.setStart(start,0).collapse(!0);!tmpRange.startOffset;){if(start=tmpRange.startContainer,domUtils.isBlockElm(start)||domUtils.isBody(start)){flag=1;break}var tmpNode,pre=tmpRange.startContainer.previousSibling;if(pre){for(;pre&&domUtils.isFillChar(pre);)tmpNode=pre,pre=pre.previousSibling;
tmpNode?tmpRange.setStartBefore(tmpNode):tmpRange.setStartBefore(tmpRange.startContainer)}else tmpRange.setStartBefore(tmpRange.startContainer)}return flag&&!domUtils.isBody(tmpRange.startContainer)?1:0},isEmptyBlock:function(node){var reg=RegExp("[ 	\r\n"+domUtils.fillChar+"]","g");if(node[browser.ie?"innerText":"textContent"].replace(reg,"").length>0)return 0;for(var n in dtd.$isNotEmpty)if(node.getElementsByTagName(n).length)return 0;return 1},setViewportOffset:function(element,offset){var left=0|parseInt(element.style.left),top=0|parseInt(element.style.top),rect=element.getBoundingClientRect(),offsetLeft=offset.left-rect.left,offsetTop=offset.top-rect.top;offsetLeft&&(element.style.left=left+offsetLeft+"px"),offsetTop&&(element.style.top=top+offsetTop+"px")},fillNode:function(doc,node){var tmpNode=browser.ie?doc.createTextNode(domUtils.fillChar):doc.createElement("br");node.innerHTML="",node.appendChild(tmpNode)},moveChild:function(src,tag,dir){for(;src.firstChild;)dir&&tag.firstChild?tag.insertBefore(src.lastChild,tag.firstChild):tag.appendChild(src.firstChild)},hasNoAttributes:function(node){return browser.ie?/^<\w+\s*?>/.test(node.outerHTML):0==node.attributes.length},isCustomeNode:function(node){return 1==node.nodeType&&node.getAttribute("_ue_custom_node_")},isTagNode:function(node,tagName){return 1==node.nodeType&&RegExp(node.tagName,"i").test(tagName)},filterNodeList:function(nodelist,filter,forAll){var results=[];if(!utils.isFunction(filter)){var str=filter;filter=function(n){return-1!=utils.indexOf(utils.isArray(str)?str:str.split(" "),n.tagName.toLowerCase())}}return utils.each(nodelist,function(n){filter(n)&&results.push(n)}),0==results.length?null:1!=results.length&&forAll?results:results[0]},isInNodeEndBoundary:function(rng,node){var start=rng.startContainer;if(3==start.nodeType&&rng.startOffset!=start.nodeValue.length)return 0;if(1==start.nodeType&&rng.startOffset!=start.childNodes.length)return 0;for(;start!==node;){if(start.nextSibling)return 0;start=start.parentNode}return 1}},fillCharReg=RegExp(domUtils.fillChar,"g");(function(){function updateCollapse(range){range.collapsed=range.startContainer&&range.endContainer&&range.startContainer===range.endContainer&&range.startOffset==range.endOffset}function selectOneNode(rng){return!rng.collapsed&&1==rng.startContainer.nodeType&&rng.startContainer===rng.endContainer&&1==rng.endOffset-rng.startOffset}function setEndPoint(toStart,node,offset,range){return 1==node.nodeType&&(dtd.$empty[node.tagName]||dtd.$nonChild[node.tagName])&&(offset=domUtils.getNodeIndex(node)+(toStart?0:1),node=node.parentNode),toStart?(range.startContainer=node,range.startOffset=offset,range.endContainer||range.collapse(!0)):(range.endContainer=node,range.endOffset=offset,range.startContainer||range.collapse(!1)),updateCollapse(range),range}function execContentsAction(range,action){var tmpStart,tmpEnd,start=range.startContainer,end=range.endContainer,startOffset=range.startOffset,endOffset=range.endOffset,doc=range.document,frag=doc.createDocumentFragment();if(1==start.nodeType&&(start=start.childNodes[startOffset]||(tmpStart=start.appendChild(doc.createTextNode("")))),1==end.nodeType&&(end=end.childNodes[endOffset]||(tmpEnd=end.appendChild(doc.createTextNode("")))),start===end&&3==start.nodeType)return frag.appendChild(doc.createTextNode(start.substringData(startOffset,endOffset-startOffset))),action&&(start.deleteData(startOffset,endOffset-startOffset),range.collapse(!0)),frag;for(var current,currentLevel,clone=frag,startParents=domUtils.findParents(start,!0),endParents=domUtils.findParents(end,!0),i=0;startParents[i]==endParents[i];)i++;for(var si,j=i;si=startParents[j];j++){for(current=si.nextSibling,si==start?tmpStart||(3==range.startContainer.nodeType?(clone.appendChild(doc.createTextNode(start.nodeValue.slice(startOffset))),action&&start.deleteData(startOffset,start.nodeValue.length-startOffset)):clone.appendChild(action?start:start.cloneNode(!0))):(currentLevel=si.cloneNode(!1),clone.appendChild(currentLevel));current&&current!==end&&current!==endParents[j];)si=current.nextSibling,clone.appendChild(action?current:current.cloneNode(!0)),current=si;clone=currentLevel}clone=frag,startParents[i]||(clone.appendChild(startParents[i-1].cloneNode(!1)),clone=clone.firstChild);for(var ei,j=i;ei=endParents[j];j++){if(current=ei.previousSibling,ei==end?tmpEnd||3!=range.endContainer.nodeType||(clone.appendChild(doc.createTextNode(end.substringData(0,endOffset))),action&&end.deleteData(0,endOffset)):(currentLevel=ei.cloneNode(!1),clone.appendChild(currentLevel)),j!=i||!startParents[i])for(;current&&current!==start;)ei=current.previousSibling,clone.insertBefore(action?current:current.cloneNode(!0),clone.firstChild),current=ei;clone=currentLevel}return action&&range.setStartBefore(endParents[i]?startParents[i]?endParents[i]:startParents[i-1]:endParents[i-1]).collapse(!0),tmpStart&&domUtils.remove(tmpStart),tmpEnd&&domUtils.remove(tmpEnd),frag}function removeFillData(doc,excludeNode){try{if(fillData&&domUtils.inDoc(fillData,doc))if(fillData.nodeValue.replace(fillCharReg,"").length)fillData.nodeValue=fillData.nodeValue.replace(fillCharReg,"");else{var tmpNode=fillData.parentNode;for(domUtils.remove(fillData);tmpNode&&domUtils.isEmptyInlineElement(tmpNode)&&(browser.safari?!(domUtils.getPosition(tmpNode,excludeNode)&domUtils.POSITION_CONTAINS):!tmpNode.contains(excludeNode));)fillData=tmpNode.parentNode,domUtils.remove(tmpNode),tmpNode=fillData}}catch(e){}}function mergeSibling(node,dir){var tmpNode;for(node=node[dir];node&&domUtils.isFillChar(node);)tmpNode=node[dir],domUtils.remove(node),node=tmpNode}var fillData,guid=0,fillChar=domUtils.fillChar,Range=dom.Range=function(document){var me=this;me.startContainer=me.startOffset=me.endContainer=me.endOffset=null,me.document=document,me.collapsed=!0};Range.prototype={cloneContents:function(){return this.collapsed?null:execContentsAction(this,0)},deleteContents:function(){var txt;return this.collapsed||execContentsAction(this,1),browser.webkit&&(txt=this.startContainer,3!=txt.nodeType||txt.nodeValue.length||(this.setStartBefore(txt).collapse(!0),domUtils.remove(txt))),this},extractContents:function(){return this.collapsed?null:execContentsAction(this,2)},setStart:function(node,offset){return setEndPoint(!0,node,offset,this)},setEnd:function(node,offset){return setEndPoint(!1,node,offset,this)},setStartAfter:function(node){return this.setStart(node.parentNode,domUtils.getNodeIndex(node)+1)},setStartBefore:function(node){return this.setStart(node.parentNode,domUtils.getNodeIndex(node))},setEndAfter:function(node){return this.setEnd(node.parentNode,domUtils.getNodeIndex(node)+1)},setEndBefore:function(node){return this.setEnd(node.parentNode,domUtils.getNodeIndex(node))},setStartAtFirst:function(node){return this.setStart(node,0)},setStartAtLast:function(node){return this.setStart(node,3==node.nodeType?node.nodeValue.length:node.childNodes.length)},setEndAtFirst:function(node){return this.setEnd(node,0)},setEndAtLast:function(node){return this.setEnd(node,3==node.nodeType?node.nodeValue.length:node.childNodes.length)},selectNode:function(node){return this.setStartBefore(node).setEndAfter(node)},selectNodeContents:function(node){return this.setStart(node,0).setEndAtLast(node)},cloneRange:function(){var me=this;return new Range(me.document).setStart(me.startContainer,me.startOffset).setEnd(me.endContainer,me.endOffset)},collapse:function(toStart){var me=this;return toStart?(me.endContainer=me.startContainer,me.endOffset=me.startOffset):(me.startContainer=me.endContainer,me.startOffset=me.endOffset),me.collapsed=!0,me},shrinkBoundary:function(ignoreEnd){function check(node){return 1==node.nodeType&&!domUtils.isBookmarkNode(node)&&!dtd.$empty[node.tagName]&&!dtd.$nonChild[node.tagName]}for(var child,me=this,collapsed=me.collapsed;1==me.startContainer.nodeType&&(child=me.startContainer.childNodes[me.startOffset])&&check(child);)me.setStart(child,0);if(collapsed)return me.collapse(!0);if(!ignoreEnd)for(;1==me.endContainer.nodeType&&me.endOffset>0&&(child=me.endContainer.childNodes[me.endOffset-1])&&check(child);)me.setEnd(child,child.childNodes.length);return me},getCommonAncestor:function(includeSelf,ignoreTextNode){var me=this,start=me.startContainer,end=me.endContainer;return start===end?includeSelf&&selectOneNode(this)&&(start=start.childNodes[me.startOffset],1==start.nodeType)?start:ignoreTextNode&&3==start.nodeType?start.parentNode:start:domUtils.getCommonAncestor(start,end)},trimBoundary:function(ignoreEnd){this.txtToElmBoundary();var start=this.startContainer,offset=this.startOffset,collapsed=this.collapsed,end=this.endContainer;if(3==start.nodeType){if(0==offset)this.setStartBefore(start);else if(offset>=start.nodeValue.length)this.setStartAfter(start);else{var textNode=domUtils.split(start,offset);start===end?this.setEnd(textNode,this.endOffset-offset):start.parentNode===end&&(this.endOffset+=1),this.setStartBefore(textNode)}if(collapsed)return this.collapse(!0)}return ignoreEnd||(offset=this.endOffset,end=this.endContainer,3==end.nodeType&&(0==offset?this.setEndBefore(end):(end.nodeValue.length>offset&&domUtils.split(end,offset),this.setEndAfter(end)))),this},txtToElmBoundary:function(){function adjust(r,c){var container=r[c+"Container"],offset=r[c+"Offset"];3==container.nodeType&&(offset?offset>=container.nodeValue.length&&r["set"+c.replace(/(\w)/,function(a){return a.toUpperCase()})+"After"](container):r["set"+c.replace(/(\w)/,function(a){return a.toUpperCase()})+"Before"](container))}return this.collapsed||(adjust(this,"start"),adjust(this,"end")),this},insertNode:function(node){var first=node,length=1;11==node.nodeType&&(first=node.firstChild,length=node.childNodes.length),this.trimBoundary(!0);var start=this.startContainer,offset=this.startOffset,nextNode=start.childNodes[offset];return nextNode?start.insertBefore(node,nextNode):start.appendChild(node),first.parentNode===this.endContainer&&(this.endOffset=this.endOffset+length),this.setStartBefore(first)},setCursor:function(toEnd,noFillData){return this.collapse(!toEnd).select(noFillData)},createBookmark:function(serialize,same){var endNode,startNode=this.document.createElement("span");return startNode.style.cssText="display:none;line-height:0px;",startNode.appendChild(this.document.createTextNode("﻿")),startNode.id="_baidu_bookmark_start_"+(same?"":guid++),this.collapsed||(endNode=startNode.cloneNode(!0),endNode.id="_baidu_bookmark_end_"+(same?"":guid++)),this.insertNode(startNode),endNode&&this.collapse().insertNode(endNode).setEndBefore(endNode),this.setStartAfter(startNode),{start:serialize?startNode.id:startNode,end:endNode?serialize?endNode.id:endNode:null,id:serialize}},moveToBookmark:function(bookmark){var start=bookmark.id?this.document.getElementById(bookmark.start):bookmark.start,end=bookmark.end&&bookmark.id?this.document.getElementById(bookmark.end):bookmark.end;return this.setStartBefore(start),domUtils.remove(start),end?(this.setEndBefore(end),domUtils.remove(end)):this.collapse(!0),this},enlarge:function(toBlock,stopFn){var pre,node,isBody=domUtils.isBody,tmp=this.document.createTextNode("");if(toBlock){for(node=this.startContainer,1==node.nodeType?node.childNodes[this.startOffset]?pre=node=node.childNodes[this.startOffset]:(node.appendChild(tmp),pre=node=tmp):pre=node;;){if(domUtils.isBlockElm(node)){for(node=pre;(pre=node.previousSibling)&&!domUtils.isBlockElm(pre);)node=pre;this.setStartBefore(node);break}pre=node,node=node.parentNode}for(node=this.endContainer,1==node.nodeType?((pre=node.childNodes[this.endOffset])?node.insertBefore(tmp,pre):node.appendChild(tmp),pre=node=tmp):pre=node;;){if(domUtils.isBlockElm(node)){for(node=pre;(pre=node.nextSibling)&&!domUtils.isBlockElm(pre);)node=pre;this.setEndAfter(node);break}pre=node,node=node.parentNode}tmp.parentNode===this.endContainer&&this.endOffset--,domUtils.remove(tmp)}if(!this.collapsed){for(;!(0!=this.startOffset||stopFn&&stopFn(this.startContainer)||isBody(this.startContainer));)this.setStartBefore(this.startContainer);for(;!(this.endOffset!=(1==this.endContainer.nodeType?this.endContainer.childNodes.length:this.endContainer.nodeValue.length)||stopFn&&stopFn(this.endContainer)||isBody(this.endContainer));)this.setEndAfter(this.endContainer)}return this},adjustmentBoundary:function(){if(!this.collapsed){for(;!domUtils.isBody(this.startContainer)&&this.startOffset==this.startContainer[3==this.startContainer.nodeType?"nodeValue":"childNodes"].length;)this.setStartAfter(this.startContainer);for(;!domUtils.isBody(this.endContainer)&&!this.endOffset;)this.setEndBefore(this.endContainer)}return this},applyInlineStyle:function(tagName,attrs,list){if(this.collapsed)return this;this.trimBoundary().enlarge(!1,function(node){return 1==node.nodeType&&domUtils.isBlockElm(node)}).adjustmentBoundary();for(var node,pre,bookmark=this.createBookmark(),end=bookmark.end,filterFn=function(node){return 1==node.nodeType?"br"!=node.tagName.toLowerCase():!domUtils.isWhitespace(node)},current=domUtils.getNextDomNode(bookmark.start,!1,filterFn),range=this.cloneRange();current&&domUtils.getPosition(current,end)&domUtils.POSITION_PRECEDING;)if(3==current.nodeType||dtd[tagName][current.tagName]){for(range.setStartBefore(current),node=current;node&&(3==node.nodeType||dtd[tagName][node.tagName])&&node!==end;)pre=node,node=domUtils.getNextDomNode(node,1==node.nodeType,null,function(parent){return dtd[tagName][parent.tagName]});var elm,frag=range.setEndAfter(pre).extractContents();if(list&&list.length>0){var level,top;top=level=list[0].cloneNode(!1);for(var ci,i=1;ci=list[i++];)level.appendChild(ci.cloneNode(!1)),level=level.firstChild;elm=level}else elm=range.document.createElement(tagName);attrs&&domUtils.setAttributes(elm,attrs),elm.appendChild(frag),range.insertNode(list?top:elm);var aNode;if("span"==tagName&&attrs.style&&/text\-decoration/.test(attrs.style)&&(aNode=domUtils.findParentByTagName(elm,"a",!0))?(domUtils.setAttributes(aNode,attrs),domUtils.remove(elm,!0),elm=aNode):(domUtils.mergeSibling(elm),domUtils.clearEmptySibling(elm)),domUtils.mergeChild(elm,attrs),current=domUtils.getNextDomNode(elm,!1,filterFn),domUtils.mergeToParent(elm),node===end)break}else current=domUtils.getNextDomNode(current,!0,filterFn);return this.moveToBookmark(bookmark)},removeInlineStyle:function(tagNames){if(this.collapsed)return this;tagNames=utils.isArray(tagNames)?tagNames:[tagNames],this.shrinkBoundary().adjustmentBoundary();for(var start=this.startContainer,end=this.endContainer;;){if(1==start.nodeType){if(utils.indexOf(tagNames,start.tagName.toLowerCase())>-1)break;if("body"==start.tagName.toLowerCase()){start=null;break}}start=start.parentNode}for(;;){if(1==end.nodeType){if(utils.indexOf(tagNames,end.tagName.toLowerCase())>-1)break;if("body"==end.tagName.toLowerCase()){end=null;break}}end=end.parentNode}var frag,tmpRange,bookmark=this.createBookmark();start&&(tmpRange=this.cloneRange().setEndBefore(bookmark.start).setStartBefore(start),frag=tmpRange.extractContents(),tmpRange.insertNode(frag),domUtils.clearEmptySibling(start,!0),start.parentNode.insertBefore(bookmark.start,start)),end&&(tmpRange=this.cloneRange().setStartAfter(bookmark.end).setEndAfter(end),frag=tmpRange.extractContents(),tmpRange.insertNode(frag),domUtils.clearEmptySibling(end,!1,!0),end.parentNode.insertBefore(bookmark.end,end.nextSibling));for(var next,current=domUtils.getNextDomNode(bookmark.start,!1,function(node){return 1==node.nodeType});current&&current!==bookmark.end;)next=domUtils.getNextDomNode(current,!0,function(node){return 1==node.nodeType}),utils.indexOf(tagNames,current.tagName.toLowerCase())>-1&&domUtils.remove(current,!0),current=next;return this.moveToBookmark(bookmark)},getClosedNode:function(){var node;if(!this.collapsed){var range=this.cloneRange().adjustmentBoundary().shrinkBoundary();if(selectOneNode(range)){var child=range.startContainer.childNodes[range.startOffset];child&&1==child.nodeType&&(dtd.$empty[child.tagName]||dtd.$nonChild[child.tagName])&&(node=child)}}return node},select:browser.ie?function(noFillData,textRange){var nativeRange;this.collapsed||this.shrinkBoundary();var node=this.getClosedNode();if(node&&!textRange){try{nativeRange=this.document.body.createControlRange(),nativeRange.addElement(node),nativeRange.select()}catch(e){}return this}var end,bookmark=this.createBookmark(),start=bookmark.start;if(nativeRange=this.document.body.createTextRange(),nativeRange.moveToElementText(start),nativeRange.moveStart("character",1),this.collapsed){if(!noFillData&&3!=this.startContainer.nodeType){var tmpText=this.document.createTextNode(fillChar),tmp=this.document.createElement("span");tmp.appendChild(this.document.createTextNode(fillChar)),start.parentNode.insertBefore(tmp,start),start.parentNode.insertBefore(tmpText,start),removeFillData(this.document,tmpText),fillData=tmpText,mergeSibling(tmp,"previousSibling"),mergeSibling(start,"nextSibling"),nativeRange.moveStart("character",-1),nativeRange.collapse(!0)}}else{var nativeRangeEnd=this.document.body.createTextRange();end=bookmark.end,nativeRangeEnd.moveToElementText(end),nativeRange.setEndPoint("EndToEnd",nativeRangeEnd)}this.moveToBookmark(bookmark),tmp&&domUtils.remove(tmp);try{nativeRange.select()}catch(e){}return this}:function(notInsertFillData){var txtNode,win=domUtils.getWindow(this.document),sel=win.getSelection();if(browser.gecko?this.document.body.focus():win.focus(),sel){if(sel.removeAllRanges(),this.collapsed){if(notInsertFillData&&browser.opera&&!domUtils.isBody(this.startContainer)&&1==this.startContainer.nodeType){var tmp=this.document.createTextNode("");this.insertNode(tmp).setStart(tmp,0).collapse(!0)}notInsertFillData||3==this.startContainer.nodeType&&(0!=this.startOffset||this.startContainer.previousSibling&&3==this.startContainer.previousSibling.nodeType)||(txtNode=this.document.createTextNode(fillChar),this.insertNode(txtNode),removeFillData(this.document,txtNode),mergeSibling(txtNode,"previousSibling"),mergeSibling(txtNode,"nextSibling"),fillData=txtNode,this.setStart(txtNode,browser.webkit?1:0).collapse(!0))}var nativeRange=this.document.createRange();nativeRange.setStart(this.startContainer,this.startOffset),nativeRange.setEnd(this.endContainer,this.endOffset),sel.addRange(nativeRange)}return this},scrollToView:function(win,offset){win=win?window:domUtils.getWindow(this.document);var me=this,span=me.document.createElement("span");return span.innerHTML="&nbsp;",me.cloneRange().insertNode(span),domUtils.scrollToView(span,win,offset),domUtils.remove(span),me}}})(),function(){function getBoundaryInformation(range,start){var getIndex=domUtils.getNodeIndex;range=range.duplicate(),range.collapse(start);var parent=range.parentElement();if(!parent.hasChildNodes())return{container:parent,offset:0};for(var child,distance,siblings=parent.children,testRange=range.duplicate(),startIndex=0,endIndex=siblings.length-1,index=-1;endIndex>=startIndex;){index=Math.floor((startIndex+endIndex)/2),child=siblings[index],testRange.moveToElementText(child);var position=testRange.compareEndPoints("StartToStart",range);if(position>0)endIndex=index-1;else{if(!(0>position))return{container:parent,offset:getIndex(child)};startIndex=index+1}}if(-1==index){if(testRange.moveToElementText(parent),testRange.setEndPoint("StartToStart",range),distance=testRange.text.replace(/(\r\n|\r)/g,"\n").length,siblings=parent.childNodes,!distance)return child=siblings[siblings.length-1],{container:child,offset:child.nodeValue.length};for(var i=siblings.length;distance>0;)distance-=siblings[--i].nodeValue.length;return{container:siblings[i],offset:-distance}}if(testRange.collapse(position>0),testRange.setEndPoint(position>0?"StartToStart":"EndToStart",range),distance=testRange.text.replace(/(\r\n|\r)/g,"\n").length,!distance)return dtd.$empty[child.tagName]||dtd.$nonChild[child.tagName]?{container:parent,offset:getIndex(child)+(position>0?0:1)}:{container:child,offset:position>0?0:child.childNodes.length};for(;distance>0;)try{var pre=child;child=child[position>0?"previousSibling":"nextSibling"],distance-=child.nodeValue.length}catch(e){return{container:parent,offset:getIndex(pre)}}return{container:child,offset:position>0?-distance:child.nodeValue.length+distance}}function transformIERangeToRange(ieRange,range){if(ieRange.item)range.selectNode(ieRange.item(0));else{var bi=getBoundaryInformation(ieRange,!0);range.setStart(bi.container,bi.offset),0!=ieRange.compareEndPoints("StartToEnd",ieRange)&&(bi=getBoundaryInformation(ieRange,!1),range.setEnd(bi.container,bi.offset))}return range}function _getIERange(sel){var ieRange;try{ieRange=sel.getNative().createRange()}catch(e){return null}var el=ieRange.item?ieRange.item(0):ieRange.parentElement();return(el.ownerDocument||el)===sel.document?ieRange:null}var Selection=dom.Selection=function(doc){var iframe,me=this;me.document=doc,ie&&(iframe=domUtils.getWindow(doc).frameElement,domUtils.on(iframe,"beforedeactivate",function(){me._bakIERange=me.getIERange()}),domUtils.on(iframe,"activate",function(){try{!_getIERange(me)&&me._bakIERange&&me._bakIERange.select()}catch(ex){}me._bakIERange=null})),iframe=doc=null};Selection.prototype={getNative:function(){var doc=this.document;try{return doc?ie?doc.selection:domUtils.getWindow(doc).getSelection():null}catch(e){return null}},getIERange:function(){var ieRange=_getIERange(this);return!ieRange&&this._bakIERange?this._bakIERange:ieRange},cache:function(){this.clear(),this._cachedRange=this.getRange(),this._cachedStartElement=this.getStart(),this._cachedStartElementPath=this.getStartElementPath()},getStartElementPath:function(){if(this._cachedStartElementPath)return this._cachedStartElementPath;var start=this.getStart();return start?domUtils.findParents(start,!0,null,!0):[]},clear:function(){this._cachedStartElementPath=this._cachedRange=this._cachedStartElement=null},isFocus:function(){try{return browser.ie&&_getIERange(this)||!browser.ie&&this.getNative().rangeCount?!0:!1}catch(e){return!1}},getRange:function(){function optimze(range){for(var child=me.document.body.firstChild,collapsed=range.collapsed;child&&child.firstChild;)range.setStart(child,0),child=child.firstChild;range.startContainer||range.setStart(me.document.body,0),collapsed&&range.collapse(!0)}var me=this;if(null!=me._cachedRange)return this._cachedRange;var range=new baidu.editor.dom.Range(me.document);if(ie){var nativeRange=me.getIERange();nativeRange?transformIERangeToRange(nativeRange,range):optimze(range)}else{var sel=me.getNative();if(sel&&sel.rangeCount){var firstRange=sel.getRangeAt(0),lastRange=sel.getRangeAt(sel.rangeCount-1);range.setStart(firstRange.startContainer,firstRange.startOffset).setEnd(lastRange.endContainer,lastRange.endOffset),range.collapsed&&domUtils.isBody(range.startContainer)&&!range.startOffset&&optimze(range)}else{if(this._bakRange&&domUtils.inDoc(this._bakRange.startContainer,this.document))return this._bakRange;optimze(range)}}return this._bakRange=range},getStart:function(){if(this._cachedStartElement)return this._cachedStartElement;var tmpRange,start,tmp,parent,range=ie?this.getIERange():this.getRange();if(ie){if(!range)return this.document.body.firstChild;if(range.item)return range.item(0);for(tmpRange=range.duplicate(),tmpRange.text.length>0&&tmpRange.moveStart("character",1),tmpRange.collapse(1),start=tmpRange.parentElement(),parent=tmp=range.parentElement();tmp=tmp.parentNode;)if(tmp==start){start=parent;break}}else if(range.shrinkBoundary(),start=range.startContainer,1==start.nodeType&&start.hasChildNodes()&&(start=start.childNodes[Math.min(start.childNodes.length-1,range.startOffset)]),3==start.nodeType)return start.parentNode;return start},getText:function(){var nativeSel,nativeRange;return this.isFocus()&&(nativeSel=this.getNative())?(nativeRange=browser.ie?nativeSel.createRange():nativeSel.getRangeAt(0),browser.ie?nativeRange.text:""+nativeRange):""}}}(),UE.plugins.serialize=function(){function ptToPx(value){return/pt/.test(value)?value.replace(/([\d.]+)pt/g,function(str){return Math.round(96*parseFloat(str)/72)+"px"}):value}function transNode(node,word_img_flag){var attr,sizeMap=[0,10,12,16,18,24,32,48];switch(utils.indexOf,node.tag){case"script":node.tag="div",node.attributes._ue_org_tagName="script",node.attributes._ue_div_script=1,node.attributes._ue_script_data=node.children[0]?encodeURIComponent(node.children[0].data):"",node.attributes._ue_custom_node_=1,node.children=[];break;case"style":node.tag="div",node.attributes._ue_div_style=1,node.attributes._ue_org_tagName="style",node.attributes._ue_style_data=node.children[0]?encodeURIComponent(node.children[0].data):"",node.attributes._ue_custom_node_=1,node.children=[];break;case"img":if(node.attributes.src&&/^data:/.test(node.attributes.src))return{type:"fragment",children:[]};if(node.attributes.src&&/^(?:file)/.test(node.attributes.src)){if(!/(gif|bmp|png|jpg|jpeg)$/.test(node.attributes.src))return{type:"fragment",children:[]};node.attributes.word_img=node.attributes.src,node.attributes.src=me.options.UEDITOR_HOME_URL+"themes/default/images/spacer.gif";var flag=128>parseInt(node.attributes.width)||43>parseInt(node.attributes.height);node.attributes.style="background:url("+(flag?me.options.themePath+me.options.theme+"/images/word.gif":me.options.langPath+me.options.lang+"/images/localimage.png")+") no-repeat center center;border:1px solid #ddd",word_img_flag&&(word_img_flag.flag=1)}browser.ie&&7>browser.version&&(node.attributes.orgSrc=node.attributes.src),node.attributes.data_ue_src=node.attributes.data_ue_src||node.attributes.src;break;case"li":var child=node.children[0];if(!child||"element"!=child.type||"p"!=child.tag&&dtd.p[child.tag]){var tmpPNode={type:"element",tag:"p",attributes:{},parent:node};tmpPNode.children=child?node.children:[browser.ie?{type:"text",data:domUtils.fillChar,parent:tmpPNode}:{type:"element",tag:"br",attributes:{},closed:!0,children:[],parent:tmpPNode}],node.children=[tmpPNode]}break;case"table":case"td":optStyle(node);break;case"a":node.attributes.anchorname&&(node.tag="img",node.attributes={"class":"anchorclass",anchorname:node.attributes.name},node.closed=1),node.attributes.href&&(node.attributes.data_ue_src=node.attributes.href);break;case"b":node.tag=node.name="strong";break;case"i":node.tag=node.name="em";break;case"u":node.tag=node.name="span",node.attributes.style=(node.attributes.style||"")+";text-decoration:underline;";break;case"s":case"del":node.tag=node.name="span",node.attributes.style=(node.attributes.style||"")+";text-decoration:line-through;",1==node.children.length&&(child=node.children[0],child.tag==node.tag&&(node.attributes.style+=";"+child.attributes.style,node.children=child.children));break;case"span":var style=node.attributes.style;if(style&&(!node.attributes.style||browser.webkit&&"white-space:nowrap;"==style)&&delete node.attributes.style,browser.gecko&&10902>=browser.version&&node.parent){var parent=node.parent;"span"==parent.tag&&parent.attributes&&parent.attributes.style&&(node.attributes.style=parent.attributes.style+";"+node.attributes.style)}utils.isEmptyObject(node.attributes)&&autoClearEmptyNode&&(node.type="fragment");break;case"font":for(node.tag=node.name="span",attr=node.attributes,node.attributes={style:(attr.size?"font-size:"+(sizeMap[attr.size]||12)+"px":"")+";"+(attr.color?"color:"+attr.color:"")+";"+(attr.face?"font-family:"+attr.face:"")+";"+(attr.style||"")};node.parent.tag==node.tag&&1==node.parent.children.length;)node.attributes.style&&(node.parent.attributes.style?node.parent.attributes.style+=";"+node.attributes.style:node.parent.attributes.style=node.attributes.style),node.parent.children=node.children,node=node.parent;break;case"p":node.attributes.align&&(node.attributes.style=(node.attributes.style||"")+";text-align:"+node.attributes.align+";",delete node.attributes.align)}return node}function optStyle(node){if(ie&&node.attributes.style){var style=node.attributes.style;node.attributes.style=style.replace(/;\s*/g,";"),node.attributes.style=node.attributes.style.replace(/^\s*|\s*$/,"")}}function transOutNode(node){switch(node.tag){case"div":node.attributes._ue_div_script&&(node.tag="script",node.children=[{type:"cdata",data:node.attributes._ue_script_data?decodeURIComponent(node.attributes._ue_script_data):"",parent:node}],delete node.attributes._ue_div_script,delete node.attributes._ue_script_data,delete node.attributes._ue_custom_node_,delete node.attributes._ue_org_tagName),node.attributes._ue_div_style&&(node.tag="style",node.children=[{type:"cdata",data:node.attributes._ue_style_data?decodeURIComponent(node.attributes._ue_style_data):"",parent:node}],delete node.attributes._ue_div_style,delete node.attributes._ue_style_data,delete node.attributes._ue_custom_node_,delete node.attributes._ue_org_tagName);break;case"table":!node.attributes.style&&delete node.attributes.style,ie&&node.attributes.style&&optStyle(node),"noBorderTable"==node.attributes["class"]&&delete node.attributes["class"];break;case"td":case"th":if(/display\s*:\s*none/i.test(node.attributes.style))return{type:"fragment",children:[]};if(ie&&!node.children.length){var txtNode={type:"text",data:domUtils.fillChar,parent:node};node.children[0]=txtNode}ie&&node.attributes.style&&optStyle(node),"selectTdClass"==node.attributes["class"]&&delete node.attributes["class"];break;case"img":node.attributes.anchorname?(node.tag="a",node.attributes={name:node.attributes.anchorname,anchorname:1},node.closed=null):node.attributes.data_ue_src&&(node.attributes.src=node.attributes.data_ue_src,delete node.attributes.data_ue_src);break;case"a":node.attributes.data_ue_src&&(node.attributes.href=node.attributes.data_ue_src,delete node.attributes.data_ue_src)}return node}function childrenAccept(node,visit,ctx){if(!node.children||!node.children.length)return node;for(var children=node.children,i=0;children.length>i;i++){var newNode=visit(children[i],ctx);if("fragment"==newNode.type){var args=[i,1];args.push.apply(args,newNode.children),children.splice.apply(children,args),children.length||(node={type:"fragment",children:[]}),i--}else children[i]=newNode}return node}function Serialize(rules){this.rules=rules}var ie=browser.ie,version=browser.version,me=this,autoClearEmptyNode=me.options.autoClearEmptyNode,EMPTY_TAG=dtd.$empty,parseHTML=function(){function parse(html,callbacks){var match,tagName,cdata,nextIndex=0;for(RE_PART.exec("");match=RE_PART.exec(html);){var tagIndex=match.index;if(tagIndex>nextIndex){var text=html.slice(nextIndex,tagIndex);cdata?cdata.push(text):callbacks.onText(text)}if(nextIndex=RE_PART.lastIndex,!(tagName=match[1])||(tagName=tagName.toLowerCase(),cdata&&tagName==cdata._tag_name&&(callbacks.onCDATA(cdata.join("")),cdata=null),cdata))if(cdata)cdata.push(match[0]);else if(tagName=match[3]){if(/="/.test(tagName))continue;tagName=tagName.toLowerCase();var attrMatch,attrPart=match[4],attrMap={},selfClosing=attrPart&&"/"==attrPart.slice(-1);if(attrPart)for(RE_ATTR.exec("");attrMatch=RE_ATTR.exec(attrPart);){var attrName=attrMatch[1].toLowerCase(),attrValue=attrMatch[2]||attrMatch[3]||attrMatch[4]||"";!attrValue&&EMPTY_ATTR[attrName]&&(attrValue=attrName),"style"==attrName&&ie&&6>=version&&(attrValue=attrValue.replace(/(?!;)\s*([\w-]+):/g,function(m,p1){return p1.toLowerCase()+":"})),attrValue&&(attrMap[attrName]=attrValue.replace(/:\s*/g,":"))}callbacks.onTagOpen(tagName,attrMap,selfClosing),!cdata&&CDATA_TAG[tagName]&&(cdata=[],cdata._tag_name=tagName)}else(tagName=match[2])&&callbacks.onComment(tagName);else callbacks.onTagClose(tagName)}html.length>nextIndex&&callbacks.onText(html.slice(nextIndex,html.length))}var RE_PART=/<(?:(?:\/([^>]+)>)|(?:!--([\S|\s]*?)-->)|(?:([^\s\/>]+)\s*((?:(?:"[^"]*")|(?:'[^']*')|[^"'<>])*)\/?>))/g,RE_ATTR=/([\w\-:.]+)(?:(?:\s*=\s*(?:(?:"([^"]*)")|(?:'([^']*)')|([^\s>]+)))|(?=\s|$))/g,EMPTY_ATTR={checked:1,compact:1,declare:1,defer:1,disabled:1,ismap:1,multiple:1,nohref:1,noresize:1,noshade:1,nowrap:1,readonly:1,selected:1},CDATA_TAG={script:1,style:1},NEED_PARENT_TAG={li:{$:"ul",ul:1,ol:1},dd:{$:"dl",dl:1},dt:{$:"dl",dl:1},option:{$:"select",select:1},td:{$:"tr",tr:1},th:{$:"tr",tr:1},tr:{$:"tbody",tbody:1,thead:1,tfoot:1,table:1},tbody:{$:"table",table:1,colgroup:1},thead:{$:"table",table:1},tfoot:{$:"table",table:1},col:{$:"colgroup",colgroup:1}},NEED_CHILD_TAG={table:"td",tbody:"td",thead:"td",tfoot:"td",tr:"td",colgroup:"col",ul:"li",ol:"li",dl:"dd",select:"option"};
return function(html,forceDtd){function addChild(node){node.parent=currentNode,currentNode.children.push(node)}function addElement(element,open){var node=element;if(NEED_PARENT_TAG[node.tag]){for(;NEED_PARENT_TAG[currentNode.tag]&&NEED_PARENT_TAG[currentNode.tag][node.tag];)currentNode=currentNode.parent;for(currentNode.tag==node.tag&&(currentNode=currentNode.parent);NEED_PARENT_TAG[node.tag]&&!NEED_PARENT_TAG[node.tag][currentNode.tag];)node=node.parent={type:"element",tag:NEED_PARENT_TAG[node.tag].$,attributes:{},children:[node]}}if(forceDtd)for(;dtd[node.tag]&&!("span"==currentNode.tag?utils.extend(dtd.strong,{a:1,A:1}):dtd[currentNode.tag]||dtd.div)[node.tag];)if(!tagEnd(currentNode)){if(!currentNode.parent)break;currentNode=currentNode.parent}return node.parent=currentNode,currentNode.children.push(node),open&&(currentNode=element),element.attributes.style&&(element.attributes.style=element.attributes.style.toLowerCase()),element}function tagEnd(node){var needTag;return!node.children.length&&(needTag=NEED_CHILD_TAG[node.tag])?(addElement({type:"element",tag:needTag,attributes:{},children:[]},!0),!0):!1}var fragment={type:"fragment",parent:null,children:[]},currentNode=fragment;for(parse(html,{onText:function(text){for(;!(dtd[currentNode.tag]||dtd.div)["#"];)tagEnd(currentNode)||(currentNode=currentNode.parent);addChild({type:"text",data:text})},onComment:function(text){addChild({type:"comment",data:text})},onCDATA:function(text){for(;!(dtd[currentNode.tag]||dtd.div)["#"];)tagEnd(currentNode)||(currentNode=currentNode.parent);addChild({type:"cdata",data:text})},onTagOpen:function(tag,attrs,closed){closed=closed||EMPTY_TAG[tag],addElement({type:"element",tag:tag,attributes:attrs,closed:closed,children:[]},!closed)},onTagClose:function(tag){for(var node=currentNode;node&&tag!=node.tag;)node=node.parent;if(node){for(var tnode=currentNode;tnode!==node.parent;tnode=tnode.parent)tagEnd(tnode);currentNode=node.parent}else dtd.$removeEmpty[tag]||dtd.$removeEmptyBlock[tag]||"embed"==tag||(node={type:"element",tag:tag,attributes:{},children:[]},addElement(node,!0),tagEnd(node),currentNode=node.parent)}});currentNode!==fragment;)tagEnd(currentNode),currentNode=currentNode.parent;return fragment}}(),unhtml1=function(){function rep(m){return map[m]}var map={"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};return function(str){return str+="",str?str.replace(/[<>"']/g,rep):""}}(),toHTML=function(){function printChildren(node,pasteplain){for(var ci,children=node.children,buff=[],i=0;ci=children[i];i++)buff.push(toHTML(ci,pasteplain));return buff.join("")}function printAttrs(attrs){var buff=[];for(var k in attrs){var value=attrs[k];"style"==k&&(value=ptToPx(value),/rgba?\s*\([^)]*\)/.test(value)&&(value=value.replace(/rgba?\s*\(([^)]*)\)/g,function(str){return utils.fixColor("color",str)})),attrs[k]=utils.optCss(value.replace(/windowtext/g,"#000")).replace(/white-space[^;]+;/g,"")),buff.push(k+'="'+unhtml1(attrs[k])+'"')}return buff.join(" ")}function printData(node,notTrans){return notTrans?node.data.replace(/&nbsp;/g," "):unhtml1(node.data).replace(/ /g,"&nbsp;")}function printElement(node,pasteplain){if("element"==node.type&&!node.children.length&&dtd.$removeEmpty[node.tag]&&"a"!=node.tag&&utils.isEmptyObject(node.attributes)&&autoClearEmptyNode)return html;var tag=node.tag;if(pasteplain&&"td"==tag)html||(html=""),html+=printChildren(node,pasteplain)+"&nbsp;&nbsp;&nbsp;";else{var attrs=printAttrs(node.attributes),html="<"+(pasteplain&&transHtml[tag]?transHtml[tag]:tag)+(attrs?" "+attrs:"")+(EMPTY_TAG[tag]?" />":">");EMPTY_TAG[tag]||("p"!=tag||node.children.length||(html+=browser.ie?"&nbsp;":"<br/>"),html+=printChildren(node,pasteplain),html+="</"+(pasteplain&&transHtml[tag]?transHtml[tag]:tag)+">")}return html}var transHtml={div:"p",li:"p",tr:"p",br:"br",p:"p"};return function(node,pasteplain){return"fragment"==node.type?printChildren(node,pasteplain):"element"==node.type?printElement(node,pasteplain):"text"==node.type||"cdata"==node.type?printData(node,dtd.$notTransContent[node.parent.tag]):"comment"==node.type?"<!--"+node.data+"-->":""}}(),NODE_NAME_MAP={text:"#text",comment:"#comment",cdata:"#cdata-section",fragment:"#document-fragment"};Serialize.prototype={rules:null,filter:function(node,rules,modify){function visitNode(node,parent){if(node.name="element"==node.type?node.tag:NODE_NAME_MAP[node.type],null==parent)return childrenAccept(node,visitNode,node);if(blackList&&(blackList[node.name]||node.attributes&&node.attributes._ue_org_tagName&&blackList[node.attributes._ue_org_tagName]))return modify&&(modify.flag=1),{type:"fragment",children:[]};if(whiteList&&"element"==node.type)if("fragment"==parent.type?whiteList[node.name]:whiteList[node.name]&&whiteList[parent.name][node.name]){var props;if(props=whiteList[node.name].$){var oldAttrs=node.attributes,newAttrs={};for(var k in props)oldAttrs[k]&&(newAttrs[k]=oldAttrs[k]);node.attributes=newAttrs}}else modify&&(modify.flag=1),node.type="fragment",node.name=parent.name;return(blackList||whiteList)&&childrenAccept(node,visitNode,node),node}rules=rules||this.rules;var whiteList=rules&&rules.whiteList,blackList=rules&&rules.blackList;return visitNode(node,null)},transformInput:function(node,word_img_flag){function visitNode(node){return node=transNode(node,word_img_flag),node=childrenAccept(node,visitNode,node),me.options.pageBreakTag&&"text"==node.type&&node.data.replace(/\s/g,"")==me.options.pageBreakTag&&(node.type="element",node.name=node.tag="hr",delete node.data,node.attributes={"class":"pagebreak",noshade:"noshade",size:"5",unselectable:"on",style:"moz-user-select:none;-khtml-user-select: none;"},node.children=[]),"text"!=node.type||dtd.$notTransContent[node.parent.tag]||(node.data=node.data.replace(/[\r\t\n]*/g,"")),node}return visitNode(node)},transformOutput:function(node){function visitNode(node){return"hr"==node.tag&&"pagebreak"==node.attributes["class"]&&(delete node.tag,node.type="text",node.data=me.options.pageBreakTag,delete node.children),node=transOutNode(node),node=childrenAccept(node,visitNode,node)}return visitNode(node)},toHTML:toHTML,parseHTML:parseHTML,word:UE.filterWord},me.serialize=new Serialize(me.options.serialize||{}),UE.serialize=new Serialize({})},UE.plugins.undo=function(){function sceneRange(rng){var me=this;me.collapsed=rng.collapsed,me.startAddr=getAddr(rng.startContainer,rng.startOffset),me.endAddr=rng.collapsed?me.startAddr:getAddr(rng.endContainer,rng.endOffset)}function getAddr(node,index){for(var ci,i=0,parentsIndex=[index],parents=domUtils.findParents(node,!0,function(node){return!domUtils.isBody(node)},!0);ci=parents[i++];){if(1==i&&3==ci.nodeType){for(var tmpNode=ci;(tmpNode=tmpNode.previousSibling)&&3==tmpNode.nodeType;)index+=tmpNode.nodeValue.replace(fillCharReg,"").length;parentsIndex[0]=index}parentsIndex.push(domUtils.getNodeIndex(ci,!0))}return parentsIndex.reverse()}function compareAddr(indexA,indexB){if(indexA.length!=indexB.length)return 0;for(var i=0,l=indexA.length;l>i;i++)if(indexA[i]!=indexB[i])return 0;return 1}function setAddr(range,boundary,addr){node=range.document.body;for(var node,i=0,l=addr.length-1;l>i;i++)node=node.childNodes[addr[i]];range[boundary+"Container"]=node,range[boundary+"Offset"]=addr[addr.length-1]}function UndoManager(){this.list=[],this.index=0,this.hasUndo=!1,this.hasRedo=!1,this.undo=function(){if(this.hasUndo){var currentScene=this.getScene(),lastScene=this.list[this.index];if(lastScene.content.replace(specialAttr,"")!=currentScene.content.replace(specialAttr,"")&&this.save(),!this.list[this.index-1]&&1==this.list.length)return this.reset(),void 0;for(;this.list[this.index].content==this.list[this.index-1].content;)if(this.index--,0==this.index)return this.restore(0);this.restore(--this.index)}},this.redo=function(){if(this.hasRedo){for(;this.list[this.index].content==this.list[this.index+1].content;)if(this.index++,this.index==this.list.length-1)return this.restore(this.index);this.restore(++this.index)}},this.restore=function(){var scene=this.list[this.index];if(me.document.body.innerHTML=scene.bookcontent.replace(fillchar,""),browser.ie)for(var pi,i=0,ps=me.document.getElementsByTagName("p");pi=ps[i++];)""==pi.innerHTML&&domUtils.fillNode(me.document,pi);var range=new dom.Range(me.document);try{browser.opera||browser.safari?scene.senceRange.transformRange(range):range.moveToBookmark({start:"_baidu_bookmark_start_",end:"_baidu_bookmark_end_",id:!0}),browser.ie&&9==browser.version&&range.collapsed&&domUtils.isBlockElm(range.startContainer)&&domUtils.isEmptyNode(range.startContainer)&&domUtils.fillNode(range.document,range.startContainer),range.select(!browser.gecko),browser.opera||browser.safari||setTimeout(function(){range.scrollToView(me.autoHeightEnabled,me.autoHeightEnabled?domUtils.getXY(me.iframe).y:0)},200)}catch(e){}if(this.update(),me.currentSelectedArr){me.currentSelectedArr=[];for(var td,tds=me.document.getElementsByTagName("td"),i=0;td=tds[i++];)td.className==me.options.selectedTdClass&&me.currentSelectedArr.push(td)}this.clearKey(),me.fireEvent("reset",!0)},this.getScene=function(){var range=me.selection.getRange(),cont=me.body.innerHTML.replace(fillchar,"");if(range.shrinkBoundary(),browser.ie&&(cont=cont.replace(/>&nbsp;</g,"><").replace(/\s*</g,"").replace(/>\s*/g,">")),browser.opera||browser.safari)return{senceRange:new sceneRange(range),content:cont,bookcontent:cont};var bookmark=range.createBookmark(!0,!0),bookCont=me.body.innerHTML.replace(fillchar,"");return bookmark&&range.moveToBookmark(bookmark).select(!0),{bookcontent:bookCont,content:cont}},this.save=function(notCompareRange){var currentScene=this.getScene(),lastScene=this.list[this.index];lastScene&&lastScene.content==currentScene.content&&(notCompareRange?1:browser.opera||browser.safari?lastScene.senceRange.compare(currentScene.senceRange):lastScene.bookcontent==currentScene.bookcontent)||(this.list=this.list.slice(0,this.index+1),this.list.push(currentScene),this.list.length>maxUndoCount&&this.list.shift(),this.index=this.list.length-1,this.clearKey(),this.update())},this.update=function(){this.hasRedo=this.list[this.index+1]?!0:!1,this.hasUndo=this.list[this.index-1]||1==this.list.length?!0:!1},this.reset=function(){this.list=[],this.index=0,this.hasUndo=!1,this.hasRedo=!1,this.clearKey()},this.clearKey=function(){keycont=0,lastKeyCode=null,me.fireEvent("contentchange")}}function saveScene(){this.undoManger.save()}var me=this,maxUndoCount=me.options.maxUndoCount||20,maxInputCount=me.options.maxInputCount||20,fillchar=RegExp(domUtils.fillChar+"|</hr>","gi"),specialAttr=/\b(?:href|src|name)="[^"]*?"/gi;sceneRange.prototype={compare:function(obj){var me=this;return me.collapsed!==obj.collapsed?0:compareAddr(me.startAddr,obj.startAddr)&&compareAddr(me.endAddr,obj.endAddr)?1:0},transformRange:function(rng){var me=this;rng.collapsed=me.collapsed,setAddr(rng,"start",me.startAddr),rng.collapsed?rng.collapse(!0):setAddr(rng,"end",me.endAddr)}},me.undoManger=new UndoManager,me.addListener("beforeexeccommand",saveScene),me.addListener("afterexeccommand",saveScene),me.addListener("reset",function(type,exclude){exclude||me.undoManger.reset()}),me.commands.redo=me.commands.undo={execCommand:function(cmdName){me.undoManger[cmdName]()},queryCommandState:function(cmdName){return me.undoManger["has"+("undo"==cmdName.toLowerCase()?"Undo":"Redo")]?0:-1},notNeedUndo:1};var lastKeyCode,keys={16:1,17:1,18:1,37:1,38:1,39:1,40:1,13:1},keycont=0;me.addListener("keydown",function(type,evt){var keyCode=evt.keyCode||evt.which;if(!(keys[keyCode]||evt.ctrlKey||evt.metaKey||evt.shiftKey||evt.altKey)){if(0==me.undoManger.list.length||(8==keyCode||46==keyCode)&&lastKeyCode!=keyCode)return me.undoManger.save(!0),lastKeyCode=keyCode,void 0;2==me.undoManger.list.length&&0==me.undoManger.index&&0==keycont&&(me.undoManger.list.splice(1,1),me.undoManger.update()),lastKeyCode=keyCode,keycont++,keycont>=maxInputCount&&me.selection.getRange().collapsed&&me.undoManger.save()}})},UE.commands.inserthtml={execCommand:function(command,html,notSerialize){var range,div,me=this,tds=me.currentSelectedArr;range=me.selection.getRange(),div=range.document.createElement("div"),div.style.display="inline";var serialize=me.serialize;if(!notSerialize&&serialize){var node=serialize.parseHTML(html);node=serialize.transformInput(node),node=serialize.filter(node),html=serialize.toHTML(node)}div.innerHTML=utils.trim(html);try{me.adjustTable&&me.adjustTable(div)}catch(e){}if(tds&&tds.length){for(var ti,i=0;ti=tds[i++];)ti.className="";tds[0].innerHTML="",range.setStart(tds[0],0).collapse(!0),me.currentSelectedArr=[]}if(!range.collapsed&&(range.deleteContents(),1==range.startContainer.nodeType)){var pre,child=range.startContainer.childNodes[range.startOffset];if(child&&domUtils.isBlockElm(child)&&(pre=child.previousSibling)&&domUtils.isBlockElm(pre)){for(range.setEnd(pre,pre.childNodes.length).collapse();child.firstChild;)pre.appendChild(child.firstChild);domUtils.remove(child)}}for(var child,parent,pre,tmp,hadBreak=0;child=div.firstChild;){if(range.insertNode(child),!hadBreak&&child.nodeType==domUtils.NODE_ELEMENT&&domUtils.isBlockElm(child)&&(parent=domUtils.findParent(child,function(node){return domUtils.isBlockElm(node)}),parent&&"body"!=parent.tagName.toLowerCase()&&(!dtd[parent.tagName][child.nodeName]||child.parentNode!==parent))){if(dtd[parent.tagName][child.nodeName])for(tmp=child.parentNode;tmp!==parent;)pre=tmp,tmp=tmp.parentNode;else pre=parent;domUtils.breakParent(child,pre||tmp);var pre=child.previousSibling;domUtils.trimWhiteTextNode(pre),pre.childNodes.length||domUtils.remove(pre),!browser.ie&&(next=child.nextSibling)&&domUtils.isBlockElm(next)&&next.lastChild&&!domUtils.isBr(next.lastChild)&&next.appendChild(me.document.createElement("br")),hadBreak=1}var next=child.nextSibling;if(!div.firstChild&&next&&domUtils.isBlockElm(next)){range.setStart(next,0).collapse(!0);break}range.setEndAfter(child).collapse()}child=range.startContainer,domUtils.isBlockElm(child)&&domUtils.isEmptyNode(child)&&(child.innerHTML=browser.ie?"":"<br/>"),range.select(!0),setTimeout(function(){range=me.selection.getRange(),range.scrollToView(me.autoHeightEnabled,me.autoHeightEnabled?domUtils.getXY(me.iframe).y:0)},200)}},function(){function getClipboardData(callback){var doc=this.document;if(!doc.getElementById("baidu_pastebin")){var range=this.selection.getRange(),bk=range.createBookmark(),pastebin=doc.createElement("div");pastebin.id="baidu_pastebin",browser.webkit&&pastebin.appendChild(doc.createTextNode(domUtils.fillChar+domUtils.fillChar)),doc.body.appendChild(pastebin),bk.start.style.display="",pastebin.style.cssText="position:absolute;width:1px;height:1px;overflow:hidden;left:-1000px;white-space:nowrap;top:"+domUtils.getXY(bk.start).y+"px",range.selectNodeContents(pastebin).select(!0),setTimeout(function(){if(browser.webkit)for(var pi,i=0,pastebins=doc.querySelectorAll("#baidu_pastebin");pi=pastebins[i++];){if(!domUtils.isEmptyNode(pi)){pastebin=pi;break}domUtils.remove(pi)}try{pastebin.parentNode.removeChild(pastebin)}catch(e){}range.moveToBookmark(bk).select(!0),callback(pastebin)},0)}}UE.plugins.paste=function(){function filter(div){var html;if(div.firstChild){for(var ni,nodes=domUtils.getElementsByTagName(div,"span"),i=0;ni=nodes[i++];)("_baidu_cut_start"==ni.id||"_baidu_cut_end"==ni.id)&&domUtils.remove(ni);if(browser.webkit){for(var bi,brs=div.querySelectorAll("div br"),i=0;bi=brs[i++];){var pN=bi.parentNode;"DIV"==pN.tagName&&1==pN.childNodes.length&&(pN.innerHTML="<p><br/></p>",domUtils.remove(pN))}for(var di,divs=div.querySelectorAll("#baidu_pastebin"),i=0;di=divs[i++];){var tmpP=me.document.createElement("p");for(di.parentNode.insertBefore(tmpP,di);di.firstChild;)tmpP.appendChild(di.firstChild);domUtils.remove(di)}for(var ci,metas=div.querySelectorAll("meta"),i=0;ci=metas[i++];)domUtils.remove(ci);var brs=div.querySelectorAll("br");for(i=0;ci=brs[i++];)/^apple-/.test(ci)&&domUtils.remove(ci)}if(browser.gecko){var dirtyNodes=div.querySelectorAll("[_moz_dirty]");for(i=0;ci=dirtyNodes[i++];)ci.removeAttribute("_moz_dirty")}if(!browser.ie)for(var ci,spans=div.querySelectorAll("span.Apple-style-span"),i=0;ci=spans[i++];)domUtils.remove(ci,!0);html=div.innerHTML;var f=me.serialize;if(f)try{var node=f.transformInput(f.parseHTML(f.word(html)),word_img_flag);if(node=f.filter(node,pasteplain?{whiteList:{a:{$:{href:1}},p:{br:1,BR:1,$:{}},br:{$:{}},div:{br:1,BR:1,$:{}},li:{$:{}},tr:{td:1,$:{}},td:{$:{}}},blackList:{style:1,script:1,object:1}}:null,pasteplain?null:modify_num),browser.webkit)for(var child,length=node.children.length;(child=node.children[length-1])&&"br"==child.tag;)node.children.splice(length-1,1),length=node.children.length;html=f.toHTML(node,pasteplain)}catch(e){}html={html:html},me.fireEvent("beforepaste",html),me.execCommand("insertHtml",html.html,!0),me.fireEvent("afterpaste")}}var me=this,word_img_flag={flag:""},pasteplain=me.options.pasteplain===!0,modify_num={flag:""};me.commands.pasteplain={queryCommandState:function(){return pasteplain},execCommand:function(){pasteplain=0|!pasteplain},notNeedUndo:1},me.ready(function(){domUtils.on(me.body,"cut",function(){var range=me.selection.getRange();!range.collapsed&&me.undoManger&&me.undoManger.save()}),domUtils.on(me.body,browser.ie||browser.opera?"keydown":"paste",function(e){(!browser.ie&&!browser.opera||e.ctrlKey&&"86"==e.keyCode)&&getClipboardData.call(me,function(div){filter(div)})})})}}(),UE.plugins.cleanformat=function(){function isLine(node,notEmpty){return node&&3!=node.nodeType?domUtils.isBr(node)?1:node&&node.parentNode&&tags[node.tagName.toLowerCase()]?highlightCont&&highlightCont.contains(node)||node.getAttribute("pagebreak")?0:notEmpty?!domUtils.isEmptyBlock(node):domUtils.isEmptyBlock(node):void 0:0}function autotype(type,html){var cont;if(html){if(!opt.pasteFilter)return;cont=me.document.createElement("div"),cont.innerHTML=html.html}else cont=me.document.body;for(var ci,nodes=domUtils.getElementsByTagName(cont,"*"),i=0;ci=nodes[i++];){if(!highlightCont&&"DIV"==ci.tagName&&ci.getAttribute("highlighter")&&(highlightCont=ci),domUtils.removeAttributes(ci,["style"]),isLine(ci)){if(opt.mergeEmptyline)for(var tmpNode,next=ci.nextSibling,isBr=domUtils.isBr(ci);isLine(next)&&(tmpNode=next,next=tmpNode.nextSibling,!isBr||next&&(!next||domUtils.isBr(next)));)domUtils.remove(tmpNode);if(opt.removeEmptyline&&domUtils.inDoc(ci,cont)&&!remainTag[ci.parentNode.tagName.toLowerCase()]){if(domUtils.isBr(ci)&&(next=ci.nextSibling,next&&!domUtils.isBr(next)))continue;domUtils.remove(ci);continue}}if(isLine(ci,!0)&&"SPAN"!=ci.tagName&&(opt.indent&&(ci.style.textIndent=opt.indentValue),opt.textAlign&&(ci.style.textAlign=opt.textAlign)),opt.removeClass&&ci.className&&!remainClass[ci.className.toLowerCase()]){if(highlightCont&&highlightCont.contains(ci))continue;domUtils.removeAttributes(ci,["class"])}opt.removeEmptyNode&&opt.removeTagNames[ci.tagName.toLowerCase()]&&domUtils.hasNoAttributes(ci)&&domUtils.isEmptyBlock(ci)&&domUtils.remove(ci)}html&&(html.html=cont.innerHTML)}this.setOpt({cleanformat:{mergeEmptyline:!0,removeClass:!0,removeEmptyline:!1,imageBlockLine:"center",pasteFilter:!0,removeEmptyNode:!1,removeTagNames:utils.extend({div:1},dtd.$removeEmpty),indent:!1,indentValue:"2em"}});var highlightCont,me=this,opt=me.options.cleanformat,remainClass={selectTdClass:1,pagebreak:1,anchorclass:1},remainTag={li:1},tags={div:1,p:1,blockquote:1,center:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,span:1};opt&&(opt.pasteFilter&&me.addListener("beforepaste",autotype),me.commands.cleanformat={execCommand:function(){me.removeListener("beforepaste",autotype),opt.pasteFilter&&me.addListener("beforepaste",autotype),autotype()}})},function(){function replaceSrc(div){for(var orgSrc,img,imgs=div.getElementsByTagName("img"),i=0;img=imgs[i++];)(orgSrc=img.getAttribute("orgSrc"))&&(img.src=orgSrc,img.removeAttribute("orgSrc"));for(var ai,as=div.getElementsByTagName("a"),i=0;ai=as[i++];i++)ai.getAttribute("data_ue_src")&&ai.setAttribute("href",ai.getAttribute("data_ue_src"))}function setValue(form,editor){var textarea;if(editor.textarea)if(utils.isString(editor.textarea)){for(var ti,i=0,tis=domUtils.getElementsByTagName(form,"textarea");ti=tis[i++];)if(ti.id=="ueditor_textarea_"+editor.options.textarea){textarea=ti;break}}else textarea=editor.textarea;textarea||(form.appendChild(textarea=domUtils.createElement(document,"textarea",{name:editor.options.textarea,id:"ueditor_textarea_"+editor.options.textarea,style:"display:none"})),editor.textarea=textarea),textarea.value=editor.hasContents()?editor.options.allHtmlEnabled?editor.getAllHtml():editor.getContent(null,null,!0):""}var _selectionChangeTimer,uid=0,Editor=UE.Editor=function(options){var me=this;me.uid=uid++,EventBase.call(me),me.commands={},me.options=utils.extend(utils.clone(options||{}),UEDITOR_CONFIG,!0),me.setOpt({isShow:!0,initialContent:"欢迎使用ueditor!",autoClearinitialContent:!1,iframeCssUrl:me.options.UEDITOR_HOME_URL+"themes/iframe.css",textarea:"editorValue",focus:!1,initialFrameWidth:1e3,initialFrameHeight:me.options.minFrameHeight||320,minFrameWidth:800,minFrameHeight:220,autoClearEmptyNode:!0,fullscreen:!1,readonly:!1,zIndex:999,imagePopup:!0,enterTag:"p",pageBreakTag:"_baidu_page_break_tag_",customDomain:!1,lang:"zh-cn",langPath:me.options.UEDITOR_HOME_URL+"lang/",theme:"default",themePath:me.options.UEDITOR_HOME_URL+"themes/",allHtmlEnabled:!1,scaleEnabled:!1,tableNativeEditInFF:!1}),utils.loadFile(document,{src:me.options.langPath+me.options.lang+"/"+me.options.lang+".js",tag:"script",type:"text/javascript",defer:"defer"},function(){for(var pi in UE.plugins)UE.plugins[pi].call(me);me.langIsReady=!0,me.fireEvent("langReady")}),UE.instants["ueditorInstant"+me.uid]=me};Editor.prototype={ready:function(fn){var me=this;fn&&(me.isReady?fn.apply(me):me.addListener("ready",fn))},setOpt:function(key,val){var obj={};utils.isString(key)?obj[key]=val:obj=key,utils.extend(this.options,obj,!0)},destroy:function(){var me=this;me.fireEvent("destroy");var container=me.container.parentNode,textarea=me.textarea;textarea?textarea.style.display="":(textarea=document.createElement("textarea"),container.parentNode.insertBefore(textarea,container)),textarea.style.width=container.offsetWidth+"px",textarea.style.height=container.offsetHeight+"px",textarea.value=me.getContent(),textarea.id=me.key,container.innerHTML="",domUtils.remove(container);var key=me.key;for(var p in me)me.hasOwnProperty(p)&&delete this[p];UE.delEditor(key)},render:function(container){var me=this,options=me.options;if(utils.isString(container)&&(container=document.getElementById(container)),container){var useBodyAsViewport=ie&&9>browser.version,html=(ie&&9>browser.version?"":"<!DOCTYPE html>")+"<html xmlns='http://www.w3.org/1999/xhtml'"+(useBodyAsViewport?"":" class='view'")+"><head>"+(options.iframeCssUrl?"<link rel='stylesheet' type='text/css' href='"+utils.unhtml(options.iframeCssUrl)+"'/>":"")+"<style type='text/css'>"+".view{padding:0;word-wrap:break-word;cursor:text;height:100%;}\n"+"body{margin:8px;font-family:sans-serif;font-size:16px;}"+"p{margin:5px 0;}"+(options.initialStyle||"")+"</style></head><body"+(useBodyAsViewport?" class='view'":"")+"></body>";if(options.customDomain&&document.domain!=location.hostname)html+="<script>window.parent.UE.instants['ueditorInstant"+me.uid+"']._setup(document);</script></html>",container.appendChild(domUtils.createElement(document,"iframe",{id:"baidu_editor_"+me.uid,width:"100%",height:"100%",frameborder:"0",src:'javascript:void(function(){document.open();document.domain="'+document.domain+'";'+'document.write("'+html+'");document.close();}())'}));else{container.innerHTML='<iframe id="baidu_editor_'+this.uid+'"'+'width="100%" height="100%" scroll="no" frameborder="0" ></iframe>';var doc=container.firstChild.contentWindow.document;doc.open(),doc.write(html+"</html>"),doc.close(),me._setup(doc)}container.style.overflow="hidden"}},_setup:function(doc){var me=this,options=me.options;ie?(doc.body.disabled=!0,doc.body.contentEditable=!0,doc.body.disabled=!1):(doc.body.contentEditable=!0,doc.body.spellcheck=!1),me.document=doc,me.window=doc.defaultView||doc.parentWindow,me.iframe=me.window.frameElement,me.body=doc.body,me.setHeight(Math.max(options.minFrameHeight,options.initialFrameHeight)),me.selection=new dom.Selection(doc);var geckoSel;if(browser.gecko&&(geckoSel=this.selection.getNative())&&geckoSel.removeAllRanges(),this._initEvents(),options.initialContent)if(options.autoClearinitialContent){var oldExecCommand=me.execCommand;me.execCommand=function(){me.fireEvent("firstBeforeExecCommand"),oldExecCommand.apply(me,arguments)},this._setDefaultContent(options.initialContent)}else this.setContent(options.initialContent,!0);for(var form=this.iframe.parentNode;!domUtils.isBody(form);form=form.parentNode)if("FORM"==form.tagName){domUtils.on(form,"submit",function(){setValue(this,me)});break}domUtils.isEmptyNode(me.body)&&(me.body.innerHTML="<p>"+(browser.ie?"":"<br/>")+"</p>"),options.focus&&setTimeout(function(){me.focus(),!me.options.autoClearinitialContent&&me._selectionChange()},0),me.container||(me.container=this.iframe.parentNode),options.fullscreen&&me.ui&&me.ui.setFullScreen(!0);try{me.document.execCommand("2D-position",!1,!1)}catch(e){}try{me.document.execCommand("enableInlineTableEditing",!1,options.tableNativeEditInFF)}catch(e){}try{me.document.execCommand("enableObjectResizing",!1,!1)}catch(e){domUtils.on(me.body,browser.ie?"resizestart":"resize",function(evt){domUtils.preventDefault(evt)})}me.isReady=1,me.fireEvent("ready"),options.onready&&options.onready.call(me),browser.ie||domUtils.on(me.window,["blur","focus"],function(e){if("blur"==e.type){me._bakRange=me.selection.getRange();try{me.selection.getNative().removeAllRanges()}catch(e){}}else try{me._bakRange&&me._bakRange.select()}catch(e){}}),browser.gecko&&10902>=browser.version&&(me.body.contentEditable=!1,setTimeout(function(){me.body.contentEditable=!0},100),setInterval(function(){me.body.style.height=me.iframe.offsetHeight-20+"px"},100)),!options.isShow&&me.setHide(),options.readonly&&me.setDisabled()},sync:function(formId){var me=this,form=formId?document.getElementById(formId):domUtils.findParent(me.iframe.parentNode,function(node){return"FORM"==node.tagName},!0);form&&setValue(form,me)},setHeight:function(height){height!==parseInt(this.iframe.parentNode.style.height)&&(this.iframe.parentNode.style.height=height+"px"),this.document.body.style.height=height-20+"px"},getContent:function(cmd,fn,isPreview){var me=this;if(cmd&&utils.isFunction(cmd)&&(fn=cmd,cmd=""),fn?!fn():!this.hasContents())return"";me.fireEvent("beforegetcontent",cmd);var reg=RegExp(domUtils.fillChar,"g"),html=me.body.innerHTML.replace(reg,"").replace(/>[\t\r\n]*?</g,"><");if(me.fireEvent("aftergetcontent",cmd),me.serialize){var node=me.serialize.parseHTML(html);node=me.serialize.transformOutput(node),html=me.serialize.toHTML(node)}return html=ie&&isPreview?html.replace(/<p>\s*?<\/p>/g,"<p>&nbsp;</p>"):html.replace(/(&nbsp;)+/g,function(s){for(var i=0,str=[],l=s.split(";").length-1;l>i;i++)str.push(0==i%2?" ":"&nbsp;");return str.join("")})},getAllHtml:function(){var me=this,headHtml={html:""};return me.fireEvent("getAllHtml",headHtml),"<html><head>"+(me.options.charset?'<meta http-equiv="Content-Type" content="text/html; charset='+me.options.charset+'"/>':"")+me.document.getElementsByTagName("head")[0].innerHTML+headHtml.html+"</head>"+"<body "+(ie&&9>browser.version?'class="view"':"")+">"+me.getContent(null,null,!0)+"</body></html>"},getPlainTxt:function(){var reg=RegExp(domUtils.fillChar,"g"),html=this.body.innerHTML.replace(/[\n\r]/g,"");return html=html.replace(/<(p|div)[^>]*>(<br\/?>|&nbsp;)<\/\1>/gi,"\n").replace(/<br\/?>/gi,"\n").replace(/<[^>/]+>/g,"").replace(/(\n)?<\/([^>]+)>/g,function(a,b,c){return dtd.$block[c]?"\n":b?b:""}),html.replace(reg,"").replace(/\u00a0/g," ").replace(/&nbsp;/g," ")},getContentTxt:function(){var reg=RegExp(domUtils.fillChar,"g");return this.body[browser.ie?"innerText":"textContent"].replace(reg,"").replace(/\u00a0/g," ")},setContent:function(html,notFireSelectionchange){var lastTagName,me=this,inline=utils.extend({a:1,A:1},dtd.$inline,!0);html=html.replace(/^[ \t\r\n]*?</,"<").replace(/>[ \t\r\n]*?$/,">").replace(/>[\t\r\n]*?</g,"><").replace(/[\s\/]?(\w+)?>[ \t\r\n]*?<\/?(\w+)/gi,function(a,b,c){return b?lastTagName=c:b=lastTagName,inline[b]||inline[c]?a:a.replace(/>[ \t\r\n]*?</,"><")}),html={html:html},me.fireEvent("beforesetcontent",html),html=html.html;var serialize=this.serialize;if(serialize){var node=serialize.parseHTML(html);node=serialize.transformInput(node),node=serialize.filter(node),html=serialize.toHTML(node)}if(this.body.innerHTML=html.replace(RegExp("[\r"+domUtils.fillChar+"]*","g"),""),browser.ie&&7>browser.version&&replaceSrc(this.document.body),"p"==me.options.enterTag){var tmpNode,child=this.body.firstChild;if(!child||1==child.nodeType&&(dtd.$cdata[child.tagName]||domUtils.isCustomeNode(child))&&child===this.body.lastChild)this.body.innerHTML="<p>"+(browser.ie?"&nbsp;":"<br/>")+"</p>"+this.body.innerHTML;else for(var p=me.document.createElement("p");child;){for(;child&&(3==child.nodeType||1==child.nodeType&&dtd.p[child.tagName]&&!dtd.$cdata[child.tagName]);)tmpNode=child.nextSibling,p.appendChild(child),child=tmpNode;if(p.firstChild){if(!child){me.body.appendChild(p);break}me.body.insertBefore(p,child),p=me.document.createElement("p")}child=child.nextSibling}}me.fireEvent("aftersetcontent"),me.fireEvent("contentchange"),!notFireSelectionchange&&me._selectionChange(),me._bakRange=me._bakIERange=null;var geckoSel;browser.gecko&&(geckoSel=this.selection.getNative())&&geckoSel.removeAllRanges()},focus:function(toEnd){try{var me=this,rng=me.selection.getRange();toEnd?rng.setStartAtLast(me.body.lastChild).setCursor(!1,!0):rng.select(!0)}catch(e){}},_initEvents:function(){var me=this,doc=me.document,win=me.window;me._proxyDomEvent=utils.bind(me._proxyDomEvent,me),domUtils.on(doc,["click","contextmenu","mousedown","keydown","keyup","keypress","mouseup","mouseover","mouseout","selectstart"],me._proxyDomEvent),domUtils.on(win,["focus","blur"],me._proxyDomEvent),domUtils.on(doc,["mouseup","keydown"],function(evt){"keydown"==evt.type&&(evt.ctrlKey||evt.metaKey||evt.shiftKey||evt.altKey)||2!=evt.button&&me._selectionChange(250,evt)});var dragoverHandler,innerDrag=0,source=browser.ie?me.body:me.document;domUtils.on(source,"dragstart",function(){innerDrag=1}),domUtils.on(source,browser.webkit?"dragover":"drop",function(){return browser.webkit?function(){clearTimeout(dragoverHandler),dragoverHandler=setTimeout(function(){if(!innerDrag){var sel=me.selection,range=sel.getRange();if(range){var common=range.getCommonAncestor();if(common&&me.serialize){var f=me.serialize,node=f.filter(f.transformInput(f.parseHTML(f.word(common.innerHTML))));common.innerHTML=f.toHTML(node)}}}innerDrag=0},200)}:function(e){innerDrag||(e.preventDefault?e.preventDefault():e.returnValue=!1),innerDrag=0}}())},_proxyDomEvent:function(evt){return this.fireEvent(evt.type.replace(/^on/,""),evt)},_selectionChange:function(delay,evt){var mouseX,mouseY,me=this,hackForMouseUp=!1;if(browser.ie&&9>browser.version&&evt&&"mouseup"==evt.type){var range=this.selection.getRange();range.collapsed||(hackForMouseUp=!0,mouseX=evt.clientX,mouseY=evt.clientY)}clearTimeout(_selectionChangeTimer),_selectionChangeTimer=setTimeout(function(){if(me.selection.getNative()){var ieRange;if(hackForMouseUp&&"None"==me.selection.getNative().type){ieRange=me.document.body.createTextRange();try{ieRange.moveToPoint(mouseX,mouseY)}catch(ex){ieRange=null}}var bakGetIERange;ieRange&&(bakGetIERange=me.selection.getIERange,me.selection.getIERange=function(){return ieRange}),me.selection.cache(),bakGetIERange&&(me.selection.getIERange=bakGetIERange),me.selection._cachedRange&&me.selection._cachedStartElement&&(me.fireEvent("beforeselectionchange"),me.fireEvent("selectionchange",!!evt),me.fireEvent("afterselectionchange"),me.selection.clear())}},delay||50)
},_callCmdFn:function(fnName,args){var cmd,cmdFn,cmdName=args[0].toLowerCase();return cmd=this.commands[cmdName]||UE.commands[cmdName],cmdFn=cmd&&cmd[fnName],cmd&&cmdFn||"queryCommandState"!=fnName?cmdFn?cmdFn.apply(this,args):void 0:0},execCommand:function(cmdName){cmdName=cmdName.toLowerCase();var result,me=this,cmd=me.commands[cmdName]||UE.commands[cmdName];return cmd&&cmd.execCommand?(cmd.notNeedUndo||me.__hasEnterExecCommand?result=this._callCmdFn("execCommand",arguments):(me.__hasEnterExecCommand=!0,-1!=me.queryCommandState(cmdName)&&(me.fireEvent("beforeexeccommand",cmdName),result=this._callCmdFn("execCommand",arguments),me.fireEvent("afterexeccommand",cmdName)),me.__hasEnterExecCommand=!1),!me.__hasEnterExecCommand&&me._selectionChange(),result):null},queryCommandState:function(){return this._callCmdFn("queryCommandState",arguments)},queryCommandValue:function(){return this._callCmdFn("queryCommandValue",arguments)},hasContents:function(tags){if(tags)for(var ci,i=0;ci=tags[i++];)if(this.document.getElementsByTagName(ci).length>0)return!0;if(!domUtils.isEmptyBlock(this.body))return!0;for(tags=["div"],i=0;ci=tags[i++];)for(var cn,nodes=domUtils.getElementsByTagName(this.document,ci),n=0;cn=nodes[n++];)if(domUtils.isCustomeNode(cn))return!0;return!1},reset:function(){this.fireEvent("reset")},setEnabled:function(){var range,me=this;if("false"==me.body.contentEditable){me.body.contentEditable=!0,range=me.selection.getRange();try{range.moveToBookmark(me.lastBk),delete me.lastBk}catch(e){range.setStartAtFirst(me.body).collapse(!0)}range.select(!0),me.bkqueryCommandState&&(me.queryCommandState=me.bkqueryCommandState,delete me.bkqueryCommandState),me.fireEvent("selectionchange")}},enable:function(){return this.setEnabled()},setDisabled:function(except){var me=this;except=except?utils.isArray(except)?except:[except]:[],"true"==me.body.contentEditable&&(me.lastBk||(me.lastBk=me.selection.getRange().createBookmark(!0)),me.body.contentEditable=!1,me.bkqueryCommandState=me.queryCommandState,me.queryCommandState=function(type){return-1!=utils.indexOf(except,type)?me.bkqueryCommandState.apply(me,arguments):-1},me.fireEvent("selectionchange"))},disable:function(except){return this.setDisabled(except)},_setDefaultContent:function(){function clear(){var me=this;me.document.getElementById("initContent")&&(me.body.innerHTML="<p>"+(ie?"":"<br/>")+"</p>",me.removeListener("firstBeforeExecCommand focus",clear),setTimeout(function(){me.focus(),me._selectionChange()},0))}return function(cont){var me=this;me.body.innerHTML='<p id="initContent">'+cont+"</p>",browser.ie&&7>browser.version&&replaceSrc(me.body),me.addListener("firstBeforeExecCommand focus",clear)}}(),setShow:function(){var me=this,range=me.selection.getRange();if("none"==me.container.style.display){try{range.moveToBookmark(me.lastBk),delete me.lastBk}catch(e){range.setStartAtFirst(me.body).collapse(!0)}setTimeout(function(){range.select(!0)},100),me.container.style.display=""}},show:function(){return this.setShow()},setHide:function(){var me=this;me.lastBk||(me.lastBk=me.selection.getRange().createBookmark(!0)),me.container.style.display="none"},hide:function(){return this.setHide()},getLang:function(path){var lang=UE.I18N[this.options.lang];path=(path||"").split(".");for(var ci,i=0;(ci=path[i++])&&(lang=lang[ci],lang););return lang}},utils.inherits(Editor,EventBase)}();